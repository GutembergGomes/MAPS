<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Faltas - Agrícola CCT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' };</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <!-- Supabase JS (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/dist/umd/supabase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: #5D5CDE; color: white; }
        
        /* Animações */
        @keyframes fade-in {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }
        
        /* Modal styles corrigidos */
        .modal { 
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { 
            display: flex !important; 
        }
        
        /* Campos de atestado médico */
        .atestado-fields {
            display: none;
        }

        /* Cards do dashboard */
        .stat-card {
            transition: transform 0.2s ease-in-out;
        }
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        /* Melhorias visuais */
        .chart-container {
            position: relative;
            height: 300px;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.375rem;
        }
        :root { --primary: #5D5CDE; --bg: #f7f7fb; --bg2: #eef2ff; }
        body { background: radial-gradient(1200px circle at 10% 10%, var(--bg2) 0, #f8fafc 40%, var(--bg) 100%); }
        .dark body { background: radial-gradient(1200px circle at 10% 10%, #0b1220 0, #0f172a 40%, #111827 100%); }
        .tab-button { border-bottom: 2px solid transparent; border-radius: 0.5rem; transition: all .2s ease; }
        .tab-button.active { background: transparent; color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
        .modern-nav { backdrop-filter: blur(8px) saturate(120%); }
        .stat-card { backdrop-filter: saturate(120%) blur(4px); }
        input, select, textarea, button { border-radius: 0.75rem; }
        .dark body { color: #e5e7eb; }
        .dark .text-gray-900, .dark .text-gray-800, .dark .text-gray-700 { color: #e5e7eb !important; }
        .dark .text-gray-600 { color: #d1d5db !important; }
        .dark .text-gray-500 { color: #cbd5e1 !important; }
        .dark ::placeholder { color: #94a3b8; }
        .dark td, .dark th { color: #e5e7eb; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Header -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3">
                        <span class="inline-flex items-center gap-2 bg-[#5D5CDE]/10 text-[#5D5CDE] border border-[#5D5CDE] px-3 py-1 rounded-full text-xs font-semibold">
                            <i class="fas fa-leaf"></i> GGOMES-LOG
                        </span>
                        <i class="fas fa-calendar-check text-[#5D5CDE]"></i>
                        Sistema de Controle de Faltas
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Agrícola - CCT Cambui</p>
                </div>
                <div class="flex items-center gap-3">
                    <span id="user-email" class="text-sm text-gray-600 dark:text-gray-300 hidden"></span>
                    <span id="perm-delete-badge" class="hidden inline-flex items-center gap-2 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-800 px-3 py-1 rounded-full text-xs font-semibold" title="Permissão necessária para excluir">
                        <i class="fas fa-shield-alt"></i> Sem permissão para excluir
                    </span>
                    <button id="btn-toggle-theme" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition" title="Alternar tema">
                        <i id="icon-theme" class="fas fa-moon"></i>
                    </button>
                    <button id="btn-login" class="px-4 py-2 bg-[#5D5CDE] text-white rounded-lg hover:bg-[#4A4BC9] transition">
                        <i class="fas fa-user mr-2"></i>Entrar
                    </button>
                    <button id="btn-logout" class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition hidden">
                        Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg mb-6 modern-nav">
            <div class="flex flex-wrap border-b border-gray-200 dark:border-gray-700">
                <button onclick="showTab('dashboard')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none active" 
                        id="tab-dashboard">
                    <i class="fas fa-chart-line mr-2"></i>Dashboard
                </button>
                <button onclick="showTab('funcionarios')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-funcionarios">
                    <i class="fas fa-users mr-2"></i>Funcionários
                </button>
                <button onclick="showTab('registro')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-registro">
                    <i class="fas fa-plus-circle mr-2"></i>Registrar Falta
                </button>
                <button onclick="showTab('consulta')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-consulta">
                    <i class="fas fa-search mr-2"></i>Consultar Faltas
                </button>
                <button onclick="showTab('historico')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-historico">
                    <i class="fas fa-history mr-2"></i>Histórico
                </button>
                <button onclick="showTab('relatorios')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-relatorios">
                    <i class="fas fa-file-alt mr-2"></i>Relatórios
                </button>
                <button onclick="showTab('configuracao')" 
                        class="tab-button px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none" 
                        id="tab-configuracao">
                    <i class="fas fa-cogs mr-2"></i>Configurações
                </button>
                <button onclick="showTab('admin')"
                        class="tab-button hidden px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-[#5D5CDE] focus:outline-none"
                        id="tab-admin">
                    <i class="fas fa-shield-alt mr-2"></i>Admin
                </button>
            </div>
            <div class="flex flex-col md:flex-row items-center justify-between px-4 py-3 gap-3">
                <div class="text-sm text-gray-600 dark:text-gray-300">
                    Busca rápida de funcionário (nome ou matrícula)
                </div>
                <div class="flex items-center gap-2 w-full md:w-auto">
                    <input id="global-search-func" 
                           type="text" 
                           placeholder="Digite nome ou matrícula..." 
                           class="flex-1 md:flex-none px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-sm w-full md:w-64">
                    <button id="btn-global-search"
                            type="button"
                            class="px-4 py-2 bg-[#5D5CDE] text-white rounded-lg text-sm hover:bg-[#4A4BC9] transition">
                        <i class="fas fa-search mr-1"></i>Buscar
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Contents -->

        <!-- Dashboard Tab -->
        <div id="dashboard-content" class="tab-content active">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Dashboard - Visão Geral</h2>
                    <div class="flex gap-4 mt-4 md:mt-0 items-center">
                        <select id="filtro-frente-dashboard" 
                                class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="todas">Todas as Frentes</option>
                        </select>
                        <select id="filtro-lider-dashboard" 
                                class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="todos">Todos os Líderes</option>
                        </select>
                        <select id="filtro-periodo-dashboard" 
                                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="mes_atual">Este Mês</option>
                            <option value="mes_anterior">Mês Anterior</option>
                            <option value="trimestre">Este Trimestre</option>
                            <option value="semestre">Este Semestre</option>
                            <option value="ano">Este Ano</option>
                        </select>
                        <button onclick="atualizarDashboard()" 
                                class="bg-[#5D5CDE] text-white px-4 py-2 rounded-lg hover:bg-[#4A4BC9] transition duration-200">
                            <i class="fas fa-sync-alt mr-2"></i>Atualizar
                        </button>
                    </div>
                </div>

                <!-- Cards de Estatísticas -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-blue-600 dark:text-blue-400 text-sm font-medium">Total de Funcionários</div>
                                <div class="text-2xl font-bold text-blue-900 dark:text-blue-300" id="dashboard-total-funcionarios">0</div>
                            </div>
                            <i class="fas fa-users text-blue-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-red-600 dark:text-red-400 text-sm font-medium">Faltas Este Mês</div>
                                <div class="text-2xl font-bold text-red-900 dark:text-red-300" id="dashboard-faltas-mes">0</div>
                            </div>
                            <i class="fas fa-calendar-times text-red-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-green-600 dark:text-green-400 text-sm font-medium">Taxa de Presença</div>
                                <div class="text-2xl font-bold text-green-900 dark:text-green-300" id="dashboard-taxa-presenca">0%</div>
                            </div>
                            <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-yellow-600 dark:text-yellow-400 text-sm font-medium">Atestados Médicos</div>
                                <div class="text-2xl font-bold text-yellow-900 dark:text-yellow-300" id="dashboard-atestados">0</div>
                            </div>
                            <i class="fas fa-file-medical text-yellow-500 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Painel de Alertas de Risco -->
                <div class="mb-8" id="painel-alertas">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle text-orange-500"></i> Alertas de Risco Diário
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Alerta de Faltas Excessivas -->
                        <div class="bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg p-4">
                            <h4 class="text-red-700 dark:text-red-400 font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-user-times"></i> Faltas Excessivas (>3/mês)
                            </h4>
                            <div id="lista-alertas-faltas" class="space-y-2 max-h-48 overflow-y-auto pr-2 text-sm">
                                <p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>
                            </div>
                        </div>

                        <!-- Alerta de CNH -->
                        <div class="bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800 rounded-lg p-4">
                            <h4 class="text-orange-700 dark:text-orange-400 font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-id-card"></i> CNH Vencendo/Vencida
                            </h4>
                            <div id="lista-alertas-cnh" class="space-y-2 max-h-48 overflow-y-auto pr-2 text-sm">
                                <p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>
                            </div>
                        </div>

                        <!-- Alerta de Atestados Longos -->
                        <div class="bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                            <h4 class="text-yellow-700 dark:text-yellow-400 font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-hospital-user"></i> Atestados Prolongados (>15 dias)
                            </h4>
                            <div id="lista-alertas-atestados" class="space-y-2 max-h-48 overflow-y-auto pr-2 text-sm">
                                <p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Novos Cards de Métricas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-purple-600 dark:text-purple-400 text-sm font-medium">Faltas Injustificadas</div>
                                <div class="text-2xl font-bold text-purple-900 dark:text-purple-300" id="dashboard-faltas-injustificadas">0</div>
                            </div>
                            <i class="fas fa-exclamation-triangle text-purple-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-cyan-600 dark:text-cyan-400 text-sm font-medium">Média Faltas/Funcionário</div>
                                <div class="text-2xl font-bold text-cyan-900 dark:text-cyan-300" id="dashboard-media-faltas">0</div>
                            </div>
                            <i class="fas fa-chart-bar text-cyan-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-pink-50 dark:bg-pink-900/20 border border-pink-200 dark:border-pink-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-pink-600 dark:text-pink-400 text-sm font-medium">Func. Sem Faltas</div>
                                <div class="text-2xl font-bold text-pink-900 dark:text-pink-300" id="dashboard-sem-faltas">0</div>
                            </div>
                            <i class="fas fa-user-check text-pink-500 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-indigo-600 dark:text-indigo-400 text-sm font-medium">Faltas de Hoje</div>
                                <div class="text-2xl font-bold text-indigo-900 dark:text-indigo-300" id="dashboard-faltas-hoje">0</div>
                            </div>
                            <i class="fas fa-calendar-day text-indigo-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-teal-50 dark:bg-teal-900/20 border border-teal-200 dark:border-teal-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-teal-600 dark:text-teal-400 text-sm font-medium">Registros Administrativos</div>
                                <div class="text-xs text-teal-700 dark:text-teal-300">Férias, Banco de Horas, Abono, Dispensa por Chuva</div>
                                <div class="text-2xl font-bold text-teal-900 dark:text-teal-300" id="dashboard-admin-registros">0</div>
                            </div>
                            <i class="fas fa-clipboard-list text-teal-500 text-xl"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-800 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-gray-600 dark:text-gray-400 text-sm font-medium">Variação vs Mês Anterior</div>
                                <div class="text-2xl font-bold" id="dashboard-variacao-mes">0</div>
                            </div>
                            <i class="fas fa-exchange-alt text-gray-500 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Faltas por Motivo</h3>
                        <div class="chart-container">
                            <canvas id="grafico-motivos"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Evolução Mensal de Faltas</h3>
                        <div class="chart-container">
                            <canvas id="grafico-evolucao"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Novos Gráficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Faltas por Setor</h3>
                        <div class="chart-container">
                            <canvas id="grafico-setores"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Comparativo de Turnos</h3>
                        <div class="chart-container">
                            <canvas id="grafico-turnos"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Top Funcionários com Mais Faltas -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Top 10 - Funcionários com Mais Faltas</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50 dark:bg-gray-700">
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Posição</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Funcionário</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Matrícula</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Total de Faltas</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Faltas Este Mês</th>
                                </tr>
                            </thead>
                            <tbody id="top-faltas-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dados serão inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Top Líderes por Faltas</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="px-4 py-2 text-left">Líder</th>
                                        <th class="px-4 py-2 text-left">Total de Faltas</th>
                                    </tr>
                                </thead>
                                <tbody id="top-lideres-table"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Resumo Administrativo</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-sm text-purple-700 dark:text-purple-300">Férias</div>
                                <div class="text-xl font-bold" id="dashboard-ferias-count">0</div>
                            </div>
                            <div class="p-4 bg-cyan-50 dark:bg-cyan-900/20 rounded-lg">
                                <div class="text-sm text-cyan-700 dark:text-cyan-300">Banco de Horas</div>
                                <div class="text-xl font-bold" id="dashboard-banco-count">0</div>
                            </div>
                            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                <div class="text-sm text-yellow-700 dark:text-yellow-300">Abonos</div>
                                <div class="text-xl font-bold" id="dashboard-abono-count">0</div>
                            </div>
                            <div class="p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg">
                                <div class="text-sm text-indigo-700 dark:text-indigo-300">Dispensa por Chuva</div>
                                <div class="text-xl font-bold" id="dashboard-chuva-count">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Funcionários Tab -->
        <div id="funcionarios-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Lista de Funcionários</h2>
                    <div class="flex items-center gap-4">
                        <input type="text" 
                               id="search-funcionarios" 
                               placeholder="Buscar funcionário..." 
                               class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base w-64">
                        <select id="filtro-frente-turno" 
                                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="todos">Todos os funcionários</option>
                            <option value="com-frente-turno">Com frente e turno</option>
                            <option value="sem-frente-turno">Sem frente ou turno</option>
                        </select>
                        <select id="filtro-lider"
                                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="todos">Todos os líderes</option>
                        </select>
                        <span id="total-funcionarios" class="text-sm text-gray-600 dark:text-gray-400 font-medium"></span>
                        <button id="btn-novo-funcionario" 
                                class="px-4 py-2 bg-[#5D5CDE] text-white rounded-lg hover:bg-[#4A4BC9] transition">
                            <i class="fas fa-user-plus mr-2"></i>Novo Funcionário
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50 dark:bg-gray-700">
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Matrícula</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Cargo</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Setor</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Frente</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Turno</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Líder</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Admissão</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="funcionarios-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Funcionários serão inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Registro de Falta Tab -->
        <div id="registro-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                    <span id="form-title">Registrar Nova Falta</span>
                </h2>
                
                <form id="falta-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="hidden" id="falta-id" value="">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data da Falta</label>
                        <input type="date" 
                               id="data-falta" 
                               required 
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Matrícula do Funcionário</label>
                        <input type="text" 
                               id="matricula-falta" 
                               placeholder="Digite a matrícula..." 
                               required 
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        <div id="funcionario-info" class="mt-2 text-sm text-gray-600 dark:text-gray-400"></div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Funcionário</label>
                        <input type="text" 
                               id="nome-funcionario" 
                               readonly 
                               class="w-full px-4 py-2 bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg dark:text-white text-base">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Motivo da Falta</label>
                        <select id="motivo-falta" 
                                required 
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            <option value="">Selecione o motivo...</option>
                            <option value="doença">Doença</option>
                            <option value="atestado-medico">Atestado Médico</option>
                            <option value="falta-justificada">Falta Justificada</option>
                            <option value="falta-injustificada">Falta Injustificada</option>
                            <option value="licenca-medica">Licença Médica</option>
                            <option value="acidente-trabalho">Acidente de Trabalho</option>
                            <option value="licenca-maternidade">Licença Maternidade</option>
                            <option value="licenca-paternidade">Licença Paternidade</option>
                            <option value="ferias">Férias</option>
                            <option value="abono">Abono</option>
                            <option value="banco-horas">Banco de Horas</option>
                            <option value="dispensa-chuva">Dispensa por Chuva</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    
                    <!-- Campos específicos para atestado médico -->
                    <div id="atestado-fields" class="md:col-span-2 atestado-fields">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label id="label-data-inicial-periodo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Inicial do Atestado</label>
                                <input type="date" 
                                       id="data-inicial-atestado" 
                                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            </div>
                            
                            <div>
                                <label id="label-duracao-periodo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Duração do Atestado (dias)</label>
                                <input type="number" 
                                       id="duracao-atestado" 
                                       min="1" 
                                       max="365"
                                       placeholder="Número de dias"
                                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Foto do Atestado (imagem)</label>
                            <input type="file" id="atestado-foto" accept="image/*" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            <div id="atestado-foto-preview" class="mt-2"></div>
                        </div>
                        <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                            <p id="info-datas-atestado" class="hidden"></p>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                        <textarea id="observacoes" 
                                  rows="3" 
                                  placeholder="Observações adicionais sobre a falta..."
                                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base resize-none"></textarea>
                    </div>
                    
                    <div class="md:col-span-2 flex gap-4">
                        <button type="submit" 
                                class="flex-1 bg-[#5D5CDE] text-white py-3 px-6 rounded-lg font-medium hover:bg-[#4A4BC9] focus:outline-none focus:ring-2 focus:ring-[#5D5CDE] focus:ring-offset-2 transition duration-200">
                            <i class="fas fa-save mr-2"></i><span id="btn-submit-text">Registrar Falta</span>
                        </button>
                        <button type="button" 
                                id="btn-cancelar"
                                onclick="cancelarEdicao()"
                                style="display: none;"
                                class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-200">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Consulta Tab -->
        <div id="consulta-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Consultar Faltas por Funcionário</h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Matrícula do Funcionário</label>
                    <div class="flex gap-4">
                        <input type="text" 
                               id="consulta-matricula" 
                               placeholder="Digite a matrícula para consultar..."
                               class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        <button onclick="consultarFaltas()" 
                                class="bg-[#5D5CDE] text-white px-6 py-2 rounded-lg font-medium hover:bg-[#4A4BC9] focus:outline-none focus:ring-2 focus:ring-[#5D5CDE] transition duration-200">
                            <i class="fas fa-search mr-2"></i>Buscar
                        </button>
                    </div>
                </div>
                
                <!-- Informações do Funcionário -->
                <div id="funcionario-consulta-info" class="hidden bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Informações do Funcionário</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="font-medium text-gray-700 dark:text-gray-300">Nome:</span>
                            <span id="consulta-nome" class="text-gray-900 dark:text-white ml-2"></span>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700 dark:text-gray-300">Cargo:</span>
                            <span id="consulta-cargo" class="text-gray-900 dark:text-white ml-2"></span>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700 dark:text-gray-300">Setor:</span>
                            <span id="consulta-setor" class="text-gray-900 dark:text-white ml-2"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Resumo de Faltas -->
                <div id="resumo-faltas" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                        <div class="text-blue-600 dark:text-blue-400 text-sm font-medium">Total de Faltas</div>
                        <div id="total-faltas" class="text-2xl font-bold text-blue-900 dark:text-blue-300">0</div>
                    </div>
                    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                        <div class="text-red-600 dark:text-red-400 text-sm font-medium">Injustificadas</div>
                        <div id="faltas-injustificadas" class="text-2xl font-bold text-red-900 dark:text-red-300">0</div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                        <div class="text-green-600 dark:text-green-400 text-sm font-medium">Justificadas</div>
                        <div id="faltas-justificadas" class="text-2xl font-bold text-green-900 dark:text-green-300">0</div>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                        <div class="text-yellow-600 dark:text-yellow-400 text-sm font-medium">Este Mês</div>
                        <div id="faltas-mes" class="text-2xl font-bold text-yellow-900 dark:text-yellow-300">0</div>
                    </div>
                </div>
                
                <!-- Lista de Faltas -->
                <div id="lista-faltas" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Histórico de Faltas</h3>
                        <div class="flex gap-2">
                            <input type="month" 
                                   id="filtro-mes" 
                                   class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white">
                            <button onclick="filtrarFaltas()" 
                                    class="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600">
                                Filtrar
                            </button>
                            <button onclick="excluirFaltasEmLote()" 
                                    class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                                <i class="fas fa-trash mr-1"></i>Excluir Selecionadas
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50 dark:bg-gray-700">
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                        <input type="checkbox" id="selecionar-todos" onchange="selecionarTodasFaltas(this.checked)">
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Motivo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Observações</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Atestado</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Registrado em</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="faltas-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Faltas serão inseridas via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="sem-faltas" class="hidden text-center py-8">
                    <i class="fas fa-clipboard-check text-6xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">Nenhuma falta encontrada para este funcionário.</p>
                </div>
            </div>
        </div>

        <!-- Histórico Tab -->
        <div id="historico-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Histórico de Alterações</h2>
                
                <div class="mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Alteração</label>
                            <select id="filtro-tipo-historico" 
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                                <option value="todos">Todos os Tipos</option>
                                <option value="funcionario">Funcionários</option>
                                <option value="falta">Faltas</option>
                                <option value="sistema">Sistema</option>
                            </select>
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Período</label>
                            <select id="filtro-periodo-historico" 
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                                <option value="7">Últimos 7 dias</option>
                                <option value="30">Últimos 30 dias</option>
                                <option value="90">Últimos 3 meses</option>
                                <option value="365">Último ano</option>
                                <option value="todos">Todo o período</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="filtrarHistorico()" 
                                    class="w-full bg-[#5D5CDE] text-white py-2 px-4 rounded-lg hover:bg-[#4A4BC9] transition duration-200">
                                <i class="fas fa-filter mr-2"></i>Filtrar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50 dark:bg-gray-700">
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data/Hora</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tipo</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Descrição</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Usuário</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Detalhes</th>
                            </tr>
                            </thead>
                        <tbody id="historico-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Histórico será inserido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div id="sem-historico" class="hidden text-center py-8">
                    <i class="fas fa-history text-6xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">Nenhum registro de histórico encontrado.</p>
                </div>
            </div>
        </div>

        <!-- Relatórios Tab -->
        <div id="relatorios-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Relatórios e Análises</h2>
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Relatórios Rápidos</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="gerarRelatorioRapido('faltas_hoje')" 
                                class="p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition duration-200">
                            <i class="fas fa-calendar-day text-blue-500 text-xl mb-2"></i>
                            <div class="font-medium text-blue-900 dark:text-blue-300">Faltas de Hoje</div>
                            <div class="text-sm text-blue-600 dark:text-blue-400">Visualizar faltas do dia atual</div>
                        </button>
                        
                        <button onclick="gerarRelatorioRapido('banco_horas_mes')" 
                                class="p-4 bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-lg hover:bg-cyan-100 dark:hover:bg-cyan-900/30 transition duration-200">
                            <i class="fas fa-clock text-cyan-500 text-xl mb-2"></i>
                            <div class="font-medium text-cyan-900 dark:text-cyan-300">Banco de Horas</div>
                            <div class="text-sm text-cyan-600 dark:text-cyan-400">Registros deste mês</div>
                        </button>
                        
                        <button onclick="gerarRelatorioRapido('faltas_semana')" 
                                class="p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition duration-200">
                            <i class="fas fa-calendar-week text-green-500 text-xl mb-2"></i>
                            <div class="font-medium text-green-900 dark:text-green-300">Faltas da Semana</div>
                            <div class="text-sm text-green-600 dark:text-green-400">Últimos 7 dias</div>
                        </button>
                        
                        <button onclick="gerarRelatorioRapido('atestados_mes')" 
                                class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg hover:bg-yellow-100 dark:hover:bg-yellow-900/30 transition duration-200">
                            <i class="fas fa-file-medical text-yellow-500 text-xl mb-2"></i>
                            <div class="font-medium text-yellow-900 dark:text-yellow-300">Atestados do Mês</div>
                            <div class="text-sm text-yellow-600 dark:text-yellow-400">Atestados deste mês</div>
                        </button>
                    </div>
                </div>
                
                <!-- Filtros de Relatório -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Relatório</label>
                        <select id="tipo-relatorio" 
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-600 dark:text-white text-base">
                            <option value="faltas_geral">Faltas - Visão Geral</option>
                            <option value="faltas_funcionario">Faltas por Funcionário</option>
                            <option value="faltas_motivo">Faltas por Motivo</option>
                            <option value="faltas_setor">Faltas por Setor</option>
                            <option value="faltas_frente">Faltas por Frente</option>
                            <option value="atestados">Atestados Médicos</option>
                            <option value="ferias">Férias</option>
                            <option value="banco_horas">Banco de Horas</option>
                            <option value="comparativo">Comparativo Mensal</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Inicial</label>
                        <input type="month" 
                               id="relatorio-data-inicial"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-600 dark:text-white text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Final</label>
                        <input type="month" 
                               id="relatorio-data-final"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-600 dark:text-white text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frente</label>
                        <select id="filtro-frente-relatorio" 
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-600 dark:text-white text-base">
                            <option value="todas">Todas as Frentes</option>
                            <!-- Opções serão preenchidas via JavaScript -->
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Líder</label>
                        <select id="filtro-lider-relatorio" 
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-600 dark:text-white text-base">
                            <option value="todos">Todos os Líderes</option>
                        </select>
                    </div>
                    
                    <div class="flex items-end">
                        <button onclick="gerarRelatorio()" 
                                class="w-full bg-[#5D5CDE] text-white py-2 px-4 rounded-lg hover:bg-[#4A4BC9] transition duration-200">
                            <i class="fas fa-download mr-2"></i>Gerar Relatório
                        </button>
                    </div>
                </div>

                <!-- Área de Visualização do Relatório -->
                <div id="area-relatorio" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white" id="titulo-relatorio"></h3>
                        <div class="flex gap-2">
                            <button onclick="imprimirRelatorio()" 
                                    class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-200">
                                <i class="fas fa-print mr-2"></i>Imprimir
                            </button>
                            <button onclick="exportarRelatorioPDF()" 
                                    class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
                                <i class="fas fa-file-pdf mr-2"></i>Exportar PDF
                            </button>
                            <button onclick="exportarRelatorioExcel()" 
                                    class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-200">
                                <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                            </button>
                            <button onclick="exportarRelatorioCSV()" 
                                    class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition duration-200">
                                <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                            </button>
                        </div>
                    </div>
                    
                    <div id="conteudo-relatorio" class="bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6">
                        <!-- Conteúdo do relatório será inserido aqui -->
                    </div>
                </div>

                

                
            </div>
        </div>

        <!-- Configurações Tab -->
        <div id="configuracao-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Configurações do Sistema</h2>
                
                <!-- Backup e Restore -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-download text-[#5D5CDE] mr-2"></i>Backup e Restauração
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Exportar Backup</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                Baixe todos os dados das faltas registradas em um arquivo JSON.
                            </p>
                            <button onclick="exportarBackup()" 
                                    class="w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition duration-200">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                        </div>
                        
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Importar Backup</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                Restaure dados de um arquivo de backup JSON.
                            </p>
                            <input type="file" 
                                   id="arquivo-backup" 
                                   accept=".json" 
                                   class="hidden">
                            <button onclick="document.getElementById('arquivo-backup').click()" 
                                    class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200">
                                <i class="fas fa-upload mr-2"></i>Selecionar Arquivo
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estatísticas do Sistema -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-bar text-[#5D5CDE] mr-2"></i>Estatísticas do Sistema
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stat-total-funcionarios">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Total de Funcionários</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stat-total-faltas">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Total de Faltas</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" id="stat-faltas-mes">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Faltas este Mês</div>
                        </div>
                    </div>
                </div>
                
                <!-- Limpeza de Dados -->
                
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin-content" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Painel Administrativo</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="admin-total-usuarios">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Total de Usuários</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="admin-usuarios-online">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Usuários Online</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="admin-pendentes">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Pendentes de Autorização</div>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-3 mb-4 items-end">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Adicionar Email</label>
                        <input type="email" id="admin-add-email" placeholder="email@exemplo.com" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white">
                    </div>
                    <button id="admin-add-btn" class="bg-[#5D5CDE] text-white px-4 py-2 rounded-lg hover:bg-[#4A4BC9] transition"><i class="fas fa-plus mr-2"></i>Adicionar</button>
                    <button id="admin-reload-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition"><i class="fas fa-sync-alt mr-2"></i>Recarregar do Banco</button>
                    <span id="admin-users-source" class="text-sm text-gray-600 dark:text-gray-300"></span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-600">
                                <th class="px-3 py-2 text-left">Email</th>
                                <th class="px-3 py-2 text-left">Autorizado</th>
                                <th class="px-3 py-2 text-left">Admin</th>
                                <th class="px-3 py-2 text-left">Online</th>
                                <th class="px-3 py-2 text-left">Último Visto</th>
                                <th class="px-3 py-2 text-left">Ações</th>
                                <th class="px-3 py-2 text-left">Permissões</th>
                            </tr>
                        </thead>
                        <tbody id="admin-users-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação Customizado -->
    <div id="modal-confirmacao" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2" id="modal-titulo">Confirmação</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-4" id="modal-mensagem"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancelar" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200">
                    Cancelar
                </button>
                <button id="modal-confirmar" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition duration-200">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Falta -->
    <div id="modal-editar" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Editar Falta</h3>
            
            <form id="form-editar-falta" class="space-y-4">
                <input type="hidden" id="edit-falta-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Data da Falta</label>
                        <input type="date" id="edit-data" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Motivo</label>
                        <select id="edit-motivo" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                            <option value="doença">Doença</option>
                            <option value="atestado-medico">Atestado Médico</option>
                            <option value="falta-justificada">Falta Justificada</option>
                            <option value="falta-injustificada">Falta Injustificada</option>
                            <option value="licenca-medica">Licença Médica</option>
                            <option value="acidente-trabalho">Acidente de Trabalho</option>
                            <option value="licenca-maternidade">Licença Maternidade</option>
                            <option value="licenca-paternidade">Licença Paternidade</option>
                            <option value="ferias">Férias</option>
                            <option value="abono">Abono</option>
                            <option value="banco-horas">Banco de Horas</option>
                            <option value="dispensa-chuva">Dispensa por Chuva</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>

                <!-- Campos específicos para atestado médico na edição -->
                <div id="edit-atestado-fields" class="md:col-span-2 atestado-fields">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label id="label-edit-data-inicial-periodo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Inicial do Atestado</label>
                            <input type="date" 
                                   id="edit-data-inicial-atestado" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        
                        <div>
                            <label id="label-edit-duracao-periodo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Duração do Atestado (dias)</label>
                            <input type="number" 
                                   id="edit-duracao-atestado" 
                                   min="1" 
                                   max="365"
                                   placeholder="Número de dias"
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base">
                        </div>
                    </div>
                    <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                        <p id="edit-info-datas-atestado" class="hidden"></p>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Observações</label>
                    <textarea id="edit-observacoes" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#5D5CDE] dark:bg-gray-700 dark:text-white text-base resize-none"></textarea>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="fecharModalEditar()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-[#5D5CDE] text-white hover:bg-[#4A4BC9] rounded transition duration-200">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Permissões de Usuário -->
    <div id="modal-permissoes" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Permissões de Visualização</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4" id="perm-user-email"></p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-dashboard">Dashboard</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-funcionarios">Funcionários</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-registro">Registrar Falta</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-consulta">Consultar Faltas</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-historico">Histórico</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-relatorios">Relatórios</label>
                <label class="flex items-center gap-2"><input type="checkbox" id="perm-configuracao">Configurações</label>
            </div>
            <div class="flex justify-end gap-3 mt-4">
                <button id="perm-cancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancelar</button>
                <button id="perm-save" class="px-4 py-2 bg-[#5D5CDE] text-white hover:bg-[#4A4BC9] rounded">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro de Funcionário -->
    <div id="modal-funcionario" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Cadastrar Funcionário</h3>
            <form id="form-funcionario" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Matrícula</label>
                        <input type="number" id="func-matricula" required min="1" 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Empresa</label>
                        <input type="number" id="func-empresa" required min="1"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white" value="25">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome</label>
                    <input type="text" id="func-nome" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cargo</label>
                        <input type="text" id="func-cargo" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Setor</label>
                        <input type="text" id="func-setor" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Frente</label>
                        <input type="text" id="func-frente"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"
                               placeholder="Ex: Frente 1, Frente 2...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Turno</label>
                        <select id="func-turno" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="">Selecione o turno</option>
                            <option value="Turno ADM 1">Turno ADM 1</option>
                            <option value="Turno ADM 2">Turno ADM 2</option>
                            <option value="Turno A">Turno A </option>
                            <option value="Turno B ">Turno B</option>
                            <option value="Turno C ">Turno C</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Líder Responsável</label>
                    <input type="text" id="func-lider"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"
                           placeholder="Nome do líder responsável">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Admissão</label>
                    <input type="date" id="func-admissao"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Opcional. Você pode informar a data.</p>
                </div>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-2">
                    <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
                        <i class="fas fa-id-card"></i> Dados da CNH <span class="text-xs font-normal text-gray-500">(Obrigatório para Motoristas)</span>
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Número CNH</label>
                            <input type="text" id="func-cnh" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Expedição</label>
                            <input type="date" id="func-cnh-expedicao" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Vencimento</label>
                            <input type="date" id="func-cnh-vencimento" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Foto da CNH</label>
                        <input type="file" id="func-cnh-foto" accept="image/*" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div class="flex justify-end gap-2 pt-2">
                    <button type="button" id="func-cancel" 
                            class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        Cancelar
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-[#5D5CDE] text-white hover:bg-[#4A4BC9] rounded">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Funcionário -->
    <div id="modal-editar-funcionario" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Editar Funcionário</h3>
            <form id="form-editar-funcionario" class="space-y-4">
                <input type="hidden" id="edit-func-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Matrícula</label>
                        <input type="number" id="edit-func-matricula" required min="1" 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Empresa</label>
                        <input type="number" id="edit-func-empresa" required min="1"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome</label>
                    <input type="text" id="edit-func-nome" required
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cargo</label>
                        <input type="text" id="edit-func-cargo" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Setor</label>
                        <input type="text" id="edit-func-setor" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Frente</label>
                        <input type="text" id="edit-func-frente"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"
                               placeholder="Ex: Frente 1, Frente 2...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Turno</label>
                        <select id="edit-func-turno" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <option value="">Selecione o turno</option>
                            <option value="Turno ADM 1">Turno ADM 1</option>
                            <option value="Turno ADM 2">Turno ADM 2</option>
                            <option value="Turno A">Turno A </option>
                            <option value="Turno B ">Turno B</option>
                            <option value="Turno C ">Turno C</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Líder Responsável</label>
                    <input type="text" id="edit-func-lider"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"
                           placeholder="Nome do líder responsável">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Admissão</label>
                    <input type="date" id="edit-func-admissao"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                </div>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-2">
                    <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
                        <i class="fas fa-id-card"></i> Dados da CNH <span class="text-xs font-normal text-gray-500">(Obrigatório para Motoristas)</span>
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Número CNH</label>
                            <input type="text" id="edit-func-cnh" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Expedição</label>
                            <input type="date" id="edit-func-cnh-expedicao" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Vencimento</label>
                            <input type="date" id="edit-func-cnh-vencimento" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Foto da CNH</label>
                        <div class="flex items-center gap-2">
                            <input type="file" id="edit-func-cnh-foto" accept="image/*" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            <button type="button" id="btn-ver-cnh" class="hidden px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" title="Ver foto atual"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end gap-2 pt-2">
                    <button type="button" onclick="fecharModalEditarFuncionario()" 
                            class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        Cancelar
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-[#5D5CDE] text-white hover:bg-[#4A4BC9] rounded">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-historico-funcionario" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-3xl w-full mx-4">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Histórico do Funcionário</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300">
                        <span id="hist-func-nome" class="font-medium"></span>
                        <span class="mx-1 text-gray-400">•</span>
                        Matrícula <span id="hist-func-matricula" class="font-mono"></span>
                    </p>
                    <p id="hist-func-cargo" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
                </div>
                <button type="button" onclick="fecharModalHistoricoFuncionario()"
                        class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 text-sm">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data/Hora</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tipo</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Descrição</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Usuário</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Detalhes</th>
                        </tr>
                    </thead>
                    <tbody id="historico-funcionario-lista" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    </tbody>
                </table>
                <div id="historico-funcionario-vazio" class="p-6 text-center text-sm text-gray-500 dark:text-gray-400 hidden">
                    Nenhum registro de histórico para este funcionário.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Autenticação -->
    <div id="modal-auth" class="modal">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Entrar</h3>
            <form id="form-auth" class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">E-mail</label>
                    <input type="email" id="auth-email" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Senha</label>
                    <input type="password" id="auth-password" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                </div>
                <div class="flex justify-end gap-2 pt-2">
                    <button type="button" id="auth-cancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancelar</button>
                    <button type="button" id="auth-signup" class="px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded">Criar Conta</button>
                    <button type="submit" class="px-4 py-2 bg-[#5D5CDE] text-white hover:bg-[#4A4BC9] rounded">Entrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="message-container" class="fixed top-4 right-4 z-50"></div>

    <script>
        // ===== CONFIGURAÇÃO DO SUPABASE =====
        const SUPABASE_URL = 'https://rnuuvxhbbhoasxiemqiq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJudXV2eGhiYmhvYXN4aWVtcWlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MDM2MTgsImV4cCI6MjA3OTA3OTYxOH0.Upj3Zx7vtEjLjAOaz4mqpgsODX2crJ4Wc576Awkrgqo';

        // Inicialização segura: se o UMD do Supabase não carregar, opera offline
        const sb = (typeof supabase !== 'undefined' && supabase) ? supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;
        let session = null;

        // FLAGS DE CARREGAMENTO (para evitar recarregar desnecessariamente do DB)
        let funcionariosLoadedFromDB = false;
        let faltasLoadedFromDB = false;
        let historicoLoadedFromDB = false;

        // ADICIONADO: estado de paginação/filtragem
        let funcionariosFiltrados = [];
        let paginaFunc = 1;
        const TAM_PAG_FUNC = 50;

        // Mostrar aviso de offline apenas uma vez
        let notificouFalhaConexao = false;

        // ===== DADOS LOCAIS (fallback) =====
        let funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
        let faltas = JSON.parse(localStorage.getItem('faltas') || '[]');
        let historico = JSON.parse(localStorage.getItem('historico') || '[]');
        let usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
        let usuariosFonte = 'local';
        let usuarioEditandoPermissoes = null;

        // ===== UTILS =====
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // INSERIDO: normalizador de datas e base estática dos funcionários
        function normalizarAdmissao(dataStr) {
            if (!dataStr) return null;
            if (dataStr.includes('/')) {
                const [dia, mes, ano] = dataStr.split('/');
                return `${ano}-${mes.padStart(2,'0')}-${dia.padStart(2,'0')}`;
            }
            return dataStr;
        }

        function gerarIdLocal() {
            return `${Date.now()}-${Math.random().toString(36).slice(2,8)}`;
        }

         const FUNCIONARIOS_BASE = [
            {"empresa": 25, "cadastro": 622468, "nome": "ACASSIO VIEIRA RIBEIRO", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 622908, "nome": "ADAIR ANTONIO BENTO", "cargo": "SUP DE IRRIGACAO", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "22/02/2013"},
            {"empresa": 25, "cadastro": 620720, "nome": "ADALBERTO DOS SANTOS GOMES", "cargo": "MOTORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "19/04/2013"},
            {"empresa": 25, "cadastro": 622055, "nome": "ADAO ADELINO DA COSTA", "cargo": "OP DE PA CARREG AGR I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "25/09/2018"},
            {"empresa": 25, "cadastro": 624527, "nome": "ADEMILSON SILVA DO VALE", "cargo": "TRATORISTA II", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "01/07/2025"},
            {"empresa": 25, "cadastro": 624042, "nome": "ADEMILSON VICENTE GOMES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "12/06/2024"},
            {"empresa": 25, "cadastro": 623950, "nome": "ADONES SOARES DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "23/04/2024"},
            {"empresa": 25, "cadastro": 624290, "nome": "ADRIANA MARIA DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 624407, "nome": "ADRIANO SILVA DOS SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "08/05/2025"},
            {"empresa": 25, "cadastro": 623606, "nome": "ADRIANO TEIXEIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "10/05/2023"},
            {"empresa": 25, "cadastro": 622644, "nome": "ALBANIR BARAUNA DE SOUZA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "22/04/2019"},
            {"empresa": 25, "cadastro": 622737, "nome": "ALCIDES ARAUJO DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "22/04/2021"},
            {"empresa": 25, "cadastro": 623057, "nome": "ALEMAR JUNIOR VIEIRA DANTAS", "cargo": "ENC DE CONTROLE PRAGAS E DOENC", "descricaoLocal": "PESQUISA E DESENV - CAMBUI", "admissao": "18/03/2022"},
            {"empresa": 25, "cadastro": 622577, "nome": "ALESSANDRA NEVES MARQUES", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "05/04/2021"},
            {"empresa": 25, "cadastro": 622951, "nome": "ALEXANDRE DIAS FERNANDES", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/02/2014"},
            {"empresa": 25, "cadastro": 622670, "nome": "ALMIR DA SILVA SOUZA", "cargo": "SUP DE PLANEJAMENTO AGRICOLA", "descricaoLocal": "ENC SETOR E TEC AGR - CAMBUI", "admissao": "03/05/2018"},
            {"empresa": 25, "cadastro": 622672, "nome": "ALOISIO APARECIDO LOPES", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "18/04/2019"},
            {"empresa": 25, "cadastro": 623106, "nome": "ANA PAULA BARROS DO NASCIMENTO SILVA", "cargo": "BALANCEIRO II", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624474, "nome": "ANA PAULA MENDES DE MARIA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 622953, "nome": "ANDERSON OLIVEIRA DA SILVA", "cargo": "ENC DE IRRIGACAO", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "19/07/2021"},
            {"empresa": 25, "cadastro": 623839, "nome": "ANDRE FRANCISCO DE MOURA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "07/03/2024"},
            {"empresa": 25, "cadastro": 622722, "nome": "ANDRE LUIZ GOMES DA SILVA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "19/04/2021"},
            {"empresa": 25, "cadastro": 623524, "nome": "ANDRESON SANTOS DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "10/04/2023"},
            {"empresa": 25, "cadastro": 623544, "nome": "ANTONIA DAS GRACAS DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "13/04/2023"},
            {"empresa": 25, "cadastro": 623952, "nome": "ANTONIO APARECIDO DE CASTRO SOARES", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "23/04/2024"},
            {"empresa": 25, "cadastro": 623662, "nome": "ANTONIO ARAGAO DE MATOS", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "12/06/2023"},
            {"empresa": 25, "cadastro": 622948, "nome": "ANTONIO BATISTA BEZERRA", "cargo": "AUX DE ARMAZENAGEM AGR", "descricaoLocal": "REFLORESTAMENTO SHEGO - CAMBUI", "admissao": "11/02/2014"},
            {"empresa": 25, "cadastro": 620651, "nome": "ANTONIO BENTO FERREIRA", "cargo": "MOTORISTA I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "10/04/2013"},
            {"empresa": 25, "cadastro": 623181, "nome": "ANTONIO CARLOS MENDES", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "18/04/2022"},
            {"empresa": 25, "cadastro": 623210, "nome": "ANTONIO HORACIO DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "25/04/2022"},
            {"empresa": 25, "cadastro": 622520, "nome": "ANTONIO JOSE DE MATOS NETO", "cargo": "AUX DE ARMAZENAGEM AGR", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "25/02/1997"},
            {"empresa": 25, "cadastro": 623126, "nome": "ANTONIO MARCOS BATISTA DE SOUZA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 622843, "nome": "ARDILEU SILVA DE OLIVEIRA", "cargo": "LIDER DE PATIO", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "28/04/2014"},
            {"empresa": 25, "cadastro": 624080, "nome": "ARISTEU ARAUJO FERREIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "08/07/2024"},
            {"empresa": 25, "cadastro": 624554, "nome": "ARISTIDES SABINO DE MELO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "21/07/2025"},
            {"empresa": 25, "cadastro": 623879, "nome": "ARNALDO FRANCISCO DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "27/03/2024"},
            {"empresa": 25, "cadastro": 623840, "nome": "ARTHUR SOUSA RAMOS MARTINS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "PESQUISA E DESENV - CAMBUI", "admissao": "07/03/2024"},
            {"empresa": 25, "cadastro": 621848, "nome": "ARY ALVES DE OLIVEIRA", "cargo": "TRATORISTA I", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "11/05/2017"},
            {"empresa": 25, "cadastro": 624233, "nome": "ASSIS BARBOSA DOS SANTOS", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 623639, "nome": "BRUNO BORGES FERREIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "PESQUISA E DESENV - CAMBUI", "admissao": "29/05/2023"},
            {"empresa": 25, "cadastro": 622591, "nome": "BRUNO RODRIGUES DE SOUSA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "05/04/2021"},
            {"empresa": 25, "cadastro": 624595, "nome": "BRUNO SANTOS PIRES", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "25/08/2025"},
            {"empresa": 25, "cadastro": 624428, "nome": "CAIQUE SANTOS DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "APOIO PATIO - CAMBUI", "admissao": "16/05/2025"},
            {"empresa": 25, "cadastro": 624294, "nome": "CAMILA OLIVEIRA MORAES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 622516, "nome": "CARLOS ALBERTO DA SILVA SOARES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "14/07/2020"},
            {"empresa": 25, "cadastro": 624295, "nome": "CARLOS ALBERTO PEREIRA COSTA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 623423, "nome": "CARLOS ALEXANDRE DE SOUZA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "07/02/2023"},
            {"empresa": 25, "cadastro": 623997, "nome": "CARLOS ANTONIO ALVES SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "09/05/2024"},
            {"empresa": 25, "cadastro": 622535, "nome": "CARLOS ANTONIO DE JESUS FERREIRA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "26/01/2011"},
            {"empresa": 25, "cadastro": 623811, "nome": "CARLOS EDUARDO SOUSA MENDES", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 622638, "nome": "CARLOS HENRIQUE BEZERRA DOS SANTOS", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "13/02/2019"},
            {"empresa": 25, "cadastro": 623608, "nome": "CARLOS SERGIO SOUSA CRUZ CHAVES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "10/05/2023"},
            {"empresa": 25, "cadastro": 622905, "nome": "CARLOS SOARES DA SILVA", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "21/02/2013"},
            {"empresa": 25, "cadastro": 621724, "nome": "CASTRO LIMA SOUZA", "cargo": "CONTROLADOR DE TRAFEGO I", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "20/03/2017"},
            {"empresa": 25, "cadastro": 624210, "nome": "CELIO ALVES TRAQUINO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "11/02/2025"},
            {"empresa": 25, "cadastro": 624211, "nome": "CELIO DE LIMA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "11/02/2025"},
            {"empresa": 25, "cadastro": 623050, "nome": "CELIO LUIZ DE FARIA", "cargo": "MOTORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "15/03/2022"},
            {"empresa": 25, "cadastro": 623320, "nome": "CELIO PAULO DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "09/08/2022"},
            {"empresa": 25, "cadastro": 622529, "nome": "CICERO ALVES BEZERRA", "cargo": "TECNICO AGRICOLA I D", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "27/01/2012"},
            {"empresa": 25, "cadastro": 623159, "nome": "CICERO NOGUEIRA DA SILVA", "cargo": "MOTORISTA PRANCHA", "descricaoLocal": "CAMINHAO PRANCHA - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 623109, "nome": "CLARICE GUIMARAES VIEIRA GOMES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 623422, "nome": "CLAUDINEI JOSE DE OLIVEIRA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "07/02/2023"},
            {"empresa": 25, "cadastro": 624212, "nome": "CLAUDINEI RODRIGUES DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "11/02/2025"},
            {"empresa": 25, "cadastro": 624406, "nome": "CLEISON CARLOS VIEIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "08/05/2025"},
            {"empresa": 25, "cadastro": 622537, "nome": "COSME ALVES DE OLIVEIRA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "27/01/2012"},
            {"empresa": 25, "cadastro": 624319, "nome": "COSME FERREIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "12/04/2025"},
            {"empresa": 25, "cadastro": 622475, "nome": "COSME VICTOR SOARES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624066, "nome": "CRISLAN ALVES PEREIRA", "cargo": "NOTEIRO", "descricaoLocal": "NOTEIRO COL MECANIZADA - CAMBUI", "admissao": "26/06/2024"},
            {"empresa": 25, "cadastro": 624496, "nome": "DAIANE DO NASCIMENTO SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 624371, "nome": "DAMIAO IZIDIO DA SILVA", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "25/04/2025"},
            {"empresa": 25, "cadastro": 621802, "nome": "DAMIAO MARCELINO DE MIRANDA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "26/04/2017"},
            {"empresa": 25, "cadastro": 624538, "nome": "DANIEL SOUZA DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "03/07/2025"},
            {"empresa": 25, "cadastro": 624477, "nome": "DANIELE RODRIGUES QUEIROZ", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623538, "nome": "DANILO DOS SANTOS CORREA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "11/04/2023"},
            {"empresa": 25, "cadastro": 623890, "nome": "DANILO LUCAS FREIRE", "cargo": "OP DE PA CARREG AGR III", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 622900, "nome": "DAVID SOARES DOS SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "10/05/2012"},
            {"empresa": 25, "cadastro": 622838, "nome": "DEJANIR ANTONIO FILHO", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "19/03/2014"},
            {"empresa": 25, "cadastro": 622894, "nome": "DELMIRO PINHEIRO NETO", "cargo": "CASEIRO", "descricaoLocal": "CASEIROS - CAMBUI", "admissao": "01/03/2014"},
            {"empresa": 25, "cadastro": 622724, "nome": "DENILSON DA SILVA SANTOS", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "19/04/2021"},
            {"empresa": 25, "cadastro": 622286, "nome": "DESCIMAR NUNES DE ALMEIDA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 623187, "nome": "DIOGO SOARES DOS SANTOS", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "18/04/2022"},
            {"empresa": 25, "cadastro": 622295, "nome": "DIONES SANTANA DAMASCENA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622909, "nome": "DIRCEU JOSE BARBOSA", "cargo": "LIDER DE IRRIGACAO", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "22/02/2013"},
            {"empresa": 25, "cadastro": 622935, "nome": "DOMINGOS PEREIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "17/02/2014"},
            {"empresa": 25, "cadastro": 622931, "nome": "DONIZETE RIBEIRO DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "11/02/2014"},
            {"empresa": 25, "cadastro": 622916, "nome": "DOUGLAS SILVA DIAMANTINO", "cargo": "TRATORISTA I", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "17/06/2013"},
            {"empresa": 25, "cadastro": 622892, "nome": "EDILSON GARCIA", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "01/02/2017"},
            {"empresa": 25, "cadastro": 622876, "nome": "EDIMARCIO PEREIRA FELIX", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "12/03/2014"},
            {"empresa": 25, "cadastro": 622476, "nome": "EDIMILSON CANDIDO DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624390, "nome": "EDIMILSON RESENDE XAVIER", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 620767, "nome": "EDIO QUINTINO DA ROCHA JUNIOR", "cargo": "MOTORISTA I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "24/04/2013"},
            {"empresa": 25, "cadastro": 622844, "nome": "EDIVALDO ALVES DO NASCIMENTO", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "29/04/2014"},
            {"empresa": 25, "cadastro": 622490, "nome": "EDIVALDO FRANCISCO DOURADO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "22/04/2020"},
            {"empresa": 25, "cadastro": 622839, "nome": "EDIVALDO PEREIRA DA SILVA", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "19/03/2014"},
            {"empresa": 25, "cadastro": 624478, "nome": "EDLEUZA DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623047, "nome": "EDMAR MARQUES DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "15/03/2022"},
            {"empresa": 25, "cadastro": 620602, "nome": "EDMILSON JOSE DA SILVA", "cargo": "MOTORISTA PRANCHA", "descricaoLocal": "CAMINHAO PRANCHA - CAMBUI", "admissao": "08/04/2013"},
            {"empresa": 25, "cadastro": 623857, "nome": "EDSON CAVALCANTE DA SILVA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "13/03/2024"},
            {"empresa": 25, "cadastro": 623943, "nome": "EDSON DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "18/04/2024"},
            {"empresa": 25, "cadastro": 622470, "nome": "EDSON FRANCELINO DE JESUS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622637, "nome": "EDUARDO TEIXEIRA MARTINS", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "13/02/2019"},
            {"empresa": 25, "cadastro": 624479, "nome": "ELAINE PEREIRA DA ROCHA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 624178, "nome": "ELENILDO PEREIRA DE SOUZA", "cargo": "SUP DE CCT", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "23/10/2024"},
            {"empresa": 25, "cadastro": 623660, "nome": "ELI FERREIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "12/06/2023"},
            {"empresa": 25, "cadastro": 623898, "nome": "ELIANE MARIA DA CUNHA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 623858, "nome": "ELIAS DE ALMEIDA SANTOS", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "13/03/2024"},
            {"empresa": 25, "cadastro": 624232, "nome": "ELIAS NUNES PEREIRA FILHO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 623156, "nome": "ELISEU MACIEL", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 624481, "nome": "ELIVANIA GOMES DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 624411, "nome": "ELIVELTON NERES BARBOSA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/05/2025"},
            {"empresa": 25, "cadastro": 624069, "nome": "EMANUEL MESSIAS SANTANA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "26/06/2024"},
            {"empresa": 25, "cadastro": 623881, "nome": "EMERSON DA SILVA ALENCAR", "cargo": "OP DE AUTOPR (UNIPORTE) II", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "27/03/2024"},
            {"empresa": 25, "cadastro": 622569, "nome": "EMERSON DE SOUZA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "05/04/2021"},
            {"empresa": 25, "cadastro": 622901, "nome": "EMERSON FREITAS FONSECA", "cargo": "MECANICO DE IMPLEMENTOS I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "15/05/2012"},
            {"empresa": 25, "cadastro": 621028, "nome": "ENILTON MARTINS DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "03/03/2014"},
            {"empresa": 25, "cadastro": 621156, "nome": "ERALDO LOURENCO GOMES", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/02/2015"},
            {"empresa": 25, "cadastro": 622532, "nome": "ERENILTON FERREIRA ALVES", "cargo": "OP DE AUTOPR (UNIPORTE) I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "13/03/2008"},
            {"empresa": 25, "cadastro": 624148, "nome": "ERICA LIMA DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "06/09/2024"},
            {"empresa": 25, "cadastro": 624424, "nome": "ERIVAN BARBOSA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "10/05/2025"},
            {"empresa": 25, "cadastro": 622296, "nome": "ERONILDO SANTOS DE LIMA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 623911, "nome": "ESMERALDA DA SILVA SOUSA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 622466, "nome": "EURIPEDES CRUVINEL DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 623189, "nome": "EVERALDO JOSE DA SILVA", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "20/04/2022"},
            {"empresa": 25, "cadastro": 623931, "nome": "EVERTON MEIRA DA SILVA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2024"},
            {"empresa": 25, "cadastro": 622946, "nome": "EVERTON TAVARES DOS SANTOS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "10/02/2014"},
            {"empresa": 25, "cadastro": 621573, "nome": "EZIO DE OLIVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "04/08/2016"},
            {"empresa": 25, "cadastro": 622467, "nome": "FABIANA MARIA SILVA DE LIMA", "cargo": "BALANCEIRO II", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 622771, "nome": "FABIANO DOS SANTOS SILVA", "cargo": "TRATORISTA I", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "29/04/2021"},
            {"empresa": 25, "cadastro": 622877, "nome": "FABIO DE ALMEIDA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "19/03/2014"},
            {"empresa": 25, "cadastro": 622477, "nome": "FABIO DIVINO DE SOUZA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624504, "nome": "FABIO DUTRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "05/06/2025"},
            {"empresa": 25, "cadastro": 622086, "nome": "FABIO JULIO DA SILVA PIRES", "cargo": "LIDER DE PATIO", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "12/02/2019"},
            {"empresa": 25, "cadastro": 622377, "nome": "FERNANDO DA SILVA PINHEIRO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "20/06/2020"},
            {"empresa": 25, "cadastro": 622630, "nome": "FERNANDO HENRIQUE DE OLIVEIRA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "09/02/2019"},
            {"empresa": 25, "cadastro": 623440, "nome": "FLAVIO AFONSO DA CUNHA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "13/02/2023"},
            {"empresa": 25, "cadastro": 624531, "nome": "FRANCIELI FERNANDES BARBOSA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "01/07/2025"},
            {"empresa": 25, "cadastro": 624455, "nome": "FRANCINEI HENRIQUE DE CASTRO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "20/05/2025"},
            {"empresa": 25, "cadastro": 623166, "nome": "FRANCINETE CAFE CAMPOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 622575, "nome": "FRANCISCA APARECIDA MATIAS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "05/04/2021"},
            {"empresa": 25, "cadastro": 623913, "nome": "FRANCISCA FRANCIELMA DE FRANCA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 621505, "nome": "FRANCISCO ADELSON DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "06/05/2016"},
            {"empresa": 25, "cadastro": 621707, "nome": "FRANCISCO CARLOS CALIXTO", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "13/02/2017"},
            {"empresa": 25, "cadastro": 622645, "nome": "FRANCISCO DAS CHAGAS DE MEDEIROS", "cargo": "MOTORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "22/04/2019"},
            {"empresa": 25, "cadastro": 623859, "nome": "FRANCISCO DAS CHAGAS SABINO", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "13/03/2024"},
            {"empresa": 25, "cadastro": 620624, "nome": "FRANCISCO DE ASSIS MARCELINO DE MIRANDA", "cargo": "OP DE MOTONIVEL (PATR) I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "09/04/2013"},
            {"empresa": 25, "cadastro": 623687, "nome": "FRANCISCO DE ASSIS RODRIGUES SILVA", "cargo": "CASEIRO", "descricaoLocal": "CASEIROS - CAMBUI", "admissao": "07/07/2023"},
            {"empresa": 25, "cadastro": 622945, "nome": "FRANCISCO FELIPE GOMES", "cargo": "MOTORISTA I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "06/05/2016"},
            {"empresa": 25, "cadastro": 623040, "nome": "FRANCISCO FERNANDES DANTAS", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "15/03/2022"},
            {"empresa": 25, "cadastro": 622663, "nome": "FRANCISCO HENRIQUE MEDEIROS OLIVEIRA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 623829, "nome": "FRANCISCO JUNIOR ALVES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "23/02/2024"},
            {"empresa": 25, "cadastro": 622514, "nome": "FRANCISCO MARTINS DE PLACIDO", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "07/07/2020"},
            {"empresa": 25, "cadastro": 622929, "nome": "FRANCISCO TAVARES DE SOUZA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "10/02/2014"},
            {"empresa": 25, "cadastro": 624532, "nome": "GABRIEL FERREIRA GOES", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "01/07/2025"},
            {"empresa": 25, "cadastro": 624324, "nome": "GABRIEL LUIZ DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "APOIO PATIO - CAMBUI", "admissao": "16/04/2025"},
            {"empresa": 25, "cadastro": 623814, "nome": "GEANDERSON JESUS DA SILVA BERNARDES", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 623713, "nome": "GECIANE SILVA SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "23/08/2023"},
            {"empresa": 25, "cadastro": 622667, "nome": "GILBERTO LUIS DE MELO", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 624467, "nome": "GILMAR PEREIRA DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 622509, "nome": "GILSON CORDEIRO DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "12/05/2020"},
            {"empresa": 25, "cadastro": 624468, "nome": "GILSON PRADO PARREIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "APOIO PATIO - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 623065, "nome": "GILSON RODRIGUES DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "24/08/2016"},
            {"empresa": 25, "cadastro": 621330, "nome": "GILSON ROSA DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "19/02/2016"},
            {"empresa": 25, "cadastro": 624326, "nome": "GILVAN LAURENTINO DOS SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "16/04/2025"},
            {"empresa": 25, "cadastro": 622297, "nome": "GLEIDSTON RIBEIRO DE SOUSA", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 621709, "nome": "GLEISON KARAMOTO SILVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "13/02/2017"},
            {"empresa": 25, "cadastro": 623815, "nome": "GRAZIELE ALVES DO PRADO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 624465, "nome": "GUILHERME EDUARDO FERNANDES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 622671, "nome": "GUTEMBERG GOMES DO NASCIMENTO", "cargo": "CONTROLADOR DE TRAFEGO I", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "11/04/2019"},
            {"empresa": 25, "cadastro": 624263, "nome": "HARATUMA SANTOS SILVA KARAJA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "26/03/2025"},
            {"empresa": 25, "cadastro": 600007, "nome": "HELENO CARDOSO DA COSTA", "cargo": "ENC DE CONSERV DE ESTRADAS", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "30/05/2009"},
            {"empresa": 25, "cadastro": 622485, "nome": "HELIO CASTRO DO CANTO", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "20/04/2020"},
            {"empresa": 25, "cadastro": 620599, "nome": "HELIO DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "08/04/2013"},
            {"empresa": 25, "cadastro": 622523, "nome": "HELIO VIEIRA DE FREITAS", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "26/01/2009"},
            {"empresa": 25, "cadastro": 622378, "nome": "HERLI MENDES DE MELO MENEZES", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "20/06/2020"},
            {"empresa": 25, "cadastro": 624128, "nome": "HIAGO PERES GOULART", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "27/08/2024"},
            {"empresa": 25, "cadastro": 623180, "nome": "HUEDEM GONCALVES EVARISTO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "16/04/2022"},
            {"empresa": 25, "cadastro": 623052, "nome": "IBONEZ BENTO ROSEMIRO", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/03/2022"},
            {"empresa": 25, "cadastro": 624392, "nome": "ITAMAR ANTUNES MACIEL", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 623225, "nome": "JAILSON FERREIRA ALVES", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "04/05/2022"},
            {"empresa": 25, "cadastro": 624482, "nome": "JANAINA DE MATOS PEREIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623115, "nome": "JANETE ALVES PEREIRA MORAIS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 622533, "nome": "JARBAS PIEROTE SOUZA", "cargo": "GERENTE AGRICOLA", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "01/03/2010"},
            {"empresa": 25, "cadastro": 623751, "nome": "JARDEMILSON JOSE DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "07/10/2023"},
            {"empresa": 25, "cadastro": 623558, "nome": "JEAN ARAUJO DA SILVA", "cargo": "LIDER COLHEITA MECANIZADA II", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "14/04/2023"},
            {"empresa": 25, "cadastro": 622288, "nome": "JEFERSON ARANTES BARBOSA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624249, "nome": "JEFERSON FREITAS SOUSA", "cargo": "TRATORISTA II", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "06/03/2025"},
            {"empresa": 25, "cadastro": 622082, "nome": "JEFERSON RODRIGUES", "cargo": "LIDER DE PATIO", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "12/02/2019"},
            {"empresa": 25, "cadastro": 620711, "nome": "JEOVA RISEMIRO DA SILVA", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "18/04/2013"},
            {"empresa": 25, "cadastro": 624188, "nome": "JEREMIAS SILVA DE SOUSA", "cargo": "TRAINEE PROCESSOS AGRICOLA", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "08/11/2024"},
            {"empresa": 25, "cadastro": 623067, "nome": "JERFFERSON AURINO DA SILVA ALMEIDA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "25/03/2022"},
            {"empresa": 25, "cadastro": 624108, "nome": "JERONIMO FLORENCIO TAVARES", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "27/07/2024"},
            {"empresa": 25, "cadastro": 622887, "nome": "JOAO BATISTA ALVES DE LIMA", "cargo": "TRATORISTA I", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "11/05/2017"},
            {"empresa": 25, "cadastro": 620870, "nome": "JOAO BATISTA FERREIRA BORGES", "cargo": "LIDER DE C MECANIZADA E QUEIMA", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "21/05/2013"},
            {"empresa": 25, "cadastro": 624466, "nome": "JOAO BATISTA MACHADO", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 624157, "nome": "JOAO BATISTA RODRIGUES DE SOUZA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "12/09/2024"},
            {"empresa": 25, "cadastro": 622522, "nome": "JOAO DIAS PEREIRA", "cargo": "TRATORISTA I", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "26/01/2009"},
            {"empresa": 25, "cadastro": 623651, "nome": "JOAO FELIPE GOMES SANTOS", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "07/06/2023"},
            {"empresa": 25, "cadastro": 624022, "nome": "JOAO PAULO DE ARAUJO", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "15/05/2024"},
            {"empresa": 25, "cadastro": 622299, "nome": "JOAO PEREIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622668, "nome": "JOAO VICTOR FREITAS VILELA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 622890, "nome": "JOAQUIM SANTOS BRITO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/02/2019"},
            {"empresa": 25, "cadastro": 622539, "nome": "JOEL PAULO NASCIMENTO DOS SANTOS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/03/2021"},
            {"empresa": 25, "cadastro": 624393, "nome": "JONAS ALBERTO DE ALMEIDA CAVALCANTE", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 624414, "nome": "JORGE HENRIQUE DE SOUSA SOARES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/05/2025"},
            {"empresa": 25, "cadastro": 622924, "nome": "JORGE VITOR DA SILVA VIANA", "cargo": "TRATORISTA II", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "03/02/2014"},
            {"empresa": 25, "cadastro": 622088, "nome": "JOSE ADAO PEREIRA DA ROCHA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "15/02/2019"},
            {"empresa": 25, "cadastro": 620713, "nome": "JOSE ADRIANO DA SILVA", "cargo": "LIDER COLHEITA MECANIZADA", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "18/04/2013"},
            {"empresa": 25, "cadastro": 620687, "nome": "JOSE APARECIDO DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/04/2013"},
            {"empresa": 25, "cadastro": 623728, "nome": "JOSE APARECIDO DOS SANTOS", "cargo": "ENC DE MECANIZACAO", "descricaoLocal": "ENC SETOR E TEC AGR - CAMBUI", "admissao": "09/09/2023"},
            {"empresa": 25, "cadastro": 621340, "nome": "JOSE APARECIDO DUTRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "19/02/2016"},
            {"empresa": 25, "cadastro": 623753, "nome": "JOSE AUGUSTO MAXIMINIO BATISTA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "07/10/2023"},
            {"empresa": 25, "cadastro": 623446, "nome": "JOSE CARLOS SILVA DOS SANTOS", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "14/02/2023"},
            {"empresa": 25, "cadastro": 624558, "nome": "JOSE CICERO SILVA SANTOS", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "21/07/2025"},
            {"empresa": 25, "cadastro": 622631, "nome": "JOSE CLAUDIO DOS SANTOS CRUZ", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/02/2019"},
            {"empresa": 25, "cadastro": 620727, "nome": "JOSE CLOVIS DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "19/04/2013"},
            {"empresa": 25, "cadastro": 622661, "nome": "JOSE DE FREITAS JUNIOR", "cargo": "LIDER DE CONTROLE DE INCENDIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 623096, "nome": "JOSE EILSON TEOFILO", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624571, "nome": "JOSE FERNANDES DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "04/08/2025"},
            {"empresa": 25, "cadastro": 623818, "nome": "JOSE FERREIRA DE OLIVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 622481, "nome": "JOSE FRANCISCO FERNANDES", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622524, "nome": "JOSE LEMES DA SILVA", "cargo": "OP DE PA CARREG AGR I", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "01/02/2012"},
            {"empresa": 25, "cadastro": 622528, "nome": "JOSE LOPES DE JESUS", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "19/02/2010"},
            {"empresa": 25, "cadastro": 623116, "nome": "JOSE LOURENCO SOARES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 622646, "nome": "JOSE MARCOS MIRANDA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "22/04/2019"},
            {"empresa": 25, "cadastro": 624325, "nome": "JOSE MARIA DE MELO", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "16/04/2025"},
            {"empresa": 25, "cadastro": 624544, "nome": "JOSE MORAIS DA SILVA NETO", "cargo": "NOTEIRO", "descricaoLocal": "NOTEIRO COL MECANIZADA - CAMBUI", "admissao": "08/07/2025"},
            {"empresa": 25, "cadastro": 623102, "nome": "JOSE NILTON OLIVEIRA ARAUJO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624354, "nome": "JOSE RONALDO DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "24/04/2025"},
            {"empresa": 25, "cadastro": 624429, "nome": "JOSE WILSON DE OLIVEIRA JUNIOR", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "16/05/2025"},
            {"empresa": 25, "cadastro": 621341, "nome": "JOSE WILSON MECENAS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "19/02/2016"},
            {"empresa": 25, "cadastro": 622179, "nome": "JOSELIAS FREIRE DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "30/04/2019"},
            {"empresa": 25, "cadastro": 620629, "nome": "JOSENILTO FERREIRA SANTANA", "cargo": "OP DE RETROESCAVADEIRA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2013"},
            {"empresa": 25, "cadastro": 623893, "nome": "JOSILENE MEDEIROS DE OLIVEIRA CAMPOS", "cargo": "ASSISTENTE ADMINIST", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 620625, "nome": "JOSIMAR DANTAS DOS SANTOS", "cargo": "LIDER DE IRRIGACAO", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2013"},
            {"empresa": 25, "cadastro": 620604, "nome": "JOSIMAR SIQUEIRA DE LIMA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "08/04/2013"},
            {"empresa": 25, "cadastro": 623168, "nome": "JOSUE CORDEIRO DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 624241, "nome": "JOSUE JUNIOR PEREIRA SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "26/02/2025"},
            {"empresa": 25, "cadastro": 621158, "nome": "JUAREZ FERREIRA DIAS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/02/2015"},
            {"empresa": 25, "cadastro": 623900, "nome": "JUCIARA OLIVEIRA DE SOUZA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 622328, "nome": "JULIANO APARECIDO DE BORTOLI", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "28/04/2020"},
            {"empresa": 25, "cadastro": 624549, "nome": "JULIANO CESAR PINHEIRO RABELO", "cargo": "TRATORISTA I", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "14/07/2025"},
            {"empresa": 25, "cadastro": 623215, "nome": "JULIANO PEREIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "25/04/2022"},
            {"empresa": 25, "cadastro": 623819, "nome": "JULIANO PEREIRA FERNANDES", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 624127, "nome": "JULIO CESAR ALVES", "cargo": "LIDER COLHEITA MECANIZADA", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "27/08/2024"},
            {"empresa": 25, "cadastro": 623483, "nome": "JULIO CESAR COELHO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "10/04/2023"},
            {"empresa": 25, "cadastro": 623188, "nome": "JULIVALDO BEZERRA RODRIGUES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "20/04/2022"},
            {"empresa": 25, "cadastro": 622510, "nome": "JUNIOR LOURENCO DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "12/05/2020"},
            {"empresa": 25, "cadastro": 623097, "nome": "JURAELSON PEREIRA COSTA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 623634, "nome": "JURANDIR ALVES DA SILVA FILHO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "24/05/2023"},
            {"empresa": 25, "cadastro": 624431, "nome": "KAIRON HENRIQUE DO NASCIMENTO LIMA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "16/05/2025"},
            {"empresa": 25, "cadastro": 624311, "nome": "KAISSON RAFAEL MENDONCA DA SILVA", "cargo": "NOTEIRO", "descricaoLocal": "NOTEIRO COL MECANIZADA - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 624229, "nome": "KAYQUE DA SILVA LOPES", "cargo": "MOTORISTA PRANCHA", "descricaoLocal": "CAMINHAO PRANCHA - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 624483, "nome": "KENIA CRISTINA DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 622471, "nome": "KLEBER MARTINS OLIVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624230, "nome": "KLESYO JOSE DA CRUZ", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 624242, "nome": "LAEL CARLOS LOURENCO DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "26/02/2025"},
            {"empresa": 25, "cadastro": 623901, "nome": "LAZARA SOARES DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 624376, "nome": "LEANDRO FERREIRA MARTINS", "cargo": "OP DE MOTONIVEL (PATR) I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "25/04/2025"},
            {"empresa": 25, "cadastro": 624194, "nome": "LEANDRO GONCALVES", "cargo": "SUP DE OPERACOES AGRICOLA", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "16/11/2024"},
            {"empresa": 25, "cadastro": 620681, "nome": "LEOMAR SILVA SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "17/04/2013"},
            {"empresa": 25, "cadastro": 624396, "nome": "LEONARDO FERREIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 623702, "nome": "LEONARDO JOSE DE LIMA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "01/08/2023"},
            {"empresa": 25, "cadastro": 624122, "nome": "LEONARDO MOREIRA SANTOS", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "26/08/2024"},
            {"empresa": 25, "cadastro": 624485, "nome": "LILIAN QUEIROZ DESSOTTI", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623042, "nome": "LINDOMAR CARDOSO MARQUES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "15/03/2022"},
            {"empresa": 25, "cadastro": 622498, "nome": "LINDOMAR ROSA RODRIGUES", "cargo": "MOTORISTA II", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "24/04/2020"},
            {"empresa": 25, "cadastro": 624534, "nome": "LORENA ANTONIA GONCALVES CRUZ", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "01/07/2025"},
            {"empresa": 25, "cadastro": 624397, "nome": "LUAN SOARES DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 624231, "nome": "LUANA FRANCISCA DA SILVA OLIVEIRA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 623679, "nome": "LUCAS GUILHERME FERREIRA DUTRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "26/06/2023"},
            {"empresa": 25, "cadastro": 623914, "nome": "LUCAS MESSIAS SANTOS DE OLIVEIRA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 622633, "nome": "LUCAS SOUSA DE LIMA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "13/02/2019"},
            {"empresa": 25, "cadastro": 624486, "nome": "LUCIANA FERREIRA BRAZ", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 622621, "nome": "LUCIANO DO NASCIMENTO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "23/04/2018"},
            {"empresa": 25, "cadastro": 623098, "nome": "LUCIANO SILVA MAGALHAES", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624040, "nome": "LUCIELE ARANTES VIEIRA BARCELOS", "cargo": "SECRETARIA", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "08/06/2024"},
            {"empresa": 25, "cadastro": 624152, "nome": "LUDIELY DOS SANTOS FERNANDES", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "12/09/2024"},
            {"empresa": 25, "cadastro": 624228, "nome": "LUIS DOS SANTOS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 622942, "nome": "LUIZ ALVES DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "24/02/2014"},
            {"empresa": 25, "cadastro": 624633, "nome": "LUIZ ANTONIO CIRQUEIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "09/09/2025"},
            {"empresa": 25, "cadastro": 623155, "nome": "LUIZ CARLOS DIAS", "cargo": "MOTORISTA I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 622904, "nome": "LUIZ CARLOS DOS SANTOS", "cargo": "OP DE CARREGADEIRA DE CANA", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "18/02/2013"},
            {"empresa": 25, "cadastro": 624377, "nome": "LUIZ CLAUDIO OLIVEIRA DE MELO", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "25/04/2025"},
            {"empresa": 25, "cadastro": 623627, "nome": "LUIZ DE OLIVEIRA", "cargo": "TRATORISTA II", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "23/05/2023"},
            {"empresa": 25, "cadastro": 624264, "nome": "LUIZ EDUARDO SANTOS SILVA", "cargo": "CONTROLADOR DE TRAFEGO III", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "26/03/2025"},
            {"empresa": 25, "cadastro": 622527, "nome": "LUIZ JOSE DE MEDEIROS NETO", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "13/03/2008"},
            {"empresa": 25, "cadastro": 624469, "nome": "MAILSON DE SOUZA COSTA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 622799, "nome": "MANACES DE SOUZA MIRANDA", "cargo": "NOTEIRO", "descricaoLocal": "NOTEIRO COL MECANIZADA - CAMBUI", "admissao": "11/05/2021"},
            {"empresa": 25, "cadastro": 623894, "nome": "MANOEL MESSIAS DE ARAUJO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 622486, "nome": "MARCELINO DA SILVA SOARES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "20/04/2020"},
            {"empresa": 25, "cadastro": 622884, "nome": "MARCELO AUGUSTO MARTINS DE FREITAS", "cargo": "ENC DE SETOR AGRICOLA", "descricaoLocal": "ENC SETOR E TEC AGR - CAMBUI", "admissao": "19/05/2016"},
            {"empresa": 25, "cadastro": 622930, "nome": "MARCELO DA SILVA CONCEICAO", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "11/02/2014"},
            {"empresa": 25, "cadastro": 622950, "nome": "MARCELO DA SILVA SOARES", "cargo": "OP DE AUTOPR (UNIPORTE) I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "20/04/2016"},
            {"empresa": 25, "cadastro": 624024, "nome": "MARCELO MENDES DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "15/05/2024"},
            {"empresa": 25, "cadastro": 622478, "nome": "MARCELO NOGUEIRA DE MOURA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622664, "nome": "MARCELO ROCHA MARTINS", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 622922, "nome": "MARCIEL FERREIRA DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "03/02/2014"},
            {"empresa": 25, "cadastro": 622487, "nome": "MARCIO ALVES DE BRITO", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "20/04/2020"},
            {"empresa": 25, "cadastro": 623934, "nome": "MARCIO CARLOS MARTINS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "16/04/2024"},
            {"empresa": 25, "cadastro": 624422, "nome": "MARCIO JOSE DA CRUZ", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO BATE VOLTA - CAMBUI", "admissao": "10/05/2025"},
            {"empresa": 25, "cadastro": 620580, "nome": "MARCIO LIMA FERREIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "08/04/2013"},
            {"empresa": 25, "cadastro": 623419, "nome": "MARCIO MACARIO BARBOSA DOS SANTOS", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "07/02/2023"},
            {"empresa": 25, "cadastro": 623249, "nome": "MARCIO MANOEL SOBRAL SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "20/05/2022"},
            {"empresa": 25, "cadastro": 622479, "nome": "MARCIO SANTOS ALVES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 622648, "nome": "MARCO ANTONIO DE OLIVEIRA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "22/04/2019"},
            {"empresa": 25, "cadastro": 622902, "nome": "MARCOS ANTONIO SOARES FERNANDES", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "08/05/2012"},
            {"empresa": 25, "cadastro": 622880, "nome": "MARCOS BORGES SANTOS", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "22/10/2015"},
            {"empresa": 25, "cadastro": 624129, "nome": "MARCOS FRANCISCO BARBOSA DA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "27/08/2024"},
            {"empresa": 25, "cadastro": 623628, "nome": "MARCOS GABRIEL ARAUJO DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "APLICACAO DE INSUMOS - CAMBUI", "admissao": "23/05/2023"},
            {"empresa": 25, "cadastro": 622472, "nome": "MARCOS NOBRE DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 623128, "nome": "MARCOS PAULO FERNANDES PEREIRA", "cargo": "TRATORISTA II", "descricaoLocal": "NONINO - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624025, "nome": "MARCOS VINICIUS EVARISTO SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "15/05/2024"},
            {"empresa": 25, "cadastro": 624301, "nome": "MARIA DA CONCEICAO DA SILVA SOUSA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 622874, "nome": "MARIA DAS DORES DANTAS DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "28/04/2014"},
            {"empresa": 25, "cadastro": 623442, "nome": "MARIA ELIZA FERREIRA DE SOUZA", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "13/02/2023"},
            {"empresa": 25, "cadastro": 622875, "nome": "MARIA EUNICE DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "18/04/2016"},
            {"empresa": 25, "cadastro": 624420, "nome": "MARIA EZILMA DE OLIVEIRA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/05/2025"},
            {"empresa": 25, "cadastro": 622134, "nome": "MARIA GERLANY GONCALVES RODRIGUES", "cargo": "BALANCEIRO II", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "15/04/2019"},
            {"empresa": 25, "cadastro": 622665, "nome": "MARIA JOSE DE MATOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 623916, "nome": "MARIA JOSE DOS SANTOS BATISTA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 623522, "nome": "MARIA LUCIA ALVES DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "10/04/2023"},
            {"empresa": 25, "cadastro": 623059, "nome": "MARIA TAVARES DA SILVA", "cargo": "BALANCEIRO II", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "18/03/2022"},
            {"empresa": 25, "cadastro": 622212, "nome": "MATHEUS FRANCISCO DA CUNHA SOUZA", "cargo": "ENC DE TRATAMENTOS CULTURAIS", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "15/07/2019"},
            {"empresa": 25, "cadastro": 622303, "nome": "MATUSALEM MARQUES DE OLIVEIRA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 624215, "nome": "MAURICIO RICARDO PEREIRA DE SOUSA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "11/02/2025"},
            {"empresa": 25, "cadastro": 622893, "nome": "MAURO LUIZ DA SILVA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "07/02/2018"},
            {"empresa": 25, "cadastro": 624227, "nome": "MICHAEL LEOCARDIO CASSIANO", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 623845, "nome": "MICHEL ALEXANDRINO DE MEDEIROS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "07/03/2024"},
            {"empresa": 25, "cadastro": 620801, "nome": "MIGUEL DOS REIS RIBEIRO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "29/04/2013"},
            {"empresa": 25, "cadastro": 620638, "nome": "MIGUEL DOS SANTOS", "cargo": "MONITOR DE MOTORISTAS II", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "10/04/2013"},
            {"empresa": 25, "cadastro": 624487, "nome": "NATALIA DA SILVA DO CARMO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 621519, "nome": "NEILTON VIEIRA DE JESUS", "cargo": "MOTORISTA PRANCHA", "descricaoLocal": "CAMINHAO PRANCHA - CAMBUI", "admissao": "12/05/2016"},
            {"empresa": 25, "cadastro": 624037, "nome": "NERIVALDO PINHEIRO DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "APOIO PATIO - CAMBUI", "admissao": "29/05/2024"},
            {"empresa": 25, "cadastro": 623583, "nome": "NICOLAS ANDERSON MONTEIRO DA SILVA", "cargo": "CONTROLADOR DE TRAFEGO I", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "26/04/2023"},
            {"empresa": 25, "cadastro": 624221, "nome": "NIGSON DE OLIVEIRA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "13/02/2025"},
            {"empresa": 25, "cadastro": 622662, "nome": "NILTON CESAR DOS SANTOS", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 621024, "nome": "NILTON GOMES MECENAS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "03/03/2014"},
            {"empresa": 25, "cadastro": 624011, "nome": "NIVALDO FRANCO BORGES NETO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/05/2024"},
            {"empresa": 25, "cadastro": 624303, "nome": "OBELIA MARIA GARCES DO NASCIMENTO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 624399, "nome": "OLAVIA SOUZA SIEGA", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 622923, "nome": "OLDAIR PEREIRA DO NASCIMENTO", "cargo": "OP DE PA CARREG AGR I", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "03/02/2014"},
            {"empresa": 25, "cadastro": 623956, "nome": "OLDEMAR TEIXEIRA DA VEIGA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "23/04/2024"},
            {"empresa": 25, "cadastro": 622881, "nome": "ORACILDO FERREIRA DE PAULA", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "02/03/2016"},
            {"empresa": 25, "cadastro": 621710, "nome": "ORCALINO LIMA DE FARIA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "13/02/2017"},
            {"empresa": 25, "cadastro": 624304, "nome": "OZANA DA SILVA DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 624442, "nome": "PAULO CESAR BASTOS ALBUQUERQUE", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "20/05/2025"},
            {"empresa": 25, "cadastro": 624216, "nome": "PAULO HENRIQUE DE OLIVEIRA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "11/02/2025"},
            {"empresa": 25, "cadastro": 624265, "nome": "PEDRO HENRIQUE ALVES DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "26/03/2025"},
            {"empresa": 25, "cadastro": 624425, "nome": "PEDRO HENRIQUE FELIX SANTANA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "13/05/2025"},
            {"empresa": 25, "cadastro": 623935, "nome": "PEDRO HENRIQUE SILVA OLIVEIRA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "16/04/2024"},
            {"empresa": 25, "cadastro": 620831, "nome": "RAFAEL JOSE DE LIMA", "cargo": "LIDER DE PATIO", "descricaoLocal": "GERENCIA ENC LAVOURAS - CAMBUI", "admissao": "09/05/2013"},
            {"empresa": 25, "cadastro": 623823, "nome": "RANUZIO MACIEL LIMA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 624038, "nome": "REGIANE KETREN PEREIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "29/05/2024"},
            {"empresa": 25, "cadastro": 622623, "nome": "REGINALDO DOMINGOS DE FREITAS", "cargo": "MOTORISTA PRANCHA", "descricaoLocal": "CAMINHAO PRANCHA - CAMBUI", "admissao": "24/04/2018"},
            {"empresa": 25, "cadastro": 623622, "nome": "REINALDO PINHEIRO DE OLIVEIRA", "cargo": "TRATORISTA II", "descricaoLocal": "COMPOSTAGEM AGR - CAMBUI", "admissao": "17/05/2023"},
            {"empresa": 25, "cadastro": 624408, "nome": "RENAN MARQUES RODRIGUES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "08/05/2025"},
            {"empresa": 25, "cadastro": 622473, "nome": "RENATO CANDIDO DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2020"},
            {"empresa": 25, "cadastro": 623947, "nome": "RENATO DA SILVA SANTOS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "18/04/2024"},
            {"empresa": 25, "cadastro": 621800, "nome": "RICARDO VICTOR DA SILVA FILHO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "26/04/2017"},
            {"empresa": 25, "cadastro": 624433, "nome": "ROBERT MARTINS ALVES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "16/05/2025"},
            {"empresa": 25, "cadastro": 621159, "nome": "ROBERTO CARLOS BUENO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/02/2015"},
            {"empresa": 25, "cadastro": 622493, "nome": "ROBERTO CARLOS GORDINHO", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "22/04/2020"},
            {"empresa": 25, "cadastro": 622512, "nome": "ROBERVAL FERREIRA FRANCO", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "09/06/2020"},
            {"empresa": 25, "cadastro": 622660, "nome": "ROBEZILDA MACIEL LIMA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "16/04/2020"},
            {"empresa": 25, "cadastro": 624109, "nome": "ROBSON DE LUCENA ALVES", "cargo": "LIDER COLHEITA MECANIZADA", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "27/07/2024"},
            {"empresa": 25, "cadastro": 624401, "nome": "ROBSON OLIVEIRA DE ARAUJO", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 624434, "nome": "ROBSON ROBERTO DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "16/05/2025"},
            {"empresa": 25, "cadastro": 624266, "nome": "RODRIGO MARCOS DOS REIS", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "26/03/2025"},
            {"empresa": 25, "cadastro": 624566, "nome": "RONES RODRIGUES GONCALVES", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "28/07/2025"},
            {"empresa": 25, "cadastro": 620981, "nome": "RONIELLA REGES PIMENTA", "cargo": "BALANCEIRO I", "descricaoLocal": "CONTROLE DE TRAFEGO - CAMBUI", "admissao": "11/09/2013"},
            {"empresa": 25, "cadastro": 623849, "nome": "RONIVONI PENA DE OLIVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "11/03/2024"},
            {"empresa": 25, "cadastro": 624226, "nome": "ROQUE SANTOS DE OLIVEIRA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "21/02/2025"},
            {"empresa": 25, "cadastro": 623904, "nome": "ROSALINA FELIX ALVES", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2024"},
            {"empresa": 25, "cadastro": 623918, "nome": "ROSANILDA AMADOR DE SANTANA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 624305, "nome": "ROSILENE DOS SANTOS SILVA DE OLIVEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "09/04/2025"},
            {"empresa": 25, "cadastro": 622851, "nome": "ROZIMAR DA SILVA", "cargo": "MOTORISTA II", "descricaoLocal": "CAMINHAO TORTA DE FILTRO - CAMBUI", "admissao": "23/03/2015"},
            {"empresa": 25, "cadastro": 622745, "nome": "RUBENS CARVALHO DOS SANTOS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "22/04/2021"},
            {"empresa": 25, "cadastro": 624470, "nome": "RUBENS MARIO QUINTINO DA ROCHA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "28/05/2025"},
            {"empresa": 25, "cadastro": 622620, "nome": "SAMUEL FERREIRA DE SOUZA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "16/04/2018"},
            {"empresa": 25, "cadastro": 623972, "nome": "SAMUEL SIMIAO DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "NONINO - CAMBUI", "admissao": "25/04/2024"},
            {"empresa": 25, "cadastro": 624402, "nome": "SANDERLEY VIEIRA DA SILVA", "cargo": "MOTORISTA I", "descricaoLocal": "CAMINHAO APOIO FRENTE MECANIZADA - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 623782, "nome": "SANDRO DIVINO RIBEIRO BATISTA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "07/12/2023"},
            {"empresa": 25, "cadastro": 620616, "nome": "SEBASTIAO SALVADOR DA LUZ", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "08/04/2013"},
            {"empresa": 25, "cadastro": 623400, "nome": "SEZENANDES ARANTES DA SILVA", "cargo": "OP DE MOTONIVEL (PATR) I", "descricaoLocal": "CONSERVACAO ESTRADAS - CAMBUI", "admissao": "07/12/2022"},
            {"empresa": 25, "cadastro": 623919, "nome": "SIMONE DA SILVA SOUSA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 624567, "nome": "SIMONE NUNES DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "28/07/2025"},
            {"empresa": 25, "cadastro": 622565, "nome": "SINOMAR DA SILVA VILACIO", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "05/04/2021"},
            {"empresa": 25, "cadastro": 624489, "nome": "SIRLENE ALVES DE LIMA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623124, "nome": "SIVALDO GOMES DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "06/04/2022"},
            {"empresa": 25, "cadastro": 624573, "nome": "SUAIR MARTINS MARQUES FILHO", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "04/08/2025"},
            {"empresa": 25, "cadastro": 622883, "nome": "SULEILTON JOSE CAETANO", "cargo": "TRATORISTA II", "descricaoLocal": "TRATOS CULTURAIS - CAMBUI", "admissao": "06/05/2016"},
            {"empresa": 25, "cadastro": 624491, "nome": "TAINAR BARBOSA PEREIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 622978, "nome": "TALISSON JOSE MENDES DE LIMA", "cargo": "OP DE AUTOPR (UNIPORTE) I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "01/09/2021"},
            {"empresa": 25, "cadastro": 624501, "nome": "THAIS APARECIDA RODRIGUES DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623920, "nome": "THAIS SOUSA DA SILVA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2024"},
            {"empresa": 25, "cadastro": 622943, "nome": "THIAGO LAZARO DIAS MARQUES", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "24/02/2014"},
            {"empresa": 25, "cadastro": 623160, "nome": "UELBER DE SOUSA SILVA", "cargo": "TRATORISTA II", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "11/04/2022"},
            {"empresa": 25, "cadastro": 622635, "nome": "VALDELI DOS SANTOS TELES", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/02/2019"},
            {"empresa": 25, "cadastro": 620712, "nome": "VALDEMIR VICENTE RAMOS", "cargo": "ENC DE TRATAMENTOS CULTURAIS", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "18/04/2013"},
            {"empresa": 25, "cadastro": 623392, "nome": "VALDINEI DIAS MUNIZ", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "CAPINA QUIMICA - CAMBUI", "admissao": "07/02/2018"},
            {"empresa": 25, "cadastro": 623565, "nome": "VALMIR DE SOUSA PEREIRA", "cargo": "MOTORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "17/04/2023"},
            {"empresa": 25, "cadastro": 623824, "nome": "VALTUIR ALVES DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "14/02/2024"},
            {"empresa": 25, "cadastro": 622501, "nome": "VALTUIR DE CASTRO VASCONCELOS", "cargo": "TRATORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "28/04/2020"},
            {"empresa": 25, "cadastro": 624493, "nome": "VANESSA DIOGO DA SILVA TEIXEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 624494, "nome": "VANILZA FRANCISCA DE GOIS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "29/05/2025"},
            {"empresa": 25, "cadastro": 623964, "nome": "VERONICE DOS SANTOS", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "23/04/2024"},
            {"empresa": 25, "cadastro": 624526, "nome": "VILMAR DANTAS DA SILVA", "cargo": "OP DE COLHEDORA", "descricaoLocal": "COLHEDEIRA DA CANA - CAMBUI", "admissao": "27/06/2025"},
            {"empresa": 25, "cadastro": 624423, "nome": "WALDEMIR ANGELO SILVA COSTA", "cargo": "MOTORISTA I", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "10/05/2025"},
            {"empresa": 25, "cadastro": 622079, "nome": "WALDINEY VIEIRA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "12/02/2019"},
            {"empresa": 25, "cadastro": 620686, "nome": "WALDIVINO AUGUSTO DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/04/2013"},
            {"empresa": 25, "cadastro": 621851, "nome": "WALTER FERREIRA DE MOURA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "15/05/2017"},
            {"empresa": 25, "cadastro": 623860, "nome": "WALTUIRE PERES DE LIMA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "13/03/2024"},
            {"empresa": 25, "cadastro": 620691, "nome": "WANDERLEY BATISTA DE MOURA", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "17/04/2013"},
            {"empresa": 25, "cadastro": 622488, "nome": "WANDERSON SILVA SANTOS", "cargo": "FRENTISTA DE COLHEITA MECANIZ", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "20/04/2020"},
            {"empresa": 25, "cadastro": 623411, "nome": "WARLITON VIEIRA BORGES", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "30/01/2023"},
            {"empresa": 25, "cadastro": 623648, "nome": "WEBERSON DE ARAUJO EVANGELISTA", "cargo": "SUP AGRICOLA", "descricaoLocal": "ENC SETOR E TEC AGR - CAMBUI", "admissao": "01/06/2023"},
            {"empresa": 25, "cadastro": 624456, "nome": "WEDER PEREIRA MACIEL", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "20/05/2025"},
            {"empresa": 25, "cadastro": 622938, "nome": "WELEN DA SILVA CAMPOS", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "24/02/2014"},
            {"empresa": 25, "cadastro": 624418, "nome": "WELLINGTON ADRIEL OLIVEIRA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/05/2025"},
            {"empresa": 25, "cadastro": 623825, "nome": "WELTON DO NASCIMENTO FERREIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "15/02/2024"},
            {"empresa": 25, "cadastro": 621004, "nome": "WENDEL FIRMINO EVARISTO", "cargo": "LIDER COLHEITA MECANIZADA", "descricaoLocal": "COL MECANIZADA - CAMBUI", "admissao": "13/02/2014"},
            {"empresa": 25, "cadastro": 624153, "nome": "WENDER ALVES SOARES", "cargo": "MOTORISTA I", "descricaoLocal": "SETOR SANTA HELENA - CAMBUI", "admissao": "12/09/2024"},
            {"empresa": 25, "cadastro": 624382, "nome": "WESLAINE GONCALVES EVARISTO NOGUEIRA", "cargo": "AUX GERAL DE LAVOURA", "descricaoLocal": "IRRIGACAO - CAMBUI", "admissao": "25/04/2025"},
            {"empresa": 25, "cadastro": 624403, "nome": "WESLEY PEREIRA DA SILVA", "cargo": "AUX CAMINHAO DE APOIO", "descricaoLocal": "CONTROLE DE INCENDIO CCT - CAMBUI", "admissao": "06/05/2025"},
            {"empresa": 25, "cadastro": 621162, "nome": "WILSON VIEIRA DE OLIVEIRA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "17/02/2015"},
            {"empresa": 25, "cadastro": 622128, "nome": "WILTON NASCIMENTO DA SILVA", "cargo": "MOTORISTA CANAVIEIRO", "descricaoLocal": "CAMINHAO CANAVIEIRO - CAMBUI", "admissao": "15/04/2019"},
            {"empresa": 25, "cadastro": 624419, "nome": "ZELMA MARIA DA SILVA", "cargo": "TRATORISTA DE TRANSBORDO", "descricaoLocal": "TRATOR TRANSBORDO - CAMBUI", "admissao": "09/05/2025"}
             ];

        // ===== INICIALIZAÇÃO DO SUPABASE =====
        async function initSupabase() {
            try {
                if (!sb) {
                    if (!notificouFalhaConexao) { showMessage('Conexão com o banco indisponível. Operando em modo offline.', 'info'); notificouFalhaConexao = true; }
                    await carregarFuncionariosLocais();
                    faltas = JSON.parse(localStorage.getItem('faltas') || '[]');
                    historico = JSON.parse(localStorage.getItem('historico') || '[]');
                    return;
                }

                const { data: { session: currentSession }, error: sessionError } = await sb.auth.getSession();
                if (sessionError) {
                    console.error('Erro ao verificar sessão:', sessionError);
                    if (!notificouFalhaConexao) { showMessage('Sessão não autenticada. Exibindo dados se política permitir.', 'info'); notificouFalhaConexao = true; }
                }

                session = currentSession;
                updateAuthUI();
                await carregarUsuariosDB();

                await carregarFuncionariosDB();
                await Promise.allSettled([
                    carregarFaltasDB(),
                    carregarHistoricoDB()
                ]);

                sb.auth.onAuthStateChange(async (event, newSession) => {
                    session = newSession;
                    updateAuthUI();
                    await carregarUsuariosDB();
                    applyVisibilityPermissions();
                    const emailNow = newSession && newSession.user ? newSession.user.email : null;
                    if (emailNow && !isAuthorizedEmail(emailNow)) {
                        showMessage('Acesso pendente de autorização', 'warning');
                        try { await sb.auth.signOut(); } catch {}
                        return;
                    }
                    if (emailNow) {
                        await marcarUsuarioOnline();
                        if (!window.presencaTimer) window.presencaTimer = setInterval(marcarUsuarioOnline, 30000);
                    } else {
                        if (window.presencaTimer) { clearInterval(window.presencaTimer); window.presencaTimer = null; }
                    }
                    await carregarFuncionariosDB();
                    await Promise.allSettled([
                        carregarFaltasDB(),
                        carregarHistoricoDB()
                    ]);
                    const currentTab = document.querySelector('.tab-button.active')?.id.replace('tab-', '');
                    if (currentTab) showTab(currentTab);
                });

            } catch (error) {
                console.error('Erro na inicialização do Supabase:', error);
                if (!notificouFalhaConexao) { showMessage('Conexão com o banco indisponível. Operando em modo offline.', 'info'); notificouFalhaConexao = true; }
                await carregarFuncionariosLocais();
                faltas = JSON.parse(localStorage.getItem('faltas') || '[]');
                historico = JSON.parse(localStorage.getItem('historico') || '[]');
            }
        }

        // ===== FUNÇÕES DE AUTENTICAÇÃO =====
        function updateAuthUI() {
            const emailEl = document.getElementById('user-email');
            const btnLogin = document.getElementById('btn-login');
            const btnLogout = document.getElementById('btn-logout');
            const badge = document.getElementById('perm-delete-badge');
            const adminTab = document.getElementById('tab-admin');
            const isAdmin = isAdminEmail(session && session.user ? session.user.email : null);

            if (session && session.user) {
                emailEl.textContent = session.user.email;
                emailEl.classList.remove('hidden');
                btnLogout.classList.remove('hidden');
                btnLogin.classList.add('hidden');
            } else {
                emailEl.classList.add('hidden');
                btnLogout.classList.add('hidden');
                btnLogin.classList.remove('hidden');
            }

            if (badge) {
                if (canDelete()) badge.classList.add('hidden');
                else badge.classList.remove('hidden');
            }

            if (adminTab) { if (isAdmin) adminTab.classList.remove('hidden'); else adminTab.classList.add('hidden'); }

            applyVisibilityPermissions();
        }

        function abrirModalAuth() {
            document.getElementById('modal-auth').classList.add('active');
        }

        function fecharModalAuth() {
            document.getElementById('modal-auth').classList.remove('active');
            document.getElementById('form-auth').reset();
        }

        // Event listeners para autenticação
        document.getElementById('btn-login').addEventListener('click', () => { if (!sb) { showMessage('Modo offline: autenticação indisponível', 'warning'); return; } abrirModalAuth(); });
        document.getElementById('btn-logout').addEventListener('click', async () => {
            if (!sb) { showMessage('Modo offline: autenticação indisponível', 'warning'); return; }
            const { error } = await sb.auth.signOut();
            if (error) {
                showMessage('Erro ao sair: ' + error.message, 'error');
            } else {
                showMessage('Logout realizado com sucesso', 'success');
                await marcarUsuarioOffline();
            }
        });

        document.getElementById('auth-cancel').addEventListener('click', fecharModalAuth);
        
        document.getElementById('auth-signup').addEventListener('click', async () => {
            if (!sb) { showMessage('Modo offline: autenticação indisponível', 'warning'); return; }
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (!email || !password) {
                showMessage('Preencha email e senha', 'error');
                return;
            }

            const { data, error } = await sb.auth.signUp({
                email,
                password
            });

            if (error) {
                showMessage('Erro ao criar conta: ' + error.message, 'error');
            } else {
                showMessage('Conta criada com sucesso! Verifique seu email.', 'success');
                let u = usuarios.find(x => (x.email || '').toLowerCase() === email.toLowerCase());
                if (!u) { u = { email, authorized: false, online: false, lastSeen: null }; usuarios.push(u); syncUsuariosLocal(); await salvarUsuarioDB(u); }
                fecharModalAuth();
            }
        });

        document.getElementById('form-auth').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!sb) { showMessage('Modo offline: autenticação indisponível', 'warning'); return; }
            
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (!email || !password) {
                showMessage('Preencha email e senha', 'error');
                return;
            }

            const { data, error } = await sb.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                showMessage('Erro ao entrar: ' + error.message, 'error');
            } else {
                showMessage('Login realizado com sucesso!', 'success');
                if (data && data.session) { session = data.session; updateAuthUI(); }
                await carregarUsuariosDB();
                applyVisibilityPermissions();
                const ok = isAuthorizedEmail(email);
                if (!ok) {
                    showMessage('Acesso pendente de autorização', 'warning');
                    await sb.auth.signOut();
                    return;
                }
                await marcarUsuarioOnline();
                if (!window.presencaTimer) window.presencaTimer = setInterval(marcarUsuarioOnline, 30000);
                fecharModalAuth();
            }
        });

        // ===== FUNÇÕES DO BANCO DE DADOS =====
        async function carregarFuncionariosDB() {
            try {
                if (!sb) throw new Error('Supabase indisponível');
                const { data, error } = await sb
                    .from('funcionarios')
                    .select('empresa,cadastro,nome,cargo,descricaolocal,frente,turno,lider,admissao,cnh_numero,cnh_expedicao,cnh_vencimento,cnh_foto_url')
                    .order('cadastro')
                    .limit(1000);

                if (error) throw error;

                if (data) {
                    funcionarios = data.map(row => ({
                        empresa: row.empresa,
                        cadastro: row.cadastro,
                        nome: row.nome,
                        cargo: row.cargo,
                        descricaoLocal: row.descricaolocal,
                        frente: row.frente || '',
                        turno: row.turno || '',
                        lider: row.lider || '',
                        admissao: row.admissao,
                        cnhNumero: row.cnh_numero || '',
                        cnhExpedicao: row.cnh_expedicao || null,
                        cnhVencimento: row.cnh_vencimento || null,
                        cnhFotoUrl: row.cnh_foto_url || null
                    }));
                    
                    localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                    funcionariosLoadedFromDB = true;
                    carregarFuncionarios();
                    showMessage('Funcionários atualizados do banco', 'success');
                    verificarCNHVencidas(); // Verifica alertas de CNH
                    atualizarDashboard();
                }
            } catch (error) {
                console.error('Erro ao carregar funcionários:', error);
                showMessage('Usando base local de funcionários (offline)', 'info');
                await carregarFuncionariosLocais();
                atualizarDashboard();
            }
        }

        async function carregarFuncionariosLocais() {
            funcionarios = FUNCIONARIOS_BASE.map(f => ({
                ...f,
                admissao: normalizarAdmissao(f.admissao),
                frente: f.frente || '',
                turno: f.turno || '',
                lider: f.lider || ''
            }));
            try { localStorage.setItem('funcionarios', JSON.stringify(funcionarios)); } catch (e) { console.warn('Falha ao salvar funcionarios locais no localStorage:', e); }
            carregarFuncionarios();
        }

        async function carregarFaltasDB() {
            try {
                const { data, error } = await sb
                    .from('faltas')
                    .select('id,matricula,nome_funcionario,data,motivo,observacoes,registrado_em,modificado_em,dias_atestado,user_id,arquivo_atestado_url')
                    .order('data', { ascending: false })
                    .limit(1000);

                if (error) throw error;

                if (data) {
                    faltas = data.map(row => ({
                        id: row.id.toString(),
                        matricula: row.matricula?.toString() || '',
                        nomeFuncionario: row.nome_funcionario || '',
                        data: row.data,
                        motivo: row.motivo,
                        observacoes: row.observacoes || '',
                        registradoEm: row.registrado_em,
                        modificadoEm: row.modificado_em || null,
                        diasAtestado: row.dias_atestado || null,
                        arquivoAtestadoUrl: row.arquivo_atestado_url || null,
                        userId: row.user_id
                    }));
                    
                    try { localStorage.setItem('faltas', JSON.stringify(faltas)); } catch (e) { console.warn('Falha ao salvar faltas no localStorage:', e); }
                    faltasLoadedFromDB = true;
                    showMessage('Faltas atualizadas do banco', 'success');
                }
            } catch (error) {
                console.error('Erro ao carregar faltas:', error);
                showMessage('Usando dados locais de faltas (offline)', 'info');
                faltas = JSON.parse(localStorage.getItem('faltas') || '[]');
            }
        }

        async function carregarHistoricoDB() {
            try {
                const { data, error } = await sb
                    .from('historico')
                    .select('id,tipo,descricao,data_hora,usuario,detalhes,user_id')
                    .order('data_hora', { ascending: false })
                    .limit(1000);

                if (error) throw error;

                if (data) {
                    historico = data.map(row => ({
                        id: row.id.toString(),
                        tipo: row.tipo,
                        descricao: row.descricao,
                        dataHora: row.data_hora,
                        usuario: row.usuario,
                        detalhes: row.detalhes || '',
                        userId: row.user_id // Mantém para referência
                    }));
                    
                    localStorage.setItem('historico', JSON.stringify(historico));
                    historicoLoadedFromDB = true;
                    atualizarDashboard();
                }
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
                showMessage('Usando dados locais de histórico (offline)', 'info');
                historico = JSON.parse(localStorage.getItem('historico') || '[]');
                atualizarDashboard();
            }
        }

        async function salvarFuncionarioDB(funcionario) {
            try {
                if (!sb || !session) return true;
                const { data, error } = await sb
                    .from('funcionarios')
                    .upsert({
                        empresa: funcionario.empresa,
                        cadastro: funcionario.cadastro,
                        nome: funcionario.nome,
                        cargo: funcionario.cargo,
                        descricaolocal: funcionario.descricaoLocal,
                        frente: funcionario.frente,
                        turno: funcionario.turno,
                        lider: funcionario.lider,
                        admissao: funcionario.admissao,
                        cnh_numero: funcionario.cnhNumero || null,
                        cnh_expedicao: funcionario.cnhExpedicao || null,
                        cnh_vencimento: funcionario.cnhVencimento || null,
                        cnh_foto_url: funcionario.cnhFotoUrl || null
                    }, { onConflict: 'cadastro' })
                    .select();

                if (error) throw error;
                return true;
            } catch (error) {
                console.error('Erro ao salvar funcionário:', error);
                showMessage('Erro ao salvar no banco: ' + error.message, 'error');
                return false;
            }
        }

        async function excluirFuncionarioDB(cadastro) {
            try {
                if (!sb || !session) return true;
                const { error } = await sb
                    .from('funcionarios')
                    .delete()
                    .eq('cadastro', cadastro);

                if (error) throw error;
                return true;
            } catch (error) {
                console.error('Erro ao excluir funcionário:', error);
                showMessage('Erro ao excluir do banco: ' + error.message, 'error');
                return false;
            }
        }

        async function salvarFaltaDB(falta) {
            try {
                if (!sb || !session) return true;
                let data, error;
                try {
                    ({ data, error } = await sb
                        .from('faltas')
                        .upsert({
                            id: falta.id && !isNaN(parseInt(falta.id)) ? parseInt(falta.id) : undefined,
                            matricula: parseInt(falta.matricula),
                            nome_funcionario: falta.nomeFuncionario,
                            data: falta.data,
                            motivo: falta.motivo,
                            observacoes: falta.observacoes,
                            registrado_em: falta.registradoEm,
                            modificado_em: new Date().toISOString(),
                            user_id: session ? session.user.id : 'sistema',
                            dias_atestado: falta.diasAtestado,
                            arquivo_atestado_url: falta.arquivoAtestadoUrl || null
                        }, { onConflict: 'id' })
                        .select());
                } catch (e1) {
                    ({ data, error } = await sb
                        .from('faltas')
                        .upsert({
                            id: falta.id && !isNaN(parseInt(falta.id)) ? parseInt(falta.id) : undefined,
                            matricula: parseInt(falta.matricula),
                            nome_funcionario: falta.nomeFuncionario,
                            data: falta.data,
                            motivo: falta.motivo,
                            observacoes: falta.observacoes,
                            registrado_em: falta.registradoEm,
                            modificado_em: new Date().toISOString(),
                            user_id: session ? session.user.id : 'sistema',
                            dias_atestado: falta.diasAtestado
                        }, { onConflict: 'id' })
                        .select());
                }

                if (error) throw error;
                
                if (data && data[0]) {
                    falta.id = data[0].id.toString();
                }
                return true;
            } catch (error) {
                console.error('Erro ao salvar falta:', error);
                showMessage('Erro ao salvar no banco: ' + error.message, 'error');
                return false;
            }
        }

        async function excluirFaltaDB(faltaId) {
            try {
                if (!sb || !session || !canDelete()) { showMessage('Sem permissão para excluir no banco.', 'error'); return false; }
                const { error } = await sb
                    .from('faltas')
                    .delete()
                    .eq('id', parseInt(faltaId));

                if (error) throw error;
                return true;
            } catch (error) {
                console.error('Erro ao excluir falta:', error);
                showMessage('Erro ao excluir do banco: ' + error.message, 'error');
                return false;
            }
        }

        async function salvarHistoricoDB(registro) {
            try {
                const { data, error } = await sb
                    .from('historico')
                    .insert({
                        tipo: registro.tipo,
                        descricao: registro.descricao,
                        data_hora: new Date().toISOString(),
                        usuario: session ? session.user.email : 'Sistema',
                        detalhes: registro.detalhes || '',
                        user_id: session ? session.user.id : 'sistema' // Registra quem criou
                    })
                    .select();

                if (error) throw error;
                return true;
            } catch (error) {
                console.error('Erro ao salvar histórico:', error);
                showMessage('Erro ao salvar histórico no banco: ' + error.message, 'error');
                return false;
            }
        }

        // ===== FUNÇÕES GERAIS =====
        function showMessage(message, type = 'info') {
            const container = document.getElementById('message-container');
            const messageEl = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            messageEl.className = `${colors[type]} text-white p-4 rounded-lg shadow-lg mb-2 animate-fade-in`;
            messageEl.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            container.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            if (theme === 'dark') root.classList.add('dark'); else root.classList.remove('dark');
            const icon = document.getElementById('icon-theme');
            if (icon) icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            try { localStorage.setItem('theme', theme); } catch (e) {}
        }

        function canDelete() {
            const email = session && session.user && session.user.email;
            return isAdminEmail(email);
        }

        function isAuthorizedEmail(email) {
            if (!email) return false;
            const e = email.toLowerCase();
            if (e === 'gutemberggg10@gmail.com') return true;
            const u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            return !!(u && u.authorized === true);
        }

        function isAdminEmail(email) {
            if (!email) return false;
            const e = email.toLowerCase();
            if (e === 'gutemberggg10@gmail.com') return true;
            const u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            return !!(u && u.isAdmin === true);
        }

        function syncUsuariosLocal() {
            try { localStorage.setItem('usuarios', JSON.stringify(usuarios)); } catch (e) {}
        }

        function getUserPermissions(email) {
            const e = (email || '').toLowerCase();
            const full = { dashboard: true, funcionarios: true, registro: true, consulta: true, historico: true, relatorios: true, configuracao: true };
            if (isAdminEmail(e)) return full;
            const u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            if (!u) return { dashboard: true };
            if (!u.authorized) return { dashboard: true };
            return u.permissions || full;
        }

        async function setUserPermissions(email, perms) {
            const emailVal = (email || '').trim();
            if (!emailVal || !emailVal.includes('@')) { showMessage('Informe um email válido para permissões', 'error'); return; }
            const e = emailVal.toLowerCase();
            let u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            if (!u) { u = { email: emailVal, authorized: false, online: false, lastSeen: null, permissions: perms }; usuarios.push(u); }
            else { u.permissions = perms; }
            syncUsuariosLocal();
            renderAdmin();
            applyVisibilityPermissions();
            const ok = await salvarUsuarioDB(u);
            showMessage(ok ? 'Permissões atualizadas' : 'Falha ao salvar permissões no banco', ok ? 'success' : 'error');
        }

        function applyVisibilityPermissions() {
            const adminTab = document.getElementById('tab-admin');
            const email = session && session.user ? session.user.email : null;
            const isAdmin = isAdminEmail(email);
            if (adminTab) { if (isAdmin) adminTab.classList.remove('hidden'); else adminTab.classList.add('hidden'); }

            const perms = getUserPermissions(email);
            const map = {
                dashboard: 'tab-dashboard', funcionarios: 'tab-funcionarios', registro: 'tab-registro', consulta: 'tab-consulta', historico: 'tab-historico', relatorios: 'tab-relatorios', configuracao: 'tab-configuracao'
            };
            Object.entries(map).forEach(([key, btnId]) => {
                const btn = document.getElementById(btnId);
                if (!btn) return;
                const allowed = !!(perms && perms[key]);
                btn.style.display = allowed ? '' : 'none';
                const content = document.getElementById(`${key}-content`);
                if (content && !allowed) content.classList.remove('active');
            });
        }

        function abrirModalPermissoes(email) {
            const clean = (email || '').trim();
            if (!clean || !clean.includes('@')) { showMessage('Informe um email válido para permissões', 'error'); return; }
            usuarioEditandoPermissoes = clean;
            const el = document.getElementById('modal-permissoes');
            document.getElementById('perm-user-email').textContent = clean;
            const p = getUserPermissions(clean);
            ['dashboard','funcionarios','registro','consulta','historico','relatorios','configuracao'].forEach(k => {
                const cb = document.getElementById(`perm-${k}`);
                if (cb) cb.checked = !!p[k];
            });
            el.classList.add('active');
        }

        function fecharModalPermissoes() {
            const el = document.getElementById('modal-permissoes');
            el.classList.remove('active');
            usuarioEditandoPermissoes = null;
        }

        async function salvarModalPermissoes() {
            if (!usuarioEditandoPermissoes) return;
            const perms = {};
            ['dashboard','funcionarios','registro','consulta','historico','relatorios','configuracao'].forEach(k => {
                const cb = document.getElementById(`perm-${k}`);
                perms[k] = !!(cb && cb.checked);
            });
            await setUserPermissions(usuarioEditandoPermissoes, perms);
            fecharModalPermissoes();
        }

        async function carregarUsuariosDB() {
            try {
                if (!sb) throw new Error('Supabase indisponível');
                const pageSize = 1000;
                let supportsPermissions = true;
                let supportsIsAdmin = true;
                let all = [];
                try {
                    let from = 0;
                    while (true) {
                        const { data, error } = await sb
                            .from('usuarios')
                            .select('email,authorized,online,last_seen,permissions,is_admin')
                            .order('email', { ascending: true })
                            .range(from, from + pageSize - 1);
                        if (error) throw error;
                        if (!data || data.length === 0) break;
                        all = all.concat(data);
                        if (data.length < pageSize) break;
                        from += pageSize;
                    }
                } catch (e1) {
                    supportsPermissions = false;
                    supportsIsAdmin = false;
                    all = [];
                    let from = 0;
                    while (true) {
                        const { data, error } = await sb
                            .from('usuarios')
                            .select('email,authorized,online,last_seen')
                            .order('email', { ascending: true })
                            .range(from, from + pageSize - 1);
                        if (error) throw error;
                        if (!data || data.length === 0) break;
                        all = all.concat(data);
                        if (data.length < pageSize) break;
                        from += pageSize;
                    }
                }

                usuarios = all.map(r => ({
                    email: r.email,
                    authorized: !!r.authorized,
                    online: !!r.online,
                    lastSeen: r.last_seen || null,
                    permissions: supportsPermissions ? (r.permissions || null) : null,
                    isAdmin: supportsIsAdmin ? !!r.is_admin : false
                }));
                syncUsuariosLocal();
                usuariosFonte = 'banco';
                showMessage('Usuários carregados do banco', 'success');
            } catch (error) {
                usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
                usuariosFonte = 'local';
                showMessage('Usando usuários do armazenamento local', 'warning');
            }
        }

        async function adicionarAdminDB(email) {
            try {
                if (!sb) return true;
                const e = (email || '').trim();
                if (!e || !e.includes('@')) { showMessage('Email inválido para administrador', 'error'); return false; }
                const { error } = await sb.from('admins').upsert({ email: e }, { onConflict: 'email' });
                if (error) throw error;
                return true;
            } catch (error) {
                showMessage('Erro ao registrar admin: ' + (error && error.message ? error.message : String(error)), 'error');
                return false;
            }
        }

        async function removerAdminDB(email) {
            try {
                if (!sb) return true;
                const e = (email || '').trim();
                if (!e || !e.includes('@')) { showMessage('Email inválido para administrador', 'error'); return false; }
                const { error } = await sb.from('admins').delete().eq('email', e);
                if (error) throw error;
                return true;
            } catch (error) {
                showMessage('Erro ao remover admin: ' + (error && error.message ? error.message : String(error)), 'error');
                return false;
            }
        }

        async function salvarUsuarioDB(user) {
            try {
                if (!sb) return true;
                const emailVal = (user && user.email) ? String(user.email).trim() : '';
                if (!emailVal || !emailVal.includes('@')) {
                    showMessage('Email inválido para salvar no banco', 'error');
                    return false;
                }
                try {
                    const { error } = await sb
                        .from('usuarios')
                        .upsert({
                            email: emailVal,
                            authorized: !!user.authorized,
                            online: !!user.online,
                            last_seen: user.lastSeen || null,
                            permissions: user.permissions || null,
                            is_admin: !!user.isAdmin
                        }, { onConflict: 'email' });
                    if (error) throw error;
                    return true;
                } catch (e1) {
                    const { error } = await sb
                        .from('usuarios')
                        .upsert({
                            email: emailVal,
                            authorized: !!user.authorized,
                            online: !!user.online,
                            last_seen: user.lastSeen || null
                        }, { onConflict: 'email' });
                    if (error) throw error;
                    return true;
                }
            } catch (error) {
                showMessage('Erro ao salvar usuário: ' + (error && error.message ? error.message : String(error)), 'error');
                return false;
            }
        }

        async function setUserAuthorized(email, value) {
            const e = (email || '').trim().toLowerCase();
            if (!e || !e.includes('@')) { showMessage('Informe um email válido para autorização', 'error'); return; }
            let u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            if (!u) { u = { email: e, authorized: !!value, online: false, lastSeen: null }; usuarios.push(u); } else { u.authorized = !!value; }
            syncUsuariosLocal();
            await salvarUsuarioDB(u);
            renderAdmin();
            showMessage(value ? 'Usuário autorizado' : 'Autorização revogada', value ? 'success' : 'warning');
        }

        async function setUserAdmin(email, value) {
            const e = (email || '').trim().toLowerCase();
            if (!e || !e.includes('@')) { showMessage('Informe um email válido para administrador', 'error'); return; }
            let u = usuarios.find(x => (x.email || '').toLowerCase() === e);
            if (!u) { u = { email: e, authorized: true, online: false, lastSeen: null, isAdmin: !!value }; usuarios.push(u); }
            else { u.isAdmin = !!value; }
            syncUsuariosLocal();
            const ok1 = await salvarUsuarioDB(u);
            const ok2 = value ? await adicionarAdminDB(e) : await removerAdminDB(e);
            const ok = ok1 && ok2;
            renderAdmin();
            showMessage(ok ? (value ? 'Admin definido' : 'Admin removido') : 'Falha ao salvar admin no banco', ok ? 'success' : 'error');
            updateAuthUI();
        }

        function renderAdmin() {
            const tbody = document.getElementById('admin-users-tbody');
            if (!tbody) return;
            historico.forEach(r => {
                const e = (r.usuario || '').toLowerCase();
                if (e && e.includes('@')) {
                    if (!usuarios.find(x => (x.email || '').toLowerCase() === e)) usuarios.push({ email: r.usuario, authorized: false, online: false, lastSeen: null });
                }
            });
            syncUsuariosLocal();
            const total = usuarios.length;
            const online = usuarios.filter(u => u.online).length;
            const pendentes = usuarios.filter(u => !u.authorized).length;
            const elTotal = document.getElementById('admin-total-usuarios');
            const elOnline = document.getElementById('admin-usuarios-online');
            const elPend = document.getElementById('admin-pendentes');
            const src = document.getElementById('admin-users-source');
            if (elTotal) elTotal.textContent = String(total);
            if (elOnline) elOnline.textContent = String(online);
            if (elPend) elPend.textContent = String(pendentes);
            if (src) src.textContent = `Fonte: ${usuariosFonte === 'banco' ? 'Banco' : 'Local'}`;
            tbody.innerHTML = usuarios.filter(u => (u.email || '').includes('@')).map(u => {
                const ls = u.lastSeen ? new Date(u.lastSeen).toLocaleString('pt-BR') : '-';
                const a1 = `<button class="px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700" onclick="autorizarUsuario('${u.email}', true)">Autorizar</button>`;
                const a2 = `<button class="px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700" onclick="autorizarUsuario('${u.email}', false)">Revogar</button>`;
                const pBtn = `<button class="px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700" onclick="abrirModalPermissoes('${u.email}')">Editar</button>`;
                const admBtn = u.isAdmin ? `<button class=\"px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" onclick=\"setUserAdmin('${u.email}', false)\">Remover</button>` : `<button class=\"px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700\" onclick=\"setUserAdmin('${u.email}', true)\">Tornar</button>`;
                return `<tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="px-3 py-2">${u.email}</td>
                    <td class="px-3 py-2">${u.authorized ? 'Sim' : 'Não'}</td>
                    <td class="px-3 py-2">${u.isAdmin ? 'Sim' : 'Não'}</td>
                    <td class="px-3 py-2">${u.online ? 'Sim' : 'Não'}</td>
                    <td class="px-3 py-2">${ls}</td>
                    <td class="px-3 py-2 flex gap-2">${a1}${a2}${admBtn}</td>
                    <td class="px-3 py-2">${pBtn}</td>
                </tr>`;
            }).join('');
        }

        async function adicionarUsuarioEmail() {
            const input = document.getElementById('admin-add-email');
            if (!input) return;
            const email = (input.value || '').trim();
            if (!email || !email.includes('@')) { showMessage('Informe um email válido', 'error'); return; }
            let u = usuarios.find(x => (x.email || '').toLowerCase() === email.toLowerCase());
            if (!u) { u = { email, authorized: true, online: false, lastSeen: null }; usuarios.push(u); }
            else { u.authorized = true; }
            syncUsuariosLocal();
            await salvarUsuarioDB(u);
            input.value = '';
            renderAdmin();
            showMessage('Email adicionado e autorizado', 'success');
        }

        async function marcarUsuarioOnline() {
            if (!session || !session.user || !session.user.email) return;
            const email = session.user.email;
            let u = usuarios.find(x => (x.email || '').toLowerCase() === email.toLowerCase());
            if (!u) { u = { email, authorized: isAuthorizedEmail(email), online: true, lastSeen: new Date().toISOString() }; usuarios.push(u); }
            else { u.online = true; u.lastSeen = new Date().toISOString(); }
            syncUsuariosLocal();
            await salvarUsuarioDB(u);
            renderAdmin();
        }

        async function marcarUsuarioOffline() {
            if (!session || !session.user || !session.user.email) return;
            const email = session.user.email;
            let u = usuarios.find(x => (x.email || '').toLowerCase() === email.toLowerCase());
            if (u) { u.online = false; u.lastSeen = new Date().toISOString(); syncUsuariosLocal(); await salvarUsuarioDB(u); }
            renderAdmin();
        }

        function autorizarUsuario(email, valor) { setUserAuthorized(email, valor); }

        function formatarDataParaExibicao(dataISO) {
            if (!dataISO) return '-';
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function getMotivoLabel(motivo) {
            const motivos = {
                'doença': 'Doença',
                'atestado-medico': 'Atestado Médico',
                'falta-justificada': 'Falta Justificada',
                'falta-injustificada': 'Falta Injustificada',
                'licenca-medica': 'Licença Médica',
                'acidente-trabalho': 'Acidente de Trabalho',
                'licenca-maternidade': 'Licença Maternidade',
                'licenca-paternidade': 'Licença Paternidade',
                'ferias': 'Férias',
                'abono': 'Abono',
                'banco-horas': 'Banco de Horas',
                'dispensa-chuva': 'Dispensa por Chuva',
                'outros': 'Outros'
            };
            return motivos[motivo] || motivo;
        }

        function normalizarMotivo(motivo) {
            if (!motivo) return '';
            const s = String(motivo).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
            switch (s) {
                case 'doenca': return 'doença';
                case 'atestado medico':
                case 'atestado-medico':
                    return 'atestado-medico';
                case 'falta justificada':
                case 'falta-justificada':
                    return 'falta-justificada';
                case 'falta injustificada':
                case 'falta-injustificada':
                    return 'falta-injustificada';
                case 'licenca medica':
                case 'licenca-medica':
                    return 'licenca-medica';
                case 'acidente de trabalho':
                case 'acidente-trabalho':
                    return 'acidente-trabalho';
                case 'licenca maternidade':
                case 'licenca-maternidade':
                    return 'licenca-maternidade';
                case 'licenca paternidade':
                case 'licenca-paternidade':
                    return 'licenca-paternidade';
                case 'ferias':
                    return 'ferias';
                case 'abono':
                    return 'abono';
                case 'banco de horas':
                case 'banco-horas':
                    return 'banco-horas';
                case 'dispensa por chuva':
                case 'dispensa-chuva':
                    return 'dispensa-chuva';
                default:
                    return s;
            }
        }

        function isPeriodoMotivo(motivo) {
            const set = new Set(['atestado-medico', 'ferias', 'banco-horas', 'licenca-maternidade', 'licenca-paternidade', 'licenca-medica']);
            return set.has(motivo);
        }

        function isFaltaMotivo(motivo) {
            const naoFalta = new Set(['banco-horas', 'dispensa-chuva', 'abono', 'ferias']);
            return !naoFalta.has(motivo);
        }

        function getPeriodoLabel(motivo) {
            const map = {
                'atestado-medico': 'Atestado',
                'ferias': 'Férias',
                'banco-horas': 'Banco de Horas',
                'licenca-maternidade': 'Licença Maternidade',
                'licenca-paternidade': 'Licença Paternidade',
                'licenca-medica': 'Licença Médica'
            };
            return map[motivo] || 'Período';
        }

        function adicionarRegistroHistorico(tipo, descricao, detalhes = '') {
            const registro = {
                tipo,
                descricao,
                dataHora: new Date().toISOString(),
                usuario: session ? session.user.email : 'Sistema',
                detalhes
            };
            
            historico.unshift(registro);
            localStorage.setItem('historico', JSON.stringify(historico));
            
            // Salvar no banco se estiver logado
            if (session) {
                salvarHistoricoDB(registro);
            }
        }

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', async function() {
            try { if (!localStorage.getItem('adminPasswordHash')) { await setAdminPassword('Guto1006'); } } catch (e) {}
            await initSupabase();
            setupEventListeners();
            try { applyTheme(localStorage.getItem('theme') || 'light'); } catch (e) { applyTheme('light'); }
            
            // Definir data atual no formulário
            document.getElementById('data-falta').value = new Date().toISOString().split('T')[0];
            
            // Definir datas padrão para relatórios
            const hoje = new Date();
            const mesAtual = hoje.toISOString().slice(0, 7);
            const mesAnterior = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1).toISOString().slice(0, 7);
            
            document.getElementById('relatorio-data-inicial').value = mesAnterior;
            document.getElementById('relatorio-data-final').value = mesAtual;

            // Carregar opções de frente para o filtro de relatórios
            carregarOpcoesFrente();

            // Forçar atualização do Dashboard na carga inicial
            atualizarDashboard();
        });

        function setupEventListeners() {
            // Busca de funcionários
            document.getElementById('search-funcionarios').addEventListener('input', debounce(filtrarFuncionarios, 300));
            
            // Filtro de frente e turno
            document.getElementById('filtro-frente-turno').addEventListener('change', filtrarFuncionarios);
            document.getElementById('filtro-lider').addEventListener('change', filtrarFuncionarios);
            
            // Busca de matrícula no formulário de falta
            document.getElementById('matricula-falta').addEventListener('input', debounce(buscarFuncionario, 300));
            
            // Mostrar/ocultar campos de atestado médico no registro
            document.getElementById('motivo-falta').addEventListener('change', function() {
                const atestadoFields = document.getElementById('atestado-fields');
                if (isPeriodoMotivo(this.value)) {
                    atestadoFields.style.display = 'block';
                    document.getElementById('data-inicial-atestado').value = document.getElementById('data-falta').value;
                    const label = getPeriodoLabel(this.value);
                    document.getElementById('label-data-inicial-periodo').textContent = `Data Inicial de ${label}`;
                    document.getElementById('label-duracao-periodo').textContent = `Duração de ${label} (dias)`;
                    if (this.value === 'ferias') {
                        document.getElementById('duracao-atestado').value = '30';
                    }
                    calcularDatasAtestado();
                } else {
                    atestadoFields.style.display = 'none';
                }
            });

            // Mostrar/ocultar campos de atestado médico na edição
            document.getElementById('edit-motivo').addEventListener('change', function() {
                const editAtestadoFields = document.getElementById('edit-atestado-fields');
                if (isPeriodoMotivo(this.value)) {
                    editAtestadoFields.style.display = 'block';
                    const label = getPeriodoLabel(this.value);
                    document.getElementById('label-edit-data-inicial-periodo').textContent = `Data Inicial de ${label}`;
                    document.getElementById('label-edit-duracao-periodo').textContent = `Duração de ${label} (dias)`;
                    calcularDatasAtestadoEdicao();
                } else {
                    editAtestadoFields.style.display = 'none';
                }
            });
            
            // Calcular datas do atestado no registro
            document.getElementById('duracao-atestado').addEventListener('input', calcularDatasAtestado);
            document.getElementById('data-inicial-atestado').addEventListener('change', calcularDatasAtestado);

            // Calcular datas do atestado na edição
            document.getElementById('edit-duracao-atestado').addEventListener('input', calcularDatasAtestadoEdicao);

            // Preview da foto do atestado
            const atestadoFile = document.getElementById('atestado-foto');
            if (atestadoFile) {
                atestadoFile.addEventListener('change', (e) => {
                    const file = e.target && e.target.files ? e.target.files[0] : null;
                    previewAtestadoFoto(file);
                });
            }
            document.getElementById('edit-data-inicial-atestado').addEventListener('change', calcularDatasAtestadoEdicao);
            
            // Submit do formulário de falta
            document.getElementById('falta-form').addEventListener('submit', registrarFalta);
            
            // Submit do formulário de edição
            document.getElementById('form-editar-falta').addEventListener('submit', salvarEdicaoFalta);
            
            // Submit do formulário de funcionário
            document.getElementById('form-funcionario').addEventListener('submit', cadastrarFuncionario);
            
            // Submit do formulário de edição de funcionário
            document.getElementById('form-editar-funcionario').addEventListener('submit', salvarEdicaoFuncionario);
            
            // Enter para consultar faltas
            document.getElementById('consulta-matricula').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') consultarFaltas();
            });

            // Backup file input
            document.getElementById('arquivo-backup').addEventListener('change', importarBackup);
            
            // Filtro de histórico
            document.getElementById('filtro-periodo-historico').addEventListener('change', filtrarHistorico);
            document.getElementById('filtro-tipo-historico').addEventListener('change', filtrarHistorico);

            // Modal listeners
            document.getElementById('modal-cancelar').addEventListener('click', fecharModalConfirmacao);
            document.getElementById('modal-confirmar').addEventListener('click', executarAcaoConfirmada);
            
            // Botão novo funcionário
            document.getElementById('btn-novo-funcionario').addEventListener('click', abrirModalFuncionario);
            document.getElementById('func-cancel').addEventListener('click', fecharModalFuncionario);
            const btnTheme = document.getElementById('btn-toggle-theme');
            if (btnTheme) {
                btnTheme.addEventListener('click', () => {
                    const isDark = document.documentElement.classList.contains('dark');
                    applyTheme(isDark ? 'light' : 'dark');
                });
            }
            const globalSearchInput = document.getElementById('global-search-func');
            const globalSearchBtn = document.getElementById('btn-global-search');
            if (globalSearchInput) {
                globalSearchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        buscarFuncionarioGlobal();
                    }
                });
            }
            if (globalSearchBtn) {
                globalSearchBtn.addEventListener('click', buscarFuncionarioGlobal);
            }
        }

        // ===== FUNÇÕES DE NAVEGAÇÃO =====
        const TAB_IDS = ['dashboard', 'funcionarios', 'registro', 'consulta', 'historico', 'relatorios', 'configuracao', 'admin'];

        function getContent(id) { return document.getElementById(`${id}-content`); }
        function getButton(id) { return document.getElementById(`tab-${id}`); }

        function showTab(tabId) {
            // Remover estado ativo atual
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            const email = session && session.user ? session.user.email : null;
            const isAdmin = isAdminEmail(email);
            const perms = getUserPermissions(email);
            const allowed = isAdmin || (perms && (perms[tabId] || tabId === 'dashboard'));
            const button = getButton(tabId);
            if (button && button.style.display === 'none') {
                if (!allowed) { showMessage('Você não tem permissão para acessar esta aba', 'warning'); return; }
            }

            // Ativar alvo
            const content = getContent(tabId);
            if (content) content.classList.add('active');
            if (button) button.classList.add('active');

            // Atualizar hash
            try {
                const newHash = `#${tabId}`;
                if (location.hash !== newHash) {
                    history.replaceState(null, '', newHash);
                }
            } catch {
                // Ignora erros de histórico em ambientes restritos
            }

            // Chamar funções de atualização específicas da aba
            if (tabId === 'configuracao') {
                atualizarEstatisticas();
            } else if (tabId === 'dashboard') {
                atualizarDashboard();
                // ADICIONADO: garantir que os gráficos reajustem dimensões após a aba ficar visível
                setTimeout(ajustarTamanhoGraficos, 0);
                if (session && !faltasLoadedFromDB) carregarFaltasDB();
            } else if (tabId === 'historico') {
                carregarHistorico();
                if (session && !historicoLoadedFromDB) carregarHistoricoDB();
            } else if (tabId === 'funcionarios') {
                carregarFuncionarios();
            } else if (tabId === 'relatorios') {
                carregarOpcoesFrente();
            } else if (tabId === 'registro') {
                const hojeStr = new Date().toISOString().split('T')[0];
                const dataEl = document.getElementById('data-falta');
                if (dataEl) dataEl.value = hojeStr;
                const matEl = document.getElementById('matricula-falta');
                if (matEl && matEl.value) buscarFuncionario();
                const atestadoFields = document.getElementById('atestado-fields');
                if (atestadoFields) atestadoFields.style.display = 'none';
            } else if (tabId === 'admin') {
                carregarUsuariosDB().then(renderAdmin);
            }
        }

        // Suporte a navegação por hash
        window.addEventListener('hashchange', () => {
            const h = location.hash.replace('#', '');
            if (TAB_IDS.includes(h)) {
                showTab(h);
            }
        });

        // Garantir que uma aba esteja ativa na carga inicial
        const hash = (typeof location !== 'undefined' && location.hash) ? location.hash.replace('#', '') : '';
        const initial = TAB_IDS.includes(hash) ? hash : null;

        if (initial) {
            showTab(initial);
        } else {
            const anyActive = document.querySelector('.tab-content.active');
            const anyButtonActive = document.querySelector('.tab-button.active');
            if (!anyActive || !anyButtonActive) {
                showTab('dashboard');
            }
        }

        window.addEventListener('beforeunload', async () => { try { await marcarUsuarioOffline(); } catch {} });

        const addBtn = document.getElementById('admin-add-btn');
        if (addBtn) addBtn.addEventListener('click', adicionarUsuarioEmail);
        const permCancel = document.getElementById('perm-cancel');
        const permSave = document.getElementById('perm-save');
        if (permCancel) permCancel.addEventListener('click', fecharModalPermissoes);
        if (permSave) permSave.addEventListener('click', salvarModalPermissoes);
        const reloadBtn = document.getElementById('admin-reload-btn');
        if (reloadBtn) reloadBtn.addEventListener('click', () => carregarUsuariosDB().then(renderAdmin));

        // ===== FUNCIONÁRIOS =====
        function carregarFuncionarios() {
            // Alterado: usa filtragem no array e paginação para renderizar
            carregarOpcoesLider();
            funcionariosFiltrados = getFuncionariosFiltrados();
            renderFuncionariosPage();
        }

        function getFuncionariosFiltrados() {
            const search = document.getElementById('search-funcionarios').value.toLowerCase();
            const filtroFrenteTurno = document.getElementById('filtro-frente-turno').value;
            const filtroLider = document.getElementById('filtro-lider').value;

            return funcionarios.filter(func => {
                const texto = `${func.cadastro} ${func.nome} ${func.cargo} ${func.descricaoLocal} ${func.frente || ''} ${func.turno || ''} ${func.lider || ''}`.toLowerCase();
                if (search && !texto.includes(search)) return false;

                if (filtroFrenteTurno !== 'todos') {
                    const temFrenteETurno = !!func.frente && !!func.turno;
                    if (filtroFrenteTurno === 'com-frente-turno' && !temFrenteETurno) return false;
                    if (filtroFrenteTurno === 'sem-frente-turno' && temFrenteETurno) return false;
                }

                if (filtroLider !== 'todos') {
                    if ((func.lider || '').trim() !== filtroLider) return false;
                }
                return true;
            });
        }

        function renderFuncionariosPage() {
            const tbody = document.getElementById('funcionarios-table');
            const totalEl = document.getElementById('total-funcionarios');
            const total = funcionariosFiltrados.length;

            const totalPaginas = Math.max(1, Math.ceil(total / TAM_PAG_FUNC));
            if (paginaFunc > totalPaginas) paginaFunc = totalPaginas;
            const inicio = (paginaFunc - 1) * TAM_PAG_FUNC;
            const fim = inicio + TAM_PAG_FUNC;
            const pageData = funcionariosFiltrados.slice(inicio, fim);

            // Renderização em lote com DocumentFragment
            const frag = document.createDocumentFragment();
            tbody.innerHTML = '';
            pageData.forEach(func => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">${func.cadastro}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${func.nome}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${func.cargo}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${func.descricaoLocal}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${func.frente || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${func.turno || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${func.lider || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${formatarDataParaExibicao(func.admissao)}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                            <button onclick="consultarFaltasFuncionario('${func.cadastro}')" 
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" 
                                    title="Ver faltas">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="abrirHistoricoFuncionario('${func.cadastro}')"
                                    class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200"
                                    title="Histórico">
                                <i class="fas fa-history"></i>
                            </button>
                            <button onclick="editarFuncionario('${func.cadastro}')" 
                                    class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" 
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="excluirFuncionario('${func.cadastro}')" 
                                    class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" 
                                    title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                frag.appendChild(row);
            });
            tbody.appendChild(frag);
            totalEl.textContent = `Total: ${total} funcionário(s)`;
            renderPaginacaoFuncionarios(totalPaginas);
        }

        function renderPaginacaoFuncionarios(totalPaginas) {
            const containerTabela = document.querySelector('#funcionarios-content .overflow-x-auto');
            if (!containerTabela) return;

            let pager = document.getElementById('paginacao-funcionarios');
            if (!pager) {
                pager = document.createElement('div');
                pager.id = 'paginacao-funcionarios';
                pager.className = 'flex items-center justify-end gap-2 mt-3';
                containerTabela.appendChild(pager);
            }
            pager.innerHTML = `
                <button id="func-prev" class="px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700" ${paginaFunc <= 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left mr-1"></i>Anterior
                </button>
                <span class="text-sm text-gray-600 dark:text-gray-300">Página ${paginaFunc} de ${totalPaginas}</span>
                <button id="func-next" class="px-3 py-1 border rounded text-sm hover:bg-gray-100 dark:hover:bg-gray-700" ${paginaFunc >= totalPaginas ? 'disabled' : ''}>
                    Próxima<i class="fas fa-chevron-right ml-1"></i>
                </button>
            `;

            const prev = document.getElementById('func-prev');
            const next = document.getElementById('func-next');
            if (prev) prev.onclick = () => { if (paginaFunc > 1) { paginaFunc--; renderFuncionariosPage(); } };
            if (next) next.onclick = () => { if (paginaFunc < totalPaginas) { paginaFunc++; renderFuncionariosPage(); } };
        }

        function carregarOpcoesLider() {
            const select = document.getElementById('filtro-lider');
            if (!select) return;
            const lideres = [...new Set(funcionarios.map(f => (f.lider || '').trim()).filter(l => l))].sort();
            const current = select.value;
            select.innerHTML = '<option value="todos">Todos os líderes</option>';
            lideres.forEach(l => {
                const option = document.createElement('option');
                option.value = l;
                option.textContent = l;
                select.appendChild(option);
            });
            if (lideres.includes(current)) select.value = current;
        }

        function filtrarFuncionarios() {
            // Alterado: recalcula lista filtrada e renderiza a primeira página
            paginaFunc = 1;
            funcionariosFiltrados = getFuncionariosFiltrados();
            renderFuncionariosPage();
        }

        async function cadastrarFuncionario(e) {
            e.preventDefault();

            const matricula = document.getElementById('func-matricula').value;
            const empresa = document.getElementById('func-empresa').value;
            const nome = document.getElementById('func-nome').value;
            const cargo = document.getElementById('func-cargo').value;
            const descricaoLocal = document.getElementById('func-setor').value;
            const frente = document.getElementById('func-frente').value;
            const turno = document.getElementById('func-turno').value;
            const lider = document.getElementById('func-lider').value;
            const admissao = document.getElementById('func-admissao').value;
            
            // Dados CNH
            const cnhNumero = document.getElementById('func-cnh').value;
            const cnhExpedicao = document.getElementById('func-cnh-expedicao').value;
            const cnhVencimento = document.getElementById('func-cnh-vencimento').value;
            const cnhFotoInput = document.getElementById('func-cnh-foto');
            const cnhFoto = cnhFotoInput && cnhFotoInput.files ? cnhFotoInput.files[0] : null;

            // Validação Motorista
            if (cargo.toLowerCase().includes('motorista')) {
                if (!cnhNumero || !cnhExpedicao || !cnhVencimento) {
                    showMessage('Para motoristas, os dados da CNH são obrigatórios!', 'error');
                    return;
                }
            }

            if (funcionarios.find(f => f.cadastro == matricula)) {
                showMessage('Já existe um funcionário com esta matrícula!', 'error');
                return;
            }

            const novoFuncionario = {
                empresa: Number(empresa),
                cadastro: Number(matricula),
                nome,
                cargo,
                descricaoLocal,
                frente,
                turno,
                lider,
                admissao: admissao || null,
                cnhNumero: cnhNumero || null,
                cnhExpedicao: cnhExpedicao || null,
                cnhVencimento: cnhVencimento || null,
                cnhFotoUrl: null
            };
            
            if (cnhFoto) {
                // Upload da foto
                const url = await uploadAtestadoFoto(cnhFoto, matricula, 'cnh');
                if (url) novoFuncionario.cnhFotoUrl = url;
            }

            const sucessoDB = await salvarFuncionarioDB(novoFuncionario);
            
            if (sucessoDB || !session) {
                funcionarios.push(novoFuncionario);
                localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                
                adicionarRegistroHistorico(
                    'funcionario', 
                    `Funcionário cadastrado: ${nome} (Matrícula: ${matricula})`,
                    `Cargo: ${cargo}, Setor: ${descricaoLocal}, Frente: ${frente || 'N/A'}, Turno: ${turno || 'N/A'}, Líder: ${lider || 'N/A'}`
                );
                
                carregarFuncionarios();
                verificarCNHVencidas();
                showMessage('Funcionário cadastrado com sucesso!', 'success');
                fecharModalFuncionario();
            }
        }

        function editarFuncionario(cadastro) {
            showTab('funcionarios');
            const funcionario = funcionarios.find(f => f.cadastro.toString() === cadastro);
            if (!funcionario) return;

            document.getElementById('edit-func-id').value = funcionario.cadastro;
            document.getElementById('edit-func-matricula').value = funcionario.cadastro;
            document.getElementById('edit-func-empresa').value = funcionario.empresa;
            document.getElementById('edit-func-nome').value = funcionario.nome;
            document.getElementById('edit-func-cargo').value = funcionario.cargo;
            document.getElementById('edit-func-setor').value = funcionario.descricaoLocal;
            document.getElementById('edit-func-frente').value = funcionario.frente || '';
            document.getElementById('edit-func-turno').value = funcionario.turno || '';
            document.getElementById('edit-func-lider').value = funcionario.lider || '';
            
            document.getElementById('edit-func-admissao').value = funcionario.admissao || '';

            // CNH
            document.getElementById('edit-func-cnh').value = funcionario.cnhNumero || '';
            document.getElementById('edit-func-cnh-expedicao').value = funcionario.cnhExpedicao || '';
            document.getElementById('edit-func-cnh-vencimento').value = funcionario.cnhVencimento || '';
            
            const btnVerCnh = document.getElementById('btn-ver-cnh');
            if (funcionario.cnhFotoUrl) {
                btnVerCnh.classList.remove('hidden');
                btnVerCnh.onclick = () => window.open(funcionario.cnhFotoUrl, '_blank');
            } else {
                btnVerCnh.classList.add('hidden');
            }

            document.getElementById('modal-editar-funcionario').classList.add('active');
        }

        async function salvarEdicaoFuncionario(e) {
            e.preventDefault();
            
            const cadastroOriginal = document.getElementById('edit-func-id').value;
            const matricula = document.getElementById('edit-func-matricula').value;
            const empresa = document.getElementById('edit-func-empresa').value;
            const nome = document.getElementById('edit-func-nome').value;
            const cargo = document.getElementById('edit-func-cargo').value;
            const descricaoLocal = document.getElementById('edit-func-setor').value;
            const frente = document.getElementById('edit-func-frente').value;
            const turno = document.getElementById('edit-func-turno').value;
            const lider = document.getElementById('edit-func-lider').value;
            const admissao = document.getElementById('edit-func-admissao').value;
            
            // CNH
            const cnhNumero = document.getElementById('edit-func-cnh').value;
            const cnhExpedicao = document.getElementById('edit-func-cnh-expedicao').value;
            const cnhVencimento = document.getElementById('edit-func-cnh-vencimento').value;
            const cnhFotoInput = document.getElementById('edit-func-cnh-foto');
            const cnhFoto = cnhFotoInput && cnhFotoInput.files ? cnhFotoInput.files[0] : null;

            if (cargo.toLowerCase().includes('motorista')) {
                if (!cnhNumero || !cnhExpedicao || !cnhVencimento) {
                    showMessage('Para motoristas, os dados da CNH são obrigatórios!', 'error');
                    return;
                }
            }

            const index = funcionarios.findIndex(f => f.cadastro.toString() === cadastroOriginal);
            if (index !== -1) {
                const funcionarioOriginal = { ...funcionarios[index] };
                const funcionarioAtualizado = {
                    ...funcionarios[index],
                    cadastro: Number(matricula),
                    empresa: Number(empresa),
                    nome,
                    cargo,
                    descricaoLocal,
                    frente,
                    turno,
                    lider,
                    admissao: admissao || null,
                    cnhNumero,
                    cnhExpedicao: cnhExpedicao || null,
                    cnhVencimento: cnhVencimento || null
                };
                
                if (cnhFoto) {
                    const url = await uploadAtestadoFoto(cnhFoto, matricula, 'cnh');
                    if (url) funcionarioAtualizado.cnhFotoUrl = url;
                }

                const sucessoDB = await salvarFuncionarioDB(funcionarioAtualizado);
                
                if (sucessoDB || !session) {
                    funcionarios[index] = funcionarioAtualizado;

                    faltas.forEach(falta => {
                        if (falta.matricula === cadastroOriginal) {
                            falta.nomeFuncionario = nome;
                        }
                    });

                    localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                    localStorage.setItem('faltas', JSON.stringify(faltas));
                    
                    let alteracoes = [];
                    if (funcionarioOriginal.nome !== nome) alteracoes.push(`Nome: ${funcionarioOriginal.nome} → ${nome}`);
                    if (funcionarioOriginal.cargo !== cargo) alteracoes.push(`Cargo: ${funcionarioOriginal.cargo} → ${cargo}`);
                    if (funcionarioOriginal.descricaoLocal !== descricaoLocal) alteracoes.push(`Setor: ${funcionarioOriginal.descricaoLocal} → ${descricaoLocal}`);
                    if (funcionarioOriginal.frente !== frente) alteracoes.push(`Frente: ${funcionarioOriginal.frente || 'N/A'} → ${frente || 'N/A'}`);
                    if (funcionarioOriginal.turno !== turno) alteracoes.push(`Turno: ${funcionarioOriginal.turno || 'N/A'} → ${turno || 'N/A'}`);
                    if (funcionarioOriginal.lider !== lider) alteracoes.push(`Líder: ${funcionarioOriginal.lider || 'N/A'} → ${lider || 'N/A'}`);
                    if (funcionarioOriginal.admissao !== admissao) alteracoes.push(`Admissão: ${formatarDataParaExibicao(funcionarioOriginal.admissao)} → ${formatarDataParaExibicao(admissao)}`);
                    if (funcionarioOriginal.cnhNumero !== cnhNumero) alteracoes.push(`CNH: ${funcionarioOriginal.cnhNumero || 'N/A'} → ${cnhNumero || 'N/A'}`);
                    
                    if (alteracoes.length > 0) {
                        adicionarRegistroHistorico(
                            'funcionario', 
                            `Funcionário atualizado: ${nome} (Matrícula: ${matricula})`,
                            `Alterações: ${alteracoes.join(', ')}`
                        );
                    }
                    
                    carregarFuncionarios();
                    verificarCNHVencidas();
                    showMessage('Funcionário atualizado com sucesso!', 'success');
                    fecharModalEditarFuncionario();
                }
            }
        }

        async function excluirFuncionario(cadastro) {
            const funcionario = funcionarios.find(f => f.cadastro.toString() === cadastro);
            if (!funcionario) return;
            
            mostrarModalConfirmacao(
                'Excluir Funcionário',
                `Tem certeza que deseja excluir o funcionário ${funcionario.nome} (Matrícula: ${cadastro})? Esta ação não pode ser desfeita e também removerá todas as faltas associadas a ele.`,
                async () => {
                    const sucessoDB = await excluirFuncionarioDB(cadastro);
                    
                    if (sucessoDB || !session) {
                        const index = funcionarios.findIndex(f => f.cadastro.toString() === cadastro);
                        if (index !== -1) {
                            funcionarios.splice(index, 1);
                        }

                        const faltasAntes = faltas.length;
                        faltas = faltas.filter(f => f.matricula !== cadastro);
                        const faltasRemovidas = faltasAntes - faltas.length;

                        localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                        localStorage.setItem('faltas', JSON.stringify(faltas));
                        
                        adicionarRegistroHistorico(
                            'funcionario', 
                            `Funcionário excluído: ${funcionario.nome} (Matrícula: ${cadastro})`,
                            `Foram removidas ${faltasRemovidas} faltas associadas ao funcionário.`
                        );
                        
                        carregarFuncionarios();
                        verificarCNHVencidas();
                        showMessage('Funcionário excluído com sucesso!', 'success');
                    }
                }
            );
        }

        // ===== REGISTRO DE FALTAS =====
        function buscarFuncionario() {
            const matricula = document.getElementById('matricula-falta').value;
            const funcionario = funcionarios.find(f => f.cadastro.toString() === matricula);
            
            if (funcionario) {
                document.getElementById('nome-funcionario').value = funcionario.nome;
                document.getElementById('funcionario-info').innerHTML = `
                    <span class="text-green-600 dark:text-green-400">
                        <i class="fas fa-check-circle mr-1"></i>
                        ${funcionario.cargo} - ${funcionario.descricaoLocal} - ${funcionario.frente || ''} - ${funcionario.lider || ''}
                    </span>
                `;
            } else {
                document.getElementById('nome-funcionario').value = '';
                document.getElementById('funcionario-info').innerHTML = matricula ? 
                    '<span class="text-red-600 dark:text-red-400"><i class="fas fa-times-circle mr-1"></i>Funcionário não encontrado</span>' : '';
            }
        }

        function buscarFuncionarioGlobal() {
            const input = document.getElementById('global-search-func');
            if (!input) return;
            const termoRaw = input.value.trim();
            if (!termoRaw) {
                showMessage('Digite nome ou matrícula para buscar o funcionário.', 'error');
                return;
            }
            const termo = termoRaw.toLowerCase();
            
            let funcionario = null;
            if (/^\d+$/.test(termoRaw)) {
                funcionario = funcionarios.find(f => f.cadastro.toString() === termoRaw);
            }
            if (!funcionario) {
                funcionario = funcionarios.find(f => (f.nome || '').toLowerCase().includes(termo));
            }
            if (!funcionario) {
                showMessage('Funcionário não encontrado na lista carregada.', 'error');
                return;
            }
            
            const campoConsulta = document.getElementById('consulta-matricula');
            if (campoConsulta) {
                campoConsulta.value = funcionario.cadastro.toString();
            }
            showTab('consulta');
            if (typeof consultarFaltas === 'function') {
                consultarFaltas();
            }
        }

        function calcularDatasAtestado() {
            const dataInicial = document.getElementById('data-inicial-atestado').value;
            const duracao = parseInt(document.getElementById('duracao-atestado').value);
            const infoElement = document.getElementById('info-datas-atestado');
            
            if (dataInicial && duracao && duracao > 0) {
                const [ano, mes, dia] = dataInicial.split('-').map(Number);
                const dataInicialObj = new Date(ano, mes - 1, dia);
                const dataFinalObj = new Date(ano, mes - 1, dia + duracao - 1);
                
                const dataFinalFormatada = dataFinalObj.toLocaleDateString('pt-BR');
                const dataInicialFormatada = dataInicialObj.toLocaleDateString('pt-BR');
                
                infoElement.textContent = `Período do atestado: ${dataInicialFormatada} a ${dataFinalFormatada} (${duracao} dias)`;
                infoElement.classList.remove('hidden');
            } else {
                infoElement.classList.add('hidden');
            }
        }

        function previewAtestadoFoto(file) {
            const box = document.getElementById('atestado-foto-preview');
            if (!box) return;
            box.innerHTML = '';
            if (!file) return;
            const img = document.createElement('img');
            img.style.maxHeight = '160px';
            img.style.borderRadius = '8px';
            img.style.objectFit = 'contain';
            const reader = new FileReader();
            reader.onload = () => { img.src = reader.result; box.appendChild(img); };
            reader.readAsDataURL(file);
        }

        async function uploadAtestadoFoto(file, matricula, dataInicial) {
            try {
                if (!file) return null;
                return await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            } catch (error) {
                showMessage('Falha ao enviar foto do atestado: ' + (error && error.message ? error.message : String(error)), 'error');
                return null;
            }
        }

        function calcularDatasAtestadoEdicao() {
            const dataInicial = document.getElementById('edit-data-inicial-atestado').value;
            const duracao = parseInt(document.getElementById('edit-duracao-atestado').value);
            const infoElement = document.getElementById('edit-info-datas-atestado');
            
            if (dataInicial && duracao && duracao > 0) {
                const [ano, mes, dia] = dataInicial.split('-').map(Number);
                const dataInicialObj = new Date(ano, mes - 1, dia);
                const dataFinalObj = new Date(ano, mes - 1, dia + duracao - 1);
                
                const dataFinalFormatada = dataFinalObj.toLocaleDateString('pt-BR');
                const dataInicialFormatada = dataInicialObj.toLocaleDateString('pt-BR');
                
                infoElement.textContent = `Período do atestado: ${dataInicialFormatada} a ${dataFinalFormatada} (${duracao} dias)`;
                infoElement.classList.remove('hidden');
            } else {
                infoElement.classList.add('hidden');
            }
        }

        async function registrarFalta(e) {
            e.preventDefault();
            try {
                const data = document.getElementById('data-falta').value;
                const matricula = document.getElementById('matricula-falta').value;
                const motivo = document.getElementById('motivo-falta').value;
                const observacoes = document.getElementById('observacoes').value;
                const faltaId = document.getElementById('falta-id').value;
                
                const funcionario = funcionarios.find(f => f.cadastro.toString() === matricula);
                const nomeFunc = funcionario ? funcionario.nome : (document.getElementById('nome-funcionario').value || '-');

                if (!matricula || !motivo) {
                    showMessage('Informe matrícula e motivo da falta.', 'error');
                    return;
                }
                if (!data && !isPeriodoMotivo(motivo)) {
                    showMessage('Informe a data da falta.', 'error');
                    return;
                }
                if (!funcionario) {
                    showMessage('Funcionário não encontrado para a matrícula informada.', 'error');
                    return;
                }

            if (isPeriodoMotivo(motivo)) {
                const dataInicialAtestado = document.getElementById('data-inicial-atestado').value;
                let duracaoAtestado = parseInt(document.getElementById('duracao-atestado').value);
                const motivoNorm = normalizarMotivo(motivo);
                // Foto do atestado agora é opcional
                
                if (!dataInicialAtestado || (motivoNorm !== 'ferias' && (!duracaoAtestado || duracaoAtestado <= 0))) {
                    showMessage('Para período, informe data inicial e duração válidas!', 'error');
                    return;
                }
                if (motivoNorm === 'ferias') {
                    if (!duracaoAtestado || duracaoAtestado <= 0) { duracaoAtestado = 30; }
                    const datasAtestado = gerarDatasPeriodo(dataInicialAtestado, duracaoAtestado);
                    const fimPeriodo = datasAtestado[duracaoAtestado - 1];
                    const existeOverlap = faltas.some(f => {
                        if (normalizarMotivo(f.motivo) !== 'ferias' || f.matricula !== matricula) return false;
                        const inicioExist = f.data;
                        let durExist = parseInt(f.diasAtestado);
                        if (!durExist || durExist <= 0) durExist = 30;
                        const diasExist = gerarDatasPeriodo(inicioExist, durExist);
                        const fimExist = diasExist[durExist - 1];
                        return !(fimPeriodo < inicioExist || dataInicialAtestado > fimExist);
                    });
                    if (existeOverlap) { showMessage('Já existe férias registrada que abrange este período!', 'error'); return; }
                    const faltaUnica = {
                        matricula,
                        nomeFuncionario: nomeFunc,
                        data: dataInicialAtestado,
                        motivo,
                        observacoes: observacoes + ` (${getPeriodoLabel(motivo)}: ${formatarDataParaExibicao(dataInicialAtestado)} a ${formatarDataParaExibicao(fimPeriodo)})`,
                        registradoEm: new Date().toISOString(),
                        diasAtestado: duracaoAtestado
                    };
                    if (!session) { faltaUnica.id = gerarIdLocal(); }
                    const sucessoDBFerias = session ? await salvarFaltaDB(faltaUnica) : true;
                    if (sucessoDBFerias) {
                        faltas.push(faltaUnica);
                        if (Array.isArray(window.faltas)) { window.faltas.push(faltaUnica); } else { window.faltas = JSON.parse(localStorage.getItem('faltas') || '[]'); }
                        try { localStorage.setItem('faltas', JSON.stringify(faltas)); } catch (e) { console.warn('Falha ao salvar no localStorage:', e); if (!session) throw e; }
                        adicionarRegistroHistorico('falta', `${getPeriodoLabel(motivo)} registrado: ${nomeFunc} (${duracaoAtestado} dias)`, `Período: ${formatarDataParaExibicao(dataInicialAtestado)} a ${formatarDataParaExibicao(fimPeriodo)}`);
                        showMessage('Férias registrada com sucesso!', 'success');
                        cancelarEdicao();
                    } else { showMessage('Não foi possível registrar as férias.', 'error'); }
                } else {
                    let fotoUrl = null;
                    if (normalizarMotivo(motivo) === 'atestado-medico') {
                        const fileInput = document.getElementById('atestado-foto');
                        const file = fileInput && fileInput.files ? fileInput.files[0] : null;
                        if (file) {
                            fotoUrl = await uploadAtestadoFoto(file, matricula, dataInicialAtestado);
                            if (!fotoUrl) { showMessage('Falha ao processar a foto do atestado', 'error'); return; }
                        }
                    }
                    const datasAtestado = gerarDatasPeriodo(dataInicialAtestado, duracaoAtestado);
                    const faltasExistentes = faltas.filter(f => f.matricula === matricula && datasAtestado.includes(f.data));
                    if (faltasExistentes.length > 0) { showMessage(`Já existem registros para ${faltasExistentes.length} dia(s) deste período!`, 'error'); return; }
                    const novasFaltas = datasAtestado.map(dataAtestado => ({
                        matricula,
                        nomeFuncionario: nomeFunc,
                        data: dataAtestado,
                        motivo,
                        observacoes: observacoes + ` (${getPeriodoLabel(motivo)}: ${formatarDataParaExibicao(dataInicialAtestado)} a ${formatarDataParaExibicao(datasAtestado[datasAtestado.length - 1])})`,
                        registradoEm: new Date().toISOString(),
                        diasAtestado: duracaoAtestado,
                        arquivoAtestadoUrl: fotoUrl || null
                    }));
                    if (!session) { novasFaltas.forEach(f => { f.id = gerarIdLocal(); }); }
                    const sucessoDB = session ? await salvarFaltasDBLote(novasFaltas) : true;
                    if (sucessoDB) {
                        faltas.push(...novasFaltas);
                        if (Array.isArray(window.faltas)) { window.faltas.push(...novasFaltas); } else { window.faltas = JSON.parse(localStorage.getItem('faltas') || '[]'); }
                        try { localStorage.setItem('faltas', JSON.stringify(faltas)); } catch (e) { console.warn('Falha ao salvar no localStorage:', e); if (!session) throw e; }
                        adicionarRegistroHistorico('falta', `${getPeriodoLabel(motivo)} registrado: ${nomeFunc} (${duracaoAtestado} dias)`, `Período: ${formatarDataParaExibicao(dataInicialAtestado)} a ${formatarDataParaExibicao(datasAtestado[datasAtestado.length-1])}`);
                        showMessage(`${getPeriodoLabel(motivo)} registrado com sucesso! ${novasFaltas.length} registro(s) criado(s).`, 'success');
                        cancelarEdicao();
                    } else { showMessage('Não foi possível registrar o atestado.', 'error'); }
                }

            } else {
                const novaFalta = {
                    matricula,
                    nomeFuncionario: nomeFunc,
                    data,
                    motivo,
                    observacoes,
                    registradoEm: new Date().toISOString(),
                    diasAtestado: null
                };

                const faltaExistente = faltas.find(f => f.matricula === matricula && f.data === data);
                if (faltaExistente && faltaExistente.id !== faltaId) {
                    showMessage('Já existe uma falta registrada para este funcionário nesta data!', 'error');
                    return;
                }

                if (faltaId) {
                    novaFalta.id = faltaId;
                }

                if (!session) { novaFalta.id = gerarIdLocal(); }
                const sucessoDB = session ? await salvarFaltaDB(novaFalta) : true;
                
                if (sucessoDB) {
                    if (faltaId) {
                        const index = faltas.findIndex(f => f.id.toString() === faltaId);
                        if (index !== -1) {
                            const faltaOriginal = { ...faltas[index] };
                            faltas[index] = novaFalta;
                            
                            let alteracoes = [];
                            if (faltaOriginal.data !== novaFalta.data) alteracoes.push(`Data: ${formatarDataParaExibicao(faltaOriginal.data)} → ${formatarDataParaExibicao(novaFalta.data)}`);
                            if (faltaOriginal.motivo !== novaFalta.motivo) alteracoes.push(`Motivo: ${getMotivoLabel(faltaOriginal.motivo)} → ${getMotivoLabel(novaFalta.motivo)}`);
                            if (faltaOriginal.observacoes !== novaFalta.observacoes) alteracoes.push(`Observações alteradas`);
                            
                            if (alteracoes.length > 0) {
                            adicionarRegistroHistorico(
                                'falta', 
                                `Falta atualizada: ${nomeFunc} (${formatarDataParaExibicao(novaFalta.data)})`,
                                `Alterações: ${alteracoes.join(', ')}`
                            );
                            }
                            showMessage('Falta atualizada com sucesso!', 'success');
                        }
                    } else {
                        faltas.push(novaFalta);
                        adicionarRegistroHistorico(
                            'falta', 
                            `Falta registrada: ${nomeFunc} (${formatarDataParaExibicao(data)})`,
                            `Motivo: ${getMotivoLabel(motivo)}`
                        );
                        showMessage('Falta registrada com sucesso!', 'success');
                    }
                    try { localStorage.setItem('faltas', JSON.stringify(faltas)); } catch (e) { console.warn('Falha ao salvar no localStorage:', e); if (!session) throw e; }
                    cancelarEdicao();
                }
            }
            } catch (error) {
                console.error('Erro ao registrar falta:', error);
                showMessage('Erro ao registrar falta: ' + (error && error.message ? error.message : String(error)), 'error');
            }
        }

        function gerarDatasPeriodo(dataInicial, duracao) {
            const datas = [];
            const dataBase = new Date(dataInicial + 'T12:00:00');
            
            for (let i = 0; i < duracao; i++) {
                const data = new Date(dataBase);
                data.setDate(dataBase.getDate() + i);
                
                const ano = data.getFullYear();
                const mes = String(data.getMonth() + 1).padStart(2, '0');
                const dia = String(data.getDate()).padStart(2, '0');
                
                const dataFormatada = `${ano}-${mes}-${dia}`;
                datas.push(dataFormatada);
            }
            
            return datas;
        }

        function cancelarEdicao() {
            document.getElementById('falta-form').reset();
            document.getElementById('falta-id').value = '';
            document.getElementById('nome-funcionario').value = '';
            document.getElementById('funcionario-info').innerHTML = '';
            document.getElementById('data-falta').value = new Date().toISOString().split('T')[0];
            document.getElementById('atestado-fields').style.display = 'none';
            
            document.getElementById('form-title').textContent = 'Registrar Nova Falta';
            document.getElementById('btn-submit-text').textContent = 'Registrar Falta';
            document.getElementById('btn-cancelar').style.display = 'none';
        }

        // ===== CONSULTA DE FALTAS =====
        function consultarFaltas() {
            const matricula = document.getElementById('consulta-matricula').value;
            if (!matricula) {
                showMessage('Digite uma matrícula para consultar', 'error');
                return;
            }
            
            consultarFaltasFuncionario(matricula);
        }

        function consultarFaltasFuncionario(matricula) {
            const funcionario = funcionarios.find(f => f.cadastro.toString() === matricula);
            
            if (!funcionario) {
                showMessage('Funcionário não encontrado!', 'error');
                document.getElementById('funcionario-consulta-info').classList.add('hidden');
                document.getElementById('resumo-faltas').classList.add('hidden');
                document.getElementById('lista-faltas').classList.add('hidden');
                document.getElementById('sem-faltas').classList.remove('hidden');
                return;
            }
            
            showTab('consulta');
            document.getElementById('consulta-matricula').value = matricula;
            
            document.getElementById('funcionario-consulta-info').classList.remove('hidden');
            document.getElementById('consulta-nome').textContent = funcionario.nome;
            document.getElementById('consulta-cargo').textContent = funcionario.cargo;
            document.getElementById('consulta-setor').textContent = funcionario.descricaoLocal;
            
            const faltasFuncionario = faltas.filter(f => f.matricula === matricula);
            
            if (faltasFuncionario.length === 0) {
                document.getElementById('resumo-faltas').classList.add('hidden');
                document.getElementById('lista-faltas').classList.add('hidden');
                document.getElementById('sem-faltas').classList.remove('hidden');
                return;
            }
            
            document.getElementById('sem-faltas').classList.add('hidden');
            
            const agora = new Date();
            const mesAtual = `${agora.getFullYear()}-${String(agora.getMonth() + 1).padStart(2, '0')}`;
            
            const faltasValidas = faltasFuncionario.filter(f => isFaltaMotivo(f.motivo));
            const totalFaltas = faltasValidas.length;
            const faltasInjustificadas = faltasValidas.filter(f => f.motivo === 'falta-injustificada').length;
            const faltasJustificadas = totalFaltas - faltasInjustificadas;
            const faltasMes = faltasValidas.filter(f => f.data.startsWith(mesAtual)).length;
            
            document.getElementById('total-faltas').textContent = totalFaltas;
            document.getElementById('faltas-injustificadas').textContent = faltasInjustificadas;
            document.getElementById('faltas-justificadas').textContent = faltasJustificadas;
            document.getElementById('faltas-mes').textContent = faltasMes;
            document.getElementById('resumo-faltas').classList.remove('hidden');
            
            exibirListaFaltas(faltasFuncionario);
            document.getElementById('lista-faltas').classList.remove('hidden');
        }

        function exibirListaFaltas(faltasList) {
            const tbody = document.getElementById('faltas-table');
            tbody.innerHTML = '';
            
            faltasList.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            faltasList.forEach(falta => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                
                const dataFormatada = formatarDataParaExibicao(falta.data);
                const registroFormatado = new Date(falta.registradoEm).toLocaleString('pt-BR');
                
                let motivoClass = '';
                if (falta.motivo === 'falta-injustificada') {
                    motivoClass = 'text-red-600 dark:text-red-400';
                } else if (falta.motivo === 'doença' || falta.motivo === 'atestado-medico') {
                    motivoClass = 'text-yellow-600 dark:text-yellow-400';
                } else if (falta.motivo === 'banco-horas' || falta.motivo === 'dispensa-chuva') {
                    motivoClass = 'text-blue-600 dark:text-blue-400';
                } else {
                    motivoClass = 'text-green-600 dark:text-green-400';
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-center">
                        <input type="checkbox" class="falta-checkbox" value="${falta.id}">
                    </td>
                    <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">${dataFormatada}</td>
                    <td class="px-4 py-3 text-sm ${motivoClass}">${getMotivoLabel(falta.motivo)}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${falta.observacoes || '-'}</td>
                    <td class="px-4 py-3 text-sm text-center">
                        ${falta.arquivoAtestadoUrl ? `
                            <button onclick="verAtestadoFalta('${falta.id}')" 
                                    class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200" 
                                    title="Ver atestado">
                                <i class="fas fa-file-image"></i>
                            </button>
                        ` : '-'}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${registroFormatado}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                            <button onclick="editarFalta('${falta.id}')" 
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" 
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="excluirFalta('${falta.id}')" 
                                    class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" 
                                    title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function verAtestadoFalta(id) {
            const falta = faltas.find(f => f.id && f.id.toString() === id.toString());
            if (!falta || !falta.arquivoAtestadoUrl) {
                showMessage('Esta falta não possui atestado anexado.', 'error');
                return;
            }
            const win = window.open();
            if (!win) return;
            win.document.write(`
                <html>
                    <head>
                        <title>Atestado</title>
                    </head>
                    <body style="margin:0;background:#111;display:flex;align-items:center;justify-content:center;">
                        <img src="${falta.arquivoAtestadoUrl}" style="max-width:100%;max-height:100%;object-fit:contain;"/>
                    </body>
                </html>
            `);
        }

        function filtrarFaltas() {
            const matricula = document.getElementById('consulta-matricula').value;
            const mesFiltro = document.getElementById('filtro-mes').value;
            
            if (!matricula) return;
            
            let faltasFuncionario = faltas.filter(f => f.matricula === matricula);
            
            if (mesFiltro) {
                faltasFuncionario = faltasFuncionario.filter(f => f.data.startsWith(mesFiltro));
            }
            
            exibirListaFaltas(faltasFuncionario);
        }

        // ===== FUNÇÕES PARA EXCLUSÃO EM LOTE =====
        function selecionarTodasFaltas(selecionar) {
            const checkboxes = document.querySelectorAll('.falta-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selecionar;
            });
        }

        function obterFaltasSelecionadas() {
            const checkboxes = document.querySelectorAll('.falta-checkbox:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        async function excluirFaltasEmLote() {
            if (!canDelete()) { showMessage('Sem permissão para excluir. Faça login com o email autorizado.', 'error'); return; }
            const faltasSelecionadas = obterFaltasSelecionadas();
            
            if (faltasSelecionadas.length === 0) {
                showMessage('Selecione pelo menos uma falta para excluir', 'error');
                return;
            }
            
            mostrarModalConfirmacao(
                'Excluir Faltas Selecionadas',
                `Tem certeza que deseja excluir ${faltasSelecionadas.length} falta(s) selecionada(s)? Esta ação não pode ser desfeita.`,
                async () => {
                    const matricula = document.getElementById('consulta-matricula').value;
                    let excluidasComSucesso = 0;

                    // Uma chamada de banco só para todas as faltas selecionadas
                    const sucessoDB = await excluirFaltasDBLote(faltasSelecionadas);
                    
                    if (sucessoDB) {
                        // Remove localmente de uma vez (menos re-render)
                        const setIds = new Set(faltasSelecionadas.map(id => id.toString()));
                        const antes = faltas.length;
                        faltas = faltas.filter(f => !setIds.has(f.id?.toString()));
                        excluidasComSucesso = antes - faltas.length;

                        localStorage.setItem('faltas', JSON.stringify(faltas));
                        
                        adicionarRegistroHistorico(
                            'falta', 
                            `${excluidasComSucesso} falta(s) excluída(s) em lote`,
                            `Matrícula: ${matricula}`
                        );
                        
                        showMessage(`${excluidasComSucesso} falta(s) excluída(s) com sucesso!`, 'success');
                        
                        if (matricula) {
                            consultarFaltasFuncionario(matricula);
                        }
                    }
                }
            );
        }

        // ===== EDIÇÃO E EXCLUSÃO DE FALTAS =====
        function editarFalta(faltaId) {
            const falta = faltas.find(f => f.id.toString() === faltaId);
            if (!falta) return;

            document.getElementById('edit-falta-id').value = falta.id;
            document.getElementById('edit-data').value = falta.data;
            document.getElementById('edit-motivo').value = falta.motivo;
            document.getElementById('edit-observacoes').value = falta.observacoes || '';

            const editAtestadoFields = document.getElementById('edit-atestado-fields');
            if (isPeriodoMotivo(falta.motivo)) {
                editAtestadoFields.style.display = 'block';
                document.getElementById('edit-data-inicial-atestado').value = falta.data;
                document.getElementById('edit-duracao-atestado').value = falta.diasAtestado || '';
                calcularDatasAtestadoEdicao();
            } else {
                editAtestadoFields.style.display = 'none';
                document.getElementById('edit-data-inicial-atestado').value = '';
                document.getElementById('edit-duracao-atestado').value = '';
                document.getElementById('edit-info-datas-atestado').classList.add('hidden');
            }

            document.getElementById('modal-editar').classList.add('active');
        }

        async function salvarEdicaoFalta(e) {
            e.preventDefault();
            
            const faltaId = document.getElementById('edit-falta-id').value;
            const data = document.getElementById('edit-data').value;
            const motivo = document.getElementById('edit-motivo').value;
            const observacoes = document.getElementById('edit-observacoes').value;
            
            const index = faltas.findIndex(f => f.id.toString() === faltaId);
            if (index !== -1) {
                const faltaOriginal = { ...faltas[index] };
                let faltaAtualizada = {
                    ...faltas[index],
                    data,
                    motivo,
                    observacoes,
                    modificadoEm: new Date().toISOString()
                };

            if (isPeriodoMotivo(motivo)) {
                const editDataInicialAtestado = document.getElementById('edit-data-inicial-atestado').value;
                const editDuracaoAtestado = parseInt(document.getElementById('edit-duracao-atestado').value);

                    if (!editDataInicialAtestado || !editDuracaoAtestado || editDuracaoAtestado <= 0) {
                        showMessage('Para atestado médico, informe data inicial e duração válidas!', 'error');
                        return;
                    }
                    faltaAtualizada.diasAtestado = editDuracaoAtestado;
                    faltaAtualizada.observacoes = observacoes + ` (${getPeriodoLabel(motivo)}: ${formatarDataParaExibicao(editDataInicialAtestado)} a ${formatarDataParaExibicao(gerarDatasPeriodo(editDataInicialAtestado, editDuracaoAtestado)[editDuracaoAtestado-1])})`;
                } else {
                    faltaAtualizada.diasAtestado = null;
                }

                const sucessoDB = await salvarFaltaDB(faltaAtualizada);
                
                if (sucessoDB || !session) {
                    faltas[index] = faltaAtualizada;
                    
                    localStorage.setItem('faltas', JSON.stringify(faltas));
                    
                    let alteracoes = [];
                    if (faltaOriginal.data !== data) alteracoes.push(`Data: ${formatarDataParaExibicao(faltaOriginal.data)} → ${formatarDataParaExibicao(data)}`);
                    if (faltaOriginal.motivo !== motivo) alteracoes.push(`Motivo: ${getMotivoLabel(faltaOriginal.motivo)} → ${getMotivoLabel(motivo)}`);
                    if (faltaOriginal.observacoes !== observacoes) alteracoes.push(`Observações alteradas`);
                    if (faltaOriginal.diasAtestado !== faltaAtualizada.diasAtestado) alteracoes.push(`Dias Atestado: ${faltaOriginal.diasAtestado || 'N/A'} → ${faltaAtualizada.diasAtestado || 'N/A'}`);
                    
                    if (alteracoes.length > 0) {
                        adicionarRegistroHistorico(
                            'falta', 
                            `Falta atualizada: ${faltaOriginal.nomeFuncionario} (${formatarDataParaExibicao(data)})`,
                            `Alterações: ${alteracoes.join(', ')}`
                        );
                    }
                    
                    showMessage('Falta atualizada com sucesso!', 'success');
                    fecharModalEditar();
                    
                    const matricula = document.getElementById('consulta-matricula').value;
                    if (matricula) {
                        consultarFaltasFuncionario(matricula);
                    }
                }
            }
        }

        async function excluirFalta(faltaId) {
            if (!canDelete()) { showMessage('Sem permissão para excluir. Faça login com o email autorizado.', 'error'); return; }
            const falta = faltas.find(f => f.id.toString() === faltaId);
            if (!falta) return;
            
            mostrarModalConfirmacao(
                'Excluir Falta',
                `Tem certeza que deseja excluir a falta de ${falta.nomeFuncionario} em ${formatarDataParaExibicao(falta.data)}? Esta ação não pode ser desfeita.`,
                async () => {
                    const sucessoDB = await excluirFaltaDB(faltaId);
                    
                    if (sucessoDB) {
                        const index = faltas.findIndex(f => f.id.toString() === faltaId);
                        if (index !== -1) {
                            faltas.splice(index, 1);
                        }
                        
                        localStorage.setItem('faltas', JSON.stringify(faltas));
                        
                        adicionarRegistroHistorico(
                            'falta', 
                            `Falta excluída: ${falta.nomeFuncionario} (${formatarDataParaExibicao(falta.data)})`,
                            `Motivo original: ${getMotivoLabel(falta.motivo)}`
                        );
                        
                        showMessage('Falta excluída com sucesso!', 'success');
                        const matricula = document.getElementById('consulta-matricula').value;
                        if (matricula) {
                            consultarFaltasFuncionario(matricula);
                        }
                    }
                }
            );
        }

        // ===== HISTÓRICO =====
        function carregarHistorico() {
            filtrarHistorico();
        }

        function filtrarHistorico() {
            const tipo = document.getElementById('filtro-tipo-historico').value;
            const periodo = document.getElementById('filtro-periodo-historico').value;
            
            let historicoFiltrado = [...historico];
            
            if (tipo !== 'todos') {
                historicoFiltrado = historicoFiltrado.filter(item => item.tipo === tipo);
            }
            
            if (periodo !== 'todos') {
                const dias = parseInt(periodo);
                const dataLimite = new Date();
                dataLimite.setDate(dataLimite.getDate() - dias);
                
                historicoFiltrado = historicoFiltrado.filter(item => {
                    const dataItem = new Date(item.dataHora);
                    return dataItem >= dataLimite;
                });
            }
            
            exibirHistorico(historicoFiltrado);
        }

        function exibirHistorico(historicoList) {
            const tbody = document.getElementById('historico-table');
            const semHistorico = document.getElementById('sem-historico');
            
            tbody.innerHTML = '';
            
            if (historicoList.length === 0) {
                semHistorico.classList.remove('hidden');
                return;
            }
            
            semHistorico.classList.add('hidden');
            
            historicoList.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                
                const dataHoraFormatada = new Date(item.dataHora).toLocaleString('pt-BR');
                
                let tipoBadge = '';
                switch(item.tipo) {
                    case 'funcionario':
                        tipoBadge = '<span class="badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">Funcionário</span>';
                        break;
                    case 'falta':
                        tipoBadge = '<span class="badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Falta</span>';
                        break;
                    case 'sistema':
                        tipoBadge = '<span class="badge bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Sistema</span>';
                        break;
                    default:
                        tipoBadge = '<span class="badge bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Outro</span>';
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${dataHoraFormatada}</td>
                    <td class="px-4 py-3 text-sm">${tipoBadge}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.descricao}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${item.usuario}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${item.detalhes || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ===== MODAIS =====
        let acaoConfirmada = null;

        function mostrarModalConfirmacao(titulo, mensagem, callback) {
            document.getElementById('modal-titulo').textContent = titulo;
            document.getElementById('modal-mensagem').textContent = mensagem;
            acaoConfirmada = callback;
            document.getElementById('modal-confirmacao').classList.add('active');
        }

        function fecharModalConfirmacao() {
            document.getElementById('modal-confirmacao').classList.remove('active');
            acaoConfirmada = null;
        }

        function executarAcaoConfirmada() {
            if (acaoConfirmada) {
                acaoConfirmada();
            }
            fecharModalConfirmacao();
        }

        function abrirModalFuncionario() {
            document.getElementById('modal-funcionario').classList.add('active');
            document.getElementById('form-funcionario').reset();
            document.getElementById('func-matricula').disabled = false;
        }

        function fecharModalFuncionario() {
            document.getElementById('modal-funcionario').classList.remove('active');
            document.getElementById('form-funcionario').reset();
        }

        function fecharModalEditarFuncionario() {
            document.getElementById('modal-editar-funcionario').classList.remove('active');
        }

        function fecharModalHistoricoFuncionario() {
            document.getElementById('modal-historico-funcionario').classList.remove('active');
        }

        async function abrirHistoricoFuncionario(cadastro) {
            const modal = document.getElementById('modal-historico-funcionario');
            if (!modal) return;

            if (session && sb && !historicoLoadedFromDB) {
                try {
                    await carregarHistoricoDB();
                } catch (e) {}
            }

            const funcionario = funcionarios.find(f => f.cadastro.toString() === cadastro);
            if (!funcionario) return;

            const nomeEl = document.getElementById('hist-func-nome');
            const matEl = document.getElementById('hist-func-matricula');
            const cargoEl = document.getElementById('hist-func-cargo');
            if (nomeEl) nomeEl.textContent = funcionario.nome;
            if (matEl) matEl.textContent = funcionario.cadastro;
            if (cargoEl) cargoEl.textContent = `${funcionario.cargo} - ${funcionario.descricaoLocal || ''}`;

            const listaEl = document.getElementById('historico-funcionario-lista');
            const vazioEl = document.getElementById('historico-funcionario-vazio');
            if (!listaEl || !vazioEl) return;

            listaEl.innerHTML = '';

            const termoMatricula = `matrícula: ${cadastro}`.toLowerCase();
            const nomeLower = (funcionario.nome || '').toLowerCase();

            const registros = historico
                .filter(item => {
                    const desc = (item.descricao || '').toLowerCase();
                    const det = (item.detalhes || '').toLowerCase();
                    if (!desc && !det) return false;
                    if (desc.includes(nomeLower) || det.includes(nomeLower)) return true;
                    if (desc.includes(termoMatricula) || det.includes(termoMatricula)) return true;
                    return false;
                })
                .sort((a, b) => new Date(b.dataHora || b.data_hora || 0) - new Date(a.dataHora || a.data_hora || 0));

            if (registros.length === 0) {
                vazioEl.classList.remove('hidden');
                modal.classList.add('active');
                return;
            }

            vazioEl.classList.add('hidden');

            registros.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';

                const dataStr = item.dataHora || item.data_hora || '';
                const dataFormatada = dataStr ? new Date(dataStr).toLocaleString('pt-BR') : '-';

                let tipoBadge = '';
                if (item.tipo === 'funcionario') {
                    tipoBadge = '<span class="badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">Funcionário</span>';
                } else if (item.tipo === 'falta') {
                    tipoBadge = '<span class="badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Falta</span>';
                } else if (item.tipo === 'sistema') {
                    tipoBadge = '<span class="badge bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Sistema</span>';
                } else {
                    tipoBadge = '<span class="badge bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Outro</span>';
                }

                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${dataFormatada}</td>
                    <td class="px-4 py-3 text-sm">${tipoBadge}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.descricao || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${item.usuario || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${item.detalhes || '-'}</td>
                `;
                listaEl.appendChild(row);
            });

            modal.classList.add('active');
        }

        function fecharModalEditar() {
            document.getElementById('modal-editar').classList.remove('active');
            document.getElementById('form-editar-falta').reset();
            document.getElementById('edit-atestado-fields').style.display = 'none';
        }

        // ===== DASHBOARD =====
        var graficoMotivos = null;
        var graficoEvolucao = null;
        var graficoSetores = null;
        var graficoTurnos = null;
        // Aviso único caso Chart.js não esteja disponível
        let avisouChartsIndisponiveis = false;

        // ADICIONADO: helper para obter a lib do Chart.js no ambiente UMD (Chart ou Chart.Chart)
        function getChartLib() {
            const C = window.Chart;
            return C && (C.Chart || C);
        }

        // ADICIONADO: função para ajustar tamanho dos gráficos quando o container volta a ficar visível
        function ajustarTamanhoGraficos() {
            const ChartLib = getChartLib();
            if (!ChartLib) return;
            [graficoMotivos, graficoEvolucao, graficoSetores, graficoTurnos].forEach(chart => {
                if (chart) {
                    chart.resize();
                    chart.update();
                }
            });
        }

        function inicializarDashboard() {
            atualizarDashboard();
            carregarOpcoesDashboardFiltros();
            document.getElementById('filtro-frente-dashboard')?.addEventListener('change', atualizarDashboard);
            document.getElementById('filtro-lider-dashboard')?.addEventListener('change', atualizarDashboard);
        }

        function carregarOpcoesDashboardFiltros() {
            const frenteSelect = document.getElementById('filtro-frente-dashboard');
            const liderSelect = document.getElementById('filtro-lider-dashboard');
            if (frenteSelect) {
                const frentes = [...new Set(funcionarios.map(f => f.frente).filter(f => f && f.trim() !== ''))].sort();
                const current = frenteSelect.value;
                frenteSelect.innerHTML = '<option value="todas">Todas as Frentes</option>';
                frentes.forEach(frente => {
                    const option = document.createElement('option');
                    option.value = frente;
                    option.textContent = frente;
                    frenteSelect.appendChild(option);
                });
                if (frentes.includes(current)) frenteSelect.value = current;
            }
            if (liderSelect) {
                const lideres = [...new Set(funcionarios.map(f => (f.lider || '').trim()).filter(l => l))].sort();
                const current = liderSelect.value;
                liderSelect.innerHTML = '<option value="todos">Todos os Líderes</option>';
                lideres.forEach(l => {
                    const option = document.createElement('option');
                    option.value = l;
                    option.textContent = l;
                    liderSelect.appendChild(option);
                });
                if (lideres.includes(current)) liderSelect.value = current;
            }
        }

        function verificarCNHVencidas() {
            if (!funcionarios || funcionarios.length === 0) return;

            const motoristas = funcionarios.filter(f => f.cargo && f.cargo.toLowerCase().includes('motorista'));
            const hoje = new Date();
            const trintaDiasDepois = new Date();
            trintaDiasDepois.setDate(hoje.getDate() + 30);

            const alertasNormais = [];
            const alertasCriticos = []; // CNHs vencidas

            motoristas.forEach(m => {
                if (!m.cnhNumero || !m.cnhVencimento) {
                    alertasNormais.push({
                        tipo: 'pendencia',
                        msg: `${m.nome}: Dados da CNH incompletos.`,
                        cadastro: m.cadastro
                    });
                } else {
                    const vencimento = new Date(m.cnhVencimento);
                    // Reset time part for accurate date comparison
                    vencimento.setHours(0, 0, 0, 0);
                    hoje.setHours(0, 0, 0, 0);
                    
                    if (vencimento < hoje) {
                        // Vencida: alerta crítico (modal)
                        alertasCriticos.push({
                            nome: m.nome,
                            vencimento: m.cnhVencimento.split('-').reverse().join('/'),
                            cadastro: m.cadastro
                        });

                        // Também mantém no alerta lateral para referência
                        alertasNormais.push({
                            tipo: 'vencida',
                            msg: `${m.nome}: CNH vencida em ${m.cnhVencimento.split('-').reverse().join('/')}.`,
                            cadastro: m.cadastro
                        });
                    } else if (vencimento <= trintaDiasDepois) {
                        alertasNormais.push({
                            tipo: 'vencendo',
                            msg: `${m.nome}: CNH vence em ${m.cnhVencimento.split('-').reverse().join('/')}.`,
                            cadastro: m.cadastro
                        });
                    }
                }
            });

            if (alertasCriticos.length > 0) {
                mostrarModalCNHVencida(alertasCriticos);
            }

            if (alertasNormais.length > 0) {
                mostrarAlertaCNH(alertasNormais);
            }
        }

        function mostrarModalCNHVencida(vencidos) {
            // Remove existing modal if any
            const existing = document.getElementById('modal-cnh-vencida');
            if (existing) existing.remove();

            const modal = document.createElement('div');
            modal.id = 'modal-cnh-vencida';
            modal.className = 'fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in';
            
            let html = `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-lg p-6 m-4 border-2 border-red-500 animate-scale-in relative">
                    <button onclick="document.getElementById('modal-cnh-vencida').remove()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:text-gray-400">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                    
                    <div class="text-center mb-6">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 dark:bg-red-900 mb-4">
                            <i class="fas fa-exclamation-triangle text-3xl text-red-600 dark:text-red-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-red-600 dark:text-red-400">ATENÇÃO: CNH VENCIDA</h2>
                        <p class="text-gray-600 dark:text-gray-300 mt-2">Os seguintes motoristas estão com a CNH vencida:</p>
                    </div>

                    <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 max-h-60 overflow-y-auto custom-scrollbar border border-red-100 dark:border-red-800">
                        <ul class="space-y-3">
            `;

            vencidos.forEach(v => {
                html += `
                    <li onclick="document.getElementById('modal-cnh-vencida').remove(); editarFuncionario('${v.cadastro}')"
                        class="flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded shadow-sm border-l-4 border-red-500 cursor-pointer hover:bg-red-50 dark:hover:bg-gray-700">
                        <span class="font-semibold text-gray-800 dark:text-gray-200">${v.nome}</span>
                        <span class="text-red-600 dark:text-red-400 font-bold text-sm">Venceu: ${v.vencimento}</span>
                    </li>
                `;
            });

            html += `
                        </ul>
                    </div>

                    <div class="mt-6 text-center">
                        <button onclick="document.getElementById('modal-cnh-vencida').remove()" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">
                            Entendido
                        </button>
                    </div>
                </div>
            `;

            modal.innerHTML = html;
            document.body.appendChild(modal);
        }

        function mostrarAlertaCNH(alertas) {
            // Remove existing alert if any
            const existing = document.getElementById('alerta-cnh-container');
            if (existing) existing.remove();

            const container = document.createElement('div');
            container.id = 'alerta-cnh-container';
            container.className = 'fixed top-20 right-4 z-50 w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-yellow-400 p-4 animate-slide-in';
            
            let html = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-bold text-yellow-600 dark:text-yellow-400 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle"></i> Alertas de CNH
                    </h3>
                    <button onclick="this.closest('#alerta-cnh-container').remove()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
            `;

            alertas.forEach(a => {
                let colorClass = 'text-gray-700 dark:text-gray-300';
                let icon = 'fa-info-circle';
                
                if (a.tipo === 'vencida') {
                    colorClass = 'text-red-600 dark:text-red-400 font-semibold';
                    icon = 'fa-times-circle';
                } else if (a.tipo === 'vencendo') {
                    colorClass = 'text-yellow-600 dark:text-yellow-400';
                    icon = 'fa-clock';
                } else {
                    colorClass = 'text-orange-500 dark:text-orange-400';
                    icon = 'fa-clipboard-list';
                }

                const onClick = a.cadastro ? `onclick="editarFuncionario('${a.cadastro}')"` : '';

                html += `
                    <div ${onClick} class="flex items-start gap-2 text-sm p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                        <i class="fas ${icon} mt-1 ${colorClass}"></i>
                        <span class="${colorClass}">${a.msg}</span>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
            document.body.appendChild(container);
        }

        function atualizarPainelAlertas() {
            const agora = new Date();
            const ano = agora.getFullYear();
            const mes = agora.getMonth();
            
            // 1. Faltas Excessivas (>3/mês atual - Injustificadas)
            const faltasDoMes = faltas.filter(f => {
                const d = new Date(f.data + 'T12:00:00');
                return d.getMonth() === mes && d.getFullYear() === ano && f.motivo === 'falta-injustificada';
            });
            
            const contagemFaltas = {};
            faltasDoMes.forEach(f => {
                contagemFaltas[f.matricula] = (contagemFaltas[f.matricula] || 0) + 1;
            });
            
            const containerFaltas = document.getElementById('lista-alertas-faltas');
            if (containerFaltas) {
                containerFaltas.innerHTML = '';
                let hasFaltas = false;
                Object.entries(contagemFaltas).forEach(([matricula, qtd]) => {
                    if (qtd > 3) {
                        const func = funcionarios.find(f => f.cadastro.toString() === matricula);
                        if (func) {
                            hasFaltas = true;
                            containerFaltas.innerHTML += `
                                <div class="flex items-center justify-between p-2 bg-red-100 dark:bg-red-900/30 rounded border-l-4 border-red-500 mb-1">
                                    <span class="font-medium text-red-800 dark:text-red-300 truncate max-w-[150px]" title="${func.nome}">${func.nome}</span>
                                    <span class="font-bold text-red-600 dark:text-red-400 text-sm whitespace-nowrap">${qtd} faltas</span>
                                </div>
                            `;
                        }
                    }
                });
                if (!hasFaltas) containerFaltas.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>';
            }

            // 2. CNH Vencendo/Vencida
            const containerCNH = document.getElementById('lista-alertas-cnh');
            if (containerCNH) {
                containerCNH.innerHTML = '';
                let hasCNH = false;
                const motoristas = funcionarios.filter(f => f.cargo && f.cargo.toLowerCase().includes('motorista'));
                
                motoristas.forEach(m => {
                    if (m.cnhVencimento) {
                        const vencimento = new Date(m.cnhVencimento);
                        vencimento.setHours(0,0,0,0);
                        const hojeZero = new Date();
                        hojeZero.setHours(0,0,0,0);
                        const trintaDias = new Date(hojeZero);
                        trintaDias.setDate(trintaDias.getDate() + 30);
                        
                        if (vencimento < hojeZero) {
                            hasCNH = true;
                            containerCNH.innerHTML += `
                                <div onclick="editarFuncionario('${m.cadastro}')" class="flex items-center justify-between p-2 bg-red-100 dark:bg-red-900/30 rounded border-l-4 border-red-500 mb-1 cursor-pointer hover:bg-red-200 dark:hover:bg-red-900/50">
                                    <span class="font-medium text-red-800 dark:text-red-300 truncate max-w-[150px]" title="${m.nome}">${m.nome}</span>
                                    <span class="text-xs font-bold text-red-600 dark:text-red-400 whitespace-nowrap">Vencida: ${m.cnhVencimento.split('-').reverse().join('/')}</span>
                                </div>
                            `;
                        } else if (vencimento <= trintaDias) {
                            hasCNH = true;
                            containerCNH.innerHTML += `
                                <div onclick="editarFuncionario('${m.cadastro}')" class="flex items-center justify-between p-2 bg-orange-100 dark:bg-orange-900/30 rounded border-l-4 border-orange-500 mb-1 cursor-pointer hover:bg-orange-200 dark:hover:bg-orange-900/50">
                                    <span class="font-medium text-orange-800 dark:text-orange-300 truncate max-w-[150px]" title="${m.nome}">${m.nome}</span>
                                    <span class="text-xs font-bold text-orange-600 dark:text-orange-400 whitespace-nowrap">Vence: ${m.cnhVencimento.split('-').reverse().join('/')}</span>
                                </div>
                            `;
                        }
                    }
                });
                if (!hasCNH) containerCNH.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>';
            }

            // 3. Atestados Prolongados (>15 dias no total - últimos 60 dias)
            const sessentaDiasAtras = new Date(agora);
            sessentaDiasAtras.setDate(sessentaDiasAtras.getDate() - 60);
            
            const atestadosRecentes = faltas.filter(f => {
                const d = new Date(f.data + 'T12:00:00');
                return d >= sessentaDiasAtras && (f.motivo === 'atestado-medico' || f.motivo === 'licenca-medica');
            });

            const contagemAtestados = {};
            atestadosRecentes.forEach(f => {
                contagemAtestados[f.matricula] = (contagemAtestados[f.matricula] || 0) + 1;
            });

            const containerAtestados = document.getElementById('lista-alertas-atestados');
            if (containerAtestados) {
                containerAtestados.innerHTML = '';
                let hasAtestados = false;
                Object.entries(contagemAtestados).forEach(([matricula, qtd]) => {
                    if (qtd > 15) {
                        const func = funcionarios.find(f => f.cadastro.toString() === matricula);
                        if (func) {
                            hasAtestados = true;
                            containerAtestados.innerHTML += `
                                <div class="flex items-center justify-between p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded border-l-4 border-yellow-500 mb-1">
                                    <span class="font-medium text-yellow-800 dark:text-yellow-300 truncate max-w-[150px]" title="${func.nome}">${func.nome}</span>
                                    <span class="font-bold text-yellow-600 dark:text-yellow-400 text-sm whitespace-nowrap">${qtd} dias (60d)</span>
                                </div>
                            `;
                        }
                    }
                });
                if (!hasAtestados) containerAtestados.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">Nenhum alerta.</p>';
            }
        }

        function atualizarDashboard() {
            // Atualiza o painel de alertas de risco sempre que o dashboard for atualizado
            atualizarPainelAlertas();

            const periodo = document.getElementById('filtro-periodo-dashboard').value;
            const frente = document.getElementById('filtro-frente-dashboard')?.value || 'todas';
            const lider = document.getElementById('filtro-lider-dashboard')?.value || 'todos';
            const dados = calcularEstatisticasDashboard(periodo, frente, lider);
            
            // Atualiza números sempre
            document.getElementById('dashboard-total-funcionarios').textContent = dados.totalFuncionarios;
            document.getElementById('dashboard-faltas-mes').textContent = dados.faltasMes;
            document.getElementById('dashboard-taxa-presenca').textContent = dados.taxaPresenca + '%';
            document.getElementById('dashboard-atestados').textContent = dados.totalAtestados;
            document.getElementById('dashboard-faltas-injustificadas').textContent = dados.faltasInjustificadas;
            document.getElementById('dashboard-media-faltas').textContent = dados.mediaFaltas;
            document.getElementById('dashboard-sem-faltas').textContent = dados.funcionariosSemFaltas;
            document.getElementById('dashboard-faltas-hoje').textContent = dados.faltasHoje;
            document.getElementById('dashboard-admin-registros').textContent = dados.adminRegistrosPeriodo;
            document.getElementById('dashboard-variacao-mes').textContent = dados.variacaoMes;
            document.getElementById('dashboard-ferias-count').textContent = dados.resumoAdmin.ferias;
            document.getElementById('dashboard-banco-count').textContent = dados.resumoAdmin.bancoHoras;
            document.getElementById('dashboard-abono-count').textContent = dados.resumoAdmin.abono;
            document.getElementById('dashboard-chuva-count').textContent = dados.resumoAdmin.chuva;
            
            // Atualiza gráficos somente se Chart.js estiver presente (UMD seguro)
            const ChartLib = getChartLib();
            if (ChartLib) {
                atualizarGraficoMotivos(dados.graficoMotivos);
                atualizarGraficoEvolucao(dados.graficoEvolucao);
                atualizarGraficoSetores(dados.graficoSetores);
                atualizarGraficoTurnos(dados.graficoTurnos);
            } else if (!avisouChartsIndisponiveis) {
                showMessage('Gráficos indisponíveis no ambiente atual. Dados numéricos exibidos normalmente.', 'warning');
                avisouChartsIndisponiveis = true;
            }

            atualizarTopFaltas(dados.topFaltas);
            atualizarTopLideres(dados.topLideres);
        }

        function calcularEstatisticasDashboard(periodo, frenteSelecionada, liderSelecionado) {
            const agora = new Date();
            let dataInicio, dataFim;
            
            switch(periodo) {
                case 'mes_anterior':
                    dataInicio = new Date(agora.getFullYear(), agora.getMonth() - 1, 1);
                    dataFim = new Date(agora.getFullYear(), agora.getMonth(), 0);
                    break;
                case 'trimestre':
                    dataInicio = new Date(agora.getFullYear(), agora.getMonth() - 2, 1);
                    dataFim = new Date(agora.getFullYear(), agora.getMonth() + 1, 0);
                    break;
                case 'semestre':
                    dataInicio = new Date(agora.getFullYear(), agora.getMonth() - 5, 1);
                    dataFim = new Date(agora.getFullYear(), agora.getMonth() + 1, 0);
                    break;
                case 'ano':
                    dataInicio = new Date(agora.getFullYear(), 0, 1);
                    dataFim = new Date(agora.getFullYear(), 11, 31);
                    break;
                default: // mes_atual
                    dataInicio = new Date(agora.getFullYear(), agora.getMonth(), 1);
                    dataFim = new Date(agora.getFullYear(), agora.getMonth() + 1, 0);
            }
            
            const totalFuncionarios = funcionarios.length;
            let faltasPeriodo = faltas.filter(f => {
                const dataFalta = new Date(f.data + 'T12:00:00');
                return dataFalta >= dataInicio && dataFalta <= dataFim;
            });
            if (frenteSelecionada !== 'todas') {
                faltasPeriodo = faltasPeriodo.filter(f => {
                    const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                    return func && func.frente === frenteSelecionada;
                });
            }
            if (liderSelecionado !== 'todos') {
                faltasPeriodo = faltasPeriodo.filter(f => {
                    const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                    return func && (func.lider || '').trim() === liderSelecionado;
                });
            }
            const faltasPeriodoValidas = faltasPeriodo.filter(f => isFaltaMotivo(f.motivo));
            
            const faltasMes = faltas.filter(f => {
                const dataFalta = new Date(f.data + 'T12:00:00');
                let ok = isFaltaMotivo(f.motivo) &&
                       dataFalta.getMonth() === agora.getMonth() && 
                       dataFalta.getFullYear() === agora.getFullYear();
                if (!ok) return false;
                if (frenteSelecionada !== 'todas') {
                    const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                    if (!(func && func.frente === frenteSelecionada)) return false;
                }
                if (liderSelecionado !== 'todos') {
                    const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                    if (!(func && (func.lider || '').trim() === liderSelecionado)) return false;
                }
                return true;
            }).length;
            
            const totalAtestados = faltasPeriodo.filter(f => f.motivo === 'atestado-medico').length;
            const faltasInjustificadas = faltasPeriodoValidas.filter(f => f.motivo === 'falta-injustificada').length;
            
            const diasUteis = 22 * totalFuncionarios;
            const taxaPresenca = diasUteis > 0 ? 
                Math.round(((diasUteis - faltasMes) / diasUteis) * 100) : 100;
            
            const mediaFaltas = totalFuncionarios > 0 ? 
                (faltasPeriodoValidas.length / totalFuncionarios).toFixed(1) : 0;
            
            const funcionariosComFaltas = new Set(faltasPeriodoValidas.map(f => f.matricula));
            const funcionariosSemFaltas = totalFuncionarios - funcionariosComFaltas.size;
            
            const motivos = {};
            faltasPeriodoValidas.forEach(falta => {
                motivos[falta.motivo] = (motivos[falta.motivo] || 0) + 1;
            });
            
            const graficoMotivosData = {
                labels: Object.keys(motivos).map(m => getMotivoLabel(m)),
                data: Object.values(motivos),
                cores: Object.keys(motivos).map(m => {
                    const cores = {
                        'doença': '#f59e0b',
                        'atestado-medico': '#3b82f6',
                        'falta-justificada': '#10b981',
                        'falta-injustificada': '#ef4444',
                        'licenca-medica': '#8b5cf6',
                        'acidente-trabalho': '#f97316',
                        'banco-horas': '#06b6d4',
                        'dispensa-chuva': '#6366f1',
                        'outros': '#6b7280'
                    };
                    return cores[m] || '#6b7280';
                })
            };
            
            const graficoEvolucaoData = {
                labels: [],
                data: []
            };
            
            for (let i = 5; i >= 0; i--) {
                const data = new Date(agora.getFullYear(), agora.getMonth() - i, 1);
                const mesAno = data.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
                graficoEvolucaoData.labels.push(mesAno);
                
                const faltasMes = faltas.filter(f => {
                    const dataFalta = new Date(f.data + 'T12:00:00');
                    return isFaltaMotivo(f.motivo) &&
                           dataFalta.getMonth() === data.getMonth() && 
                           dataFalta.getFullYear() === data.getFullYear();
                }).length;
                
                graficoEvolucaoData.data.push(faltasMes);
            }
            
            const setores = {};
            faltasPeriodoValidas.forEach(falta => {
                const funcionario = funcionarios.find(f => f.cadastro.toString() === falta.matricula);
                if (funcionario) {
                    const setor = funcionario.descricaoLocal || 'Não informado';
                    setores[setor] = (setores[setor] || 0) + 1;
                }
            });
            
            const graficoSetoresData = {
                labels: Object.keys(setores),
                data: Object.values(setores),
                cores: Object.keys(setores).map((_, i) => {
                    const cores = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#f97316', '#06b6d4', '#6366f1'];
                    return cores[i % cores.length];
                })
            };
            
            const turnos = {};
            faltasPeriodoValidas.forEach(falta => {
                const funcionario = funcionarios.find(f => f.cadastro.toString() === falta.matricula);
                if (funcionario) {
                    const turno = funcionario.turno || 'Não informado';
                    turnos[turno] = (turnos[turno] || 0) + 1;
                }
            });
            
            const graficoTurnosData = {
                labels: Object.keys(turnos),
                data: Object.values(turnos),
                cores: Object.keys(turnos).map((_, i) => {
                    const cores = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6'];
                    return cores[i % cores.length];
                })
            };
            
            const faltasPorFuncionario = {};
            faltasPeriodoValidas.forEach(falta => {
                if (!faltasPorFuncionario[falta.matricula]) {
                    faltasPorFuncionario[falta.matricula] = {
                        total: 0,
                        mes: 0,
                        funcionario: funcionarios.find(f => f.cadastro.toString() === falta.matricula)
                    };
                }
                faltasPorFuncionario[falta.matricula].total++;
                
                const dataFalta = new Date(falta.data + 'T12:00:00');
                if (dataFalta.getMonth() === agora.getMonth() && 
                    dataFalta.getFullYear() === agora.getFullYear()) {
                    faltasPorFuncionario[falta.matricula].mes++;
                }
            });
            
            const topFaltas = Object.values(faltasPorFuncionario)
                .filter(item => item.funcionario)
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);

            const hojeStr = `${agora.getFullYear()}-${String(agora.getMonth() + 1).padStart(2, '0')}-${String(agora.getDate()).padStart(2, '0')}`;
            const faltasHoje = faltas.filter(f => {
                if (!isFaltaMotivo(f.motivo)) return false;
                if (f.data !== hojeStr) return false;
                const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                if (frenteSelecionada !== 'todas' && !(func && func.frente === frenteSelecionada)) return false;
                if (liderSelecionado !== 'todos' && !(func && (func.lider || '').trim() === liderSelecionado)) return false;
                return true;
            }).length;

            const adminMotivos = new Set(['ferias', 'banco-horas', 'abono', 'dispensa-chuva']);
            const adminPeriodo = faltas.filter(f => {
                const d = new Date(f.data + 'T12:00:00');
                if (!(d >= dataInicio && d <= dataFim)) return false;
                if (!adminMotivos.has(f.motivo)) return false;
                const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                if (frenteSelecionada !== 'todas' && !(func && func.frente === frenteSelecionada)) return false;
                if (liderSelecionado !== 'todos' && !(func && (func.lider || '').trim() === liderSelecionado)) return false;
                return true;
            });
            const resumoAdmin = {
                ferias: adminPeriodo.filter(f => f.motivo === 'ferias').length,
                bancoHoras: adminPeriodo.filter(f => f.motivo === 'banco-horas').length,
                abono: adminPeriodo.filter(f => f.motivo === 'abono').length,
                chuva: adminPeriodo.filter(f => f.motivo === 'dispensa-chuva').length
            };
            const adminRegistrosPeriodo = adminPeriodo.length;

            const porLider = {};
            faltasPeriodoValidas.forEach(f => {
                const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                const lider = func ? ((func.lider || '').trim() || 'Sem líder') : 'Sem líder';
                porLider[lider] = (porLider[lider] || 0) + 1;
            });
            const topLideres = Object.entries(porLider)
                .map(([lider, total]) => ({ lider, total }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);

            const prevInicio = new Date(agora.getFullYear(), agora.getMonth() - 1, 1);
            const prevFim = new Date(agora.getFullYear(), agora.getMonth(), 0);
            const faltasPrev = faltas.filter(f => {
                const d = new Date(f.data + 'T12:00:00');
                if (!isFaltaMotivo(f.motivo)) return false;
                if (!(d >= prevInicio && d <= prevFim)) return false;
                const func = funcionarios.find(x => x.cadastro.toString() === f.matricula);
                if (frenteSelecionada !== 'todas' && !(func && func.frente === frenteSelecionada)) return false;
                if (liderSelecionado !== 'todos' && !(func && (func.lider || '').trim() === liderSelecionado)) return false;
                return true;
            }).length;
            const variacaoMesPct = faltasPrev === 0 ? (faltasMes > 0 ? 100 : 0) : Math.round(((faltasMes - faltasPrev) / faltasPrev) * 100);
            const variacaoMes = (variacaoMesPct >= 0 ? '+' : '') + variacaoMesPct + '%';
            
            return {
                totalFuncionarios,
                faltasMes,
                taxaPresenca,
                totalAtestados,
                faltasInjustificadas,
                mediaFaltas,
                funcionariosSemFaltas,
                graficoMotivos: graficoMotivosData,
                graficoEvolucao: graficoEvolucaoData,
                graficoSetores: graficoSetoresData,
                graficoTurnos: graficoTurnosData,
                topFaltas,
                faltasHoje,
                adminRegistrosPeriodo,
                resumoAdmin,
                topLideres,
                variacaoMes
            };
        }

        function atualizarTopLideres(lista) {
            const tbody = document.getElementById('top-lideres-table');
            if (!tbody) return;
            tbody.innerHTML = lista.map(item => `
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="px-4 py-2">${item.lider}</td>
                    <td class="px-4 py-2">${item.total}</td>
                </tr>
            `).join('');
        }

        function atualizarGraficoMotivos(dados) {
            const canvas = document.getElementById('grafico-motivos');
            const ChartLib = getChartLib();
            if (!canvas || !ChartLib) return;
            const ctx = canvas.getContext('2d');
            if (graficoMotivos) {
                graficoMotivos.data.labels = dados.labels;
                graficoMotivos.data.datasets[0].data = dados.data;
                graficoMotivos.data.datasets[0].backgroundColor = dados.cores;
                graficoMotivos.update();
                return;
            }
            const existingChart = ChartLib.getChart(canvas);
            if (existingChart) existingChart.destroy();
            graficoMotivos = new ChartLib(ctx, {
                type: 'doughnut',
                data: { labels: dados.labels, datasets: [{ data: dados.data, backgroundColor: dados.cores, borderWidth: 2, borderColor: '#fff' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 20, usePointStyle: true } } } }
            });
        }

        function atualizarGraficoEvolucao(dados) {
            const canvas = document.getElementById('grafico-evolucao');
            const ChartLib = getChartLib();
            if (!canvas || !ChartLib) return;
            const ctx = canvas.getContext('2d');
            if (graficoEvolucao) {
                graficoEvolucao.data.labels = dados.labels;
                graficoEvolucao.data.datasets[0].data = dados.data;
                graficoEvolucao.update();
                return;
            }
            const existingChart = ChartLib.getChart(canvas);
            if (existingChart) existingChart.destroy();
            graficoEvolucao = new ChartLib(ctx, {
                type: 'line',
                data: { labels: dados.labels, datasets: [{ label: 'Faltas', data: dados.data, borderColor: '#5D5CDE', backgroundColor: 'rgba(93, 92, 222, 0.1)', borderWidth: 3, fill: true, tension: 0.4 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
        }

        function atualizarGraficoSetores(dados) {
            const canvas = document.getElementById('grafico-setores');
            const ChartLib = getChartLib();
            if (!canvas || !ChartLib) return;
            const ctx = canvas.getContext('2d');
            if (graficoSetores) {
                graficoSetores.data.labels = dados.labels;
                graficoSetores.data.datasets[0].data = dados.data;
                graficoSetores.data.datasets[0].backgroundColor = dados.cores;
                graficoSetores.update();
                return;
            }
            const existingChart = ChartLib.getChart(canvas);
            if (existingChart) existingChart.destroy();
            graficoSetores = new ChartLib(ctx, {
                type: 'bar',
                data: { labels: dados.labels, datasets: [{ label: 'Faltas por Setor', data: dados.data, backgroundColor: dados.cores, borderWidth: 1 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
        }

        function atualizarGraficoTurnos(dados) {
            const canvas = document.getElementById('grafico-turnos');
            const ChartLib = getChartLib();
            if (!canvas || !ChartLib) return;
            const ctx = canvas.getContext('2d');
            if (graficoTurnos) {
                graficoTurnos.data.labels = dados.labels;
                graficoTurnos.data.datasets[0].data = dados.data;
                graficoTurnos.data.datasets[0].backgroundColor = dados.cores;
                graficoTurnos.update();
                return;
            }
            const existingChart = ChartLib.getChart(canvas);
            if (existingChart) existingChart.destroy();
            graficoTurnos = new ChartLib(ctx, {
                type: 'pie',
                data: { labels: dados.labels, datasets: [{ data: dados.data, backgroundColor: dados.cores, borderWidth: 2, borderColor: '#fff' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 20, usePointStyle: true } } } }
            });
        }

        function atualizarTopFaltas(topFaltas) {
            const tbody = document.getElementById('top-faltas-table');
            // Otimização: renderiza com innerHTML de uma vez
            const rowsHtml = topFaltas.map((item, index) => {
                let posicaoClass = 'text-gray-600 dark:text-gray-400';
                if (index === 0) posicaoClass = 'text-yellow-600 dark:text-yellow-400 font-bold';
                else if (index === 1) posicaoClass = 'text-gray-600 dark:text-gray-400 font-bold';
                else if (index === 2) posicaoClass = 'text-orange-600 dark:text-orange-400 font-bold';
                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="px-4 py-3 text-sm font-medium ${posicaoClass}">${index + 1}º</td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">${item.funcionario.nome}</td>
                        <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-300">${item.funcionario.cadastro}</td>
                        <td class="px-4 py-3 text-sm font-medium text-red-600 dark:text-red-400">${item.total}</td>
                        <td class="px-4 py-3 text-sm font-medium text-orange-600 dark:text-orange-400">${item.mes}</td>
                    </tr>
                `;
            }).join('');
            tbody.innerHTML = rowsHtml;
        }

        // ===== ESTATÍSTICAS =====
        function atualizarEstatisticas() {
            document.getElementById('stat-total-funcionarios').textContent = funcionarios.length;
            document.getElementById('stat-total-faltas').textContent = faltas.length;
            
            const agora = new Date();
            const mesAtual = `${agora.getFullYear()}-${String(agora.getMonth() + 1).padStart(2, '0')}`;
            const faltasMes = faltas.filter(f => f.data.startsWith(mesAtual)).length;
            document.getElementById('stat-faltas-mes').textContent = faltasMes;
        }

        // ===== BACKUP E RESTAURAÇÃO =====
        function exportarBackup() {
            const dados = {
                funcionarios: funcionarios,
                faltas: faltas,
                historico: historico,
                exportadoEm: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-faltas-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('Backup exportado com sucesso!', 'success');
        }

        function importarBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    if (dados.funcionarios && dados.faltas) {
                        funcionarios.length = 0;
                        faltas.length = 0;
                        historico.length = 0;
                        
                        dados.funcionarios.forEach(func => funcionarios.push(func));
                        dados.faltas.forEach(falta => faltas.push(falta));
                        if (dados.historico) {
                            dados.historico.forEach(reg => historico.push(reg));
                        }
                        
                        localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                        localStorage.setItem('faltas', JSON.stringify(faltas));
                        localStorage.setItem('historico', JSON.stringify(historico));
                        
                        carregarFuncionarios();
                        
                        adicionarRegistroHistorico(
                            'sistema', 
                            'Backup de dados importado',
                            `Foram importados ${funcionarios.length} funcionários, ${faltas.length} faltas e ${historico.length} registros de histórico.`
                        );
                        
                        showMessage('Backup importado com sucesso!', 'success');
                        const currentTab = document.querySelector('.tab-button.active')?.id.replace('tab-', '');
                        if (currentTab) showTab(currentTab);
                    } else {
                        showMessage('Arquivo de backup inválido!', 'error');
                    }
                } catch (error) {
                    showMessage('Erro ao importar backup: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        async function confirmarLimpeza() {
            mostrarModalConfirmacao(
                'Limpar Todos os Dados',
                '⚠️ Esta ação removerá permanentemente TODAS as faltas registradas. Esta ação não pode ser desfeita. Tem certeza?',
                async () => {
                    const faltasAntes = faltas.length;
                    
                    if (session) {
                        const { error } = await sb.from('faltas').delete().eq('user_id', session.user.id);
                        if (error) {
                            showMessage('Erro ao limpar faltas do banco: ' + error.message, 'error');
                            return;
                        }
                    }

                    faltas.length = 0;
                    localStorage.setItem('faltas', JSON.stringify(faltas));
                    
                    adicionarRegistroHistorico(
                        'sistema', 
                        'Todos os dados de faltas foram limpos',
                        `Foram removidas ${faltasAntes} faltas do sistema.`
                    );
                    
                    showMessage('Todos os dados foram limpos com sucesso!', 'success');
                    atualizarEstatisticas();
                    if (document.getElementById('consulta-matricula').value) {
                        consultarFaltas();
                    }
                    const currentTab = document.querySelector('.tab-button.active')?.id.replace('tab-', '');
                    if (currentTab) showTab(currentTab);
                }
            );
        }

        // ===== RELATÓRIOS =====
        function carregarOpcoesFrente() {
            const select = document.getElementById('filtro-frente-relatorio');
            if (!select) return;
            
            // Obter todas as frentes únicas dos funcionários
            const frentes = [...new Set(funcionarios.map(f => f.frente).filter(f => f && f.trim() !== ''))];
            
            // Limpar opções existentes
            select.innerHTML = '<option value="todas">Todas as Frentes</option>';
            
            // Adicionar opções de frente
            frentes.sort().forEach(frente => {
                const option = document.createElement('option');
                option.value = frente;
                option.textContent = frente;
                select.appendChild(option);
            });

            const selectLider = document.getElementById('filtro-lider-relatorio');
            if (selectLider) {
                const lideres = [...new Set(funcionarios.map(f => (f.lider || '').trim()).filter(l => l))].sort();
                const current = selectLider.value;
                selectLider.innerHTML = '<option value="todos">Todos os Líderes</option>';
                lideres.forEach(l => {
                    const option = document.createElement('option');
                    option.value = l;
                    option.textContent = l;
                    selectLider.appendChild(option);
                });
                if (lideres.includes(current)) selectLider.value = current;
            }
        }

        function gerarRelatorio() {
            const tipo = document.getElementById('tipo-relatorio').value;
            const dataInicialStr = document.getElementById('relatorio-data-inicial').value;
            const dataFinalStr = document.getElementById('relatorio-data-final').value;
            const frenteSelecionada = document.getElementById('filtro-frente-relatorio').value;
            const liderSelecionado = document.getElementById('filtro-lider-relatorio').value;
            
            if (!dataInicialStr || !dataFinalStr) {
                showMessage('Selecione o período para gerar o relatório!', 'error');
                return;
            }

            const dataInicial = new Date(dataInicialStr + '-01T00:00:00');
            const dataFinal = new Date(dataFinalStr + '-01T00:00:00');
            dataFinal.setMonth(dataFinal.getMonth() + 1);
            dataFinal.setDate(0);

            let faltasNoPeriodo = faltas.filter(f => {
                const dataFalta = new Date(f.data + 'T12:00:00');
                return dataFalta >= dataInicial && dataFalta <= dataFinal;
            });

            // Aplicar filtro por frente se selecionado
            if (frenteSelecionada !== 'todas') {
                faltasNoPeriodo = faltasNoPeriodo.filter(f => {
                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                    return funcionario && funcionario.frente === frenteSelecionada;
                });
            }

            // Aplicar filtro por líder se selecionado
            if (liderSelecionado !== 'todos') {
                faltasNoPeriodo = faltasNoPeriodo.filter(f => {
                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                    return funcionario && (funcionario.lider || '').trim() === liderSelecionado;
                });
            }

            let conteudoHtml = '';
            let tituloRelatorio = `Relatório de ${getTipoRelatorioLabel(tipo)}`;
            if (frenteSelecionada !== 'todas') {
                tituloRelatorio += ` - Frente: ${frenteSelecionada}`;
            }
            if (liderSelecionado !== 'todos') {
                tituloRelatorio += ` - Líder: ${liderSelecionado}`;
            }

            switch(tipo) {
                case 'faltas_geral':
                    const total = faltasNoPeriodo.length;
                    const injustificadas = faltasNoPeriodo.filter(f => f.motivo === 'falta-injustificada').length;
                    const justificadas = total - injustificadas;
                    conteudoHtml = `
                        <p>Total de Faltas: <strong>${total}</strong></p>
                        <p>Faltas Justificadas: <strong>${justificadas}</strong></p>
                        <p>Faltas Injustificadas: <strong>${injustificadas}</strong></p>
                        <h4 class="text-md font-semibold mt-4 mb-2">Detalhes das Faltas:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Data</th>
                                        <th class="px-3 py-2 text-left">Funcionário</th>
                                        <th class="px-3 py-2 text-left">Matrícula</th>
                                        <th class="px-3 py-2 text-left">Frente</th>
                                        <th class="px-3 py-2 text-left">Motivo</th>
                                        <th class="px-3 py-2 text-left">Observações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${faltasNoPeriodo.map(f => {
                                        const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                                        const frente = funcionario ? funcionario.frente : '-';
                                        return `
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <td class="px-3 py-2">${formatarDataParaExibicao(f.data)}</td>
                                                <td class="px-3 py-2">${f.nomeFuncionario}</td>
                                                <td class="px-3 py-2">${f.matricula}</td>
                                                <td class="px-3 py-2">${frente}</td>
                                                <td class="px-3 py-2">${getMotivoLabel(f.motivo)}</td>
                                                <td class="px-3 py-2">${f.observacoes || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'faltas_funcionario':
                    const faltasPorFunc = {};
                    faltasNoPeriodo.forEach(f => {
                        if (!faltasPorFunc[f.matricula]) {
                            const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                            faltasPorFunc[f.matricula] = {
                                nome: f.nomeFuncionario,
                                frente: funcionario ? funcionario.frente : '-',
                                total: 0,
                                injustificadas: 0,
                                atestados: 0
                            };
                        }
                        faltasPorFunc[f.matricula].total++;
                        if (f.motivo === 'falta-injustificada') faltasPorFunc[f.matricula].injustificadas++;
                        if (f.motivo === 'atestado-medico') faltasPorFunc[f.matricula].atestados++;
                    });
                    const listaFunc = Object.values(faltasPorFunc).sort((a, b) => b.total - a.total);
                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Resumo por Funcionário:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Funcionário</th>
                                        <th class="px-3 py-2 text-left">Matrícula</th>
                                        <th class="px-3 py-2 text-left">Frente</th>
                                        <th class="px-3 py-2 text-left">Total Faltas</th>
                                        <th class="px-3 py-2 text-left">Injustificadas</th>
                                        <th class="px-3 py-2 text-left">Atestados</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${listaFunc.map(f => `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${f.nome}</td>
                                            <td class="px-3 py-2">${f.matricula}</td>
                                            <td class="px-3 py-2">${f.frente}</td>
                                            <td class="px-3 py-2">${f.total}</td>
                                            <td class="px-3 py-2">${f.injustificadas}</td>
                                            <td class="px-3 py-2">${f.atestados}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'faltas_motivo':
                    const faltasPorMotivo = {};
                    faltasNoPeriodo.forEach(f => {
                        const motivoLabel = getMotivoLabel(f.motivo);
                        faltasPorMotivo[motivoLabel] = (faltasPorMotivo[motivoLabel] || 0) + 1;
                    });
                    const listaMotivos = Object.entries(faltasPorMotivo).sort(([,a],[,b]) => b - a);
                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Faltas por Motivo:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Motivo</th>
                                        <th class="px-3 py-2 text-left">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${listaMotivos.map(([motivo, total]) => `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${motivo}</td>
                                            <td class="px-3 py-2">${total}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'faltas_setor':
                    const faltasPorSetor = {};
                    faltasNoPeriodo.forEach(f => {
                        const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                        const setor = funcionario ? funcionario.descricaoLocal : 'Não Informado';
                        faltasPorSetor[setor] = (faltasPorSetor[setor] || 0) + 1;
                    });
                    const listaSetores = Object.entries(faltasPorSetor).sort(([,a],[,b]) => b - a);
                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Faltas por Setor:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Setor</th>
                                        <th class="px-3 py-2 text-left">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${listaSetores.map(([setor, total]) => `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${setor}</td>
                                            <td class="px-3 py-2">${total}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'faltas_frente':
                    const faltasPorFrente = {};
                    faltasNoPeriodo.forEach(f => {
                        const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                        const frente = funcionario ? funcionario.frente : 'Não Informado';
                        faltasPorFrente[frente] = (faltasPorFrente[frente] || 0) + 1;
                    });
                    const listaFrentes = Object.entries(faltasPorFrente).sort(([,a],[,b]) => b - a);
                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Faltas por Frente:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Frente</th>
                                        <th class="px-3 py-2 text-left">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${listaFrentes.map(([frente, total]) => `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${frente}</td>
                                            <td class="px-3 py-2">${total}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'atestados':
                    const atestadosNoPeriodo = faltasNoPeriodo.filter(f => f.motivo === 'atestado-medico');
                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Atestados Médicos no Período:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Data da Falta</th>
                                        <th class="px-3 py-2 text-left">Funcionário</th>
                                        <th class="px-3 py-2 text-left">Matrícula</th>
                                        <th class="px-3 py-2 text-left">Frente</th>
                                        <th class="px-3 py-2 text-left">Duração (dias)</th>
                                        <th class="px-3 py-2 text-left">Observações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${atestadosNoPeriodo.map(f => {
                                        const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                                        const frente = funcionario ? funcionario.frente : '-';
                                        return `
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <td class="px-3 py-2">${formatarDataParaExibicao(f.data)}</td>
                                                <td class="px-3 py-2">${f.nomeFuncionario}</td>
                                                <td class="px-3 py-2">${f.matricula}</td>
                                                <td class="px-3 py-2">${frente}</td>
                                                <td class="px-3 py-2">${f.diasAtestado || '-'}</td>
                                                <td class="px-3 py-2">${f.observacoes || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'ferias':
                    const containsFeriasObs = s => String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').includes('ferias');
                    const norm = s => String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
                    const toDate = d => new Date(d + 'T12:00:00');
                    const diffDays = (a,b) => Math.round((a - b) / (1000*60*60*24));
                    const brToISO = s => { const p = String(s).split('/'); return `${p[2]}-${p[1].padStart(2,'0')}-${p[0].padStart(2,'0')}`; };
                    const addDaysISO = (baseISO, n) => { const base = toDate(baseISO); const dt = new Date(base); dt.setDate(base.getDate() + n); const y = dt.getFullYear(); const mo = String(dt.getMonth()+1).padStart(2,'0'); const da = String(dt.getDate()).padStart(2,'0'); return `${y}-${mo}-${da}`; };
                    const clipDays = (inicioISO, fimISO, inicioP, fimP) => { const s = toDate(inicioISO); const e = toDate(fimISO); const start = s > inicioP ? s : inicioP; const end = e < fimP ? e : fimP; if (end < start) return 0; return diffDays(end, start) + 1; };
                    const todasFerias = faltasNoPeriodo.filter(f => { const m = norm(f.motivo); return m === 'ferias' || m.includes('ferias') || containsFeriasObs(f.observacoes); });
                    const linhasFerias = todasFerias.map(f => {
                        const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                        const nome = funcionario ? funcionario.nome : (f.nomeFuncionario || '-');
                        const cargo = funcionario ? funcionario.cargo : '-';
                        let dur = parseInt(f.diasAtestado || f.dias_atestado);
                        if (!dur || dur < 1) dur = 30;
                        const mObs = (f.observacoes || '').match(/(\d{2}\/\d{2}\/\d{4})\s*a\s*(\d{2}\/\d{2}\/\d{4})/);
                        const inicioISO = mObs ? brToISO(mObs[1]) : f.data;
                        const fimISO = mObs ? brToISO(mObs[2]) : addDaysISO(f.data, dur - 1);
                        const diasPeriodo = clipDays(inicioISO, fimISO, dataInicial, dataFinal);
                        return { nome, cargo, matricula: f.matricula, diasPeriodo, diasTotal: dur, inicio: inicioISO, fim: fimISO };
                    }).sort((a,b) => a.inicio.localeCompare(b.inicio));
                    window.relatorioFeriasLinhas = linhasFerias;
                    window.relatorioFeriasTitulo = tituloRelatorio;
                    window.relatorioPaginacao = window.relatorioPaginacao || { page: 1, pageSize: 50 };
                    {
                        const total = linhasFerias.length;
                        const totalRegistrosFerias = todasFerias.length;
                        const totalFuncionariosFerias = Array.from(new Set(todasFerias.map(f => f.matricula))).length;
                        const pageSize = window.relatorioPaginacao.pageSize;
                        const totalPages = Math.max(1, Math.ceil(total / pageSize));
                        const page = Math.min(Math.max(window.relatorioPaginacao.page, 1), totalPages);
                        const start = (page - 1) * pageSize;
                        const end = Math.min(start + pageSize, total);
                        const paginaLinhas = linhasFerias.slice(start, end);
                        conteudoHtml = `
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-md font-semibold">Férias no Período</h4>
                                <div class="flex items-center gap-3">
                                    <span class="text-sm">Página ${page} de ${totalPages}</span>
                                    <span class="text-sm">Mostrando ${start + 1}–${end} de ${total}</span>
                                    <span class="text-sm">Registros (BD): ${totalRegistrosFerias}</span>
                                    <span class="text-sm">Funcionários com férias: ${totalFuncionariosFerias}</span>
                                    <select class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded" onchange="window.setPageSizeRelatorio(parseInt(this.value))">
                                        <option value="25"${pageSize===25?' selected':''}>25</option>
                                        <option value="50"${pageSize===50?' selected':''}>50</option>
                                        <option value="100"${pageSize===100?' selected':''}>100</option>
                                    </select>
                                    <div class="flex items-center gap-2">
                                        <button class="px-3 py-1 border rounded" onclick="window.mudarPaginaRelatorio(-1)">Anterior</button>
                                        <button class="px-3 py-1 border rounded" onclick="window.mudarPaginaRelatorio(1)">Próxima</button>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full table-auto text-sm">
                                    <thead>
                                        <tr class="bg-gray-100 dark:bg-gray-600">
                                            <th class="px-3 py-2 text-left">Funcionário</th>
                                            <th class="px-3 py-2 text-left">Função</th>
                                            <th class="px-3 py-2 text-left">Dias (no período)</th>
                                            <th class="px-3 py-2 text-left">Dias lançados</th>
                                            <th class="px-3 py-2 text-left">Data Inicial</th>
                                            <th class="px-3 py-2 text-left">Data Final</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${paginaLinhas.map(item => `
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <td class="px-3 py-2">${item.nome}</td>
                                                <td class="px-3 py-2">${item.cargo}</td>
                                                <td class="px-3 py-2">${item.diasPeriodo}</td>
                                                <td class="px-3 py-2">${item.diasTotal}</td>
                                                <td class="px-3 py-2">${formatarDataParaExibicao(item.inicio)}</td>
                                                <td class="px-3 py-2">${formatarDataParaExibicao(item.fim)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    break;
                case 'banco_horas':
                    const registrosBH = faltasNoPeriodo.filter(f => normalizarMotivo(f.motivo) === 'banco-horas');
                    const porFuncionarioBH = {};
                    registrosBH.forEach(f => {
                        const key = f.matricula;
                        const func = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                        if (!porFuncionarioBH[key]) {
                            porFuncionarioBH[key] = { nome: f.nomeFuncionario, matricula: f.matricula, frente: func ? func.frente : '-', datas: [] };
                        }
                        porFuncionarioBH[key].datas.push(f.data);
                    });
                    const linhasBH = Object.values(porFuncionarioBH)
                        .map(item => ({ ...item, diasTotal: item.datas.length, datasFormatadas: item.datas.sort((a,b)=>a.localeCompare(b)).map(d => formatarDataParaExibicao(d)).join(', ') }))
                        .sort((a,b) => b.diasTotal - a.diasTotal);
                    conteudoHtml = `
                        <p>Total de Registros de Banco de Horas: <strong>${registrosBH.length}</strong></p>
                        <h4 class="text-md font-semibold mt-4 mb-2">Resumo por Funcionário:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Funcionário</th>
                                        <th class="px-3 py-2 text-left">Matrícula</th>
                                        <th class="px-3 py-2 text-left">Frente</th>
                                        <th class="px-3 py-2 text-left">Dias de Banco</th>
                                        <th class="px-3 py-2 text-left">Dias Utilizados</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${linhasBH.map(item => `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${item.nome}</td>
                                            <td class="px-3 py-2">${item.matricula}</td>
                                            <td class="px-3 py-2">${item.frente}</td>
                                            <td class="px-3 py-2">${item.diasTotal}</td>
                                            <td class="px-3 py-2">${item.datasFormatadas}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'comparativo':
                    const comparativoMensal = {};
                    const meses = [];
                    let currentMonth = new Date(dataInicial);
                    while (currentMonth <= dataFinal) {
                        const mesAnoKey = currentMonth.toISOString().slice(0, 7);
                        meses.push(mesAnoKey);
                        comparativoMensal[mesAnoKey] = { total: 0, injustificadas: 0, atestados: 0 };
                        currentMonth.setMonth(currentMonth.getMonth() + 1);
                    }

                    faltasNoPeriodo.forEach(f => {
                        const mesAnoKey = f.data.slice(0, 7);
                        if (comparativoMensal[mesAnoKey]) {
                            comparativoMensal[mesAnoKey].total++;
                            if (f.motivo === 'falta-injustificada') comparativoMensal[mesAnoKey].injustificadas++;
                            if (f.motivo === 'atestado-medico') comparativoMensal[mesAnoKey].atestados++;
                        }
                    });

                    conteudoHtml = `
                        <h4 class="text-md font-semibold mt-4 mb-2">Comparativo Mensal de Faltas:</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-600">
                                        <th class="px-3 py-2 text-left">Mês/Ano</th>
                                        <th class="px-3 py-2 text-left">Total Faltas</th>
                                        <th class="px-3 py-2 text-left">Injustificadas</th>
                                        <th class="px-3 py-2 text-left">Atestados</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${meses.map(mesAnoKey => {
                                        const dadosMes = comparativoMensal[mesAnoKey];
                                        const [ano, mes] = mesAnoKey.split('-');
                                        const labelMes = new Date(ano, mes - 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                                        return `
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <td class="px-3 py-2">${labelMes}</td>
                                                <td class="px-3 py-2">${dadosMes.total}</td>
                                                <td class="px-3 py-2">${dadosMes.injustificadas}</td>
                                                <td class="px-3 py-2">${dadosMes.atestados}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                default:
                    conteudoHtml = `<p class="text-center text-gray-600 dark:text-gray-300">Tipo de relatório não implementado.</p>`;
            }
            
            document.getElementById('titulo-relatorio').textContent = tituloRelatorio;
            document.getElementById('conteudo-relatorio').innerHTML = conteudoHtml;
            document.getElementById('area-relatorio').classList.remove('hidden');
            
            showMessage('Relatório gerado com sucesso!', 'success');
        }

        function getTipoRelatorioLabel(tipo) {
            const tipos = {
                'faltas_geral': 'Faltas - Visão Geral',
                'faltas_funcionario': 'Faltas por Funcionário',
                'faltas_motivo': 'Faltas por Motivo',
                'faltas_setor': 'Faltas por Setor',
                'faltas_frente': 'Faltas por Frente',
                'atestados': 'Atestados Médicos',
                'ferias': 'Férias',
                'comparativo': 'Comparativo Mensal'
            };
            return tipos[tipo] || tipo;
        }

        function gerarRelatorioRapido(tipo) {
            const hoje = new Date();
            let dataInicialDate, dataFinalDate, titulo;
            switch(tipo) {
                case 'faltas_hoje':
                    dataInicialDate = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
                    dataFinalDate = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
                    titulo = 'Relatório de Faltas - Hoje';
                    break;
                case 'faltas_semana':
                    dataFinalDate = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
                    dataInicialDate = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate() - 7);
                    titulo = 'Relatório de Faltas - Últimos 7 dias';
                    break;
                case 'atestados_mes':
                    dataInicialDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    dataFinalDate = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
                    titulo = 'Relatório de Atestados - Mês atual';
                    break;
                case 'banco_horas_mes':
                    dataInicialDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    dataFinalDate = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
                    titulo = 'Relatório - Banco de Horas (Mês atual)';
                    break;
                default:
                    return;
            }

            const frenteSelecionada = document.getElementById('filtro-frente-relatorio').value;
            const liderSelecionado = document.getElementById('filtro-lider-relatorio').value;

            let faltasNoPeriodo = faltas.filter(f => {
                const dataFalta = new Date(f.data + 'T12:00:00');
                return dataFalta >= dataInicialDate && dataFalta <= dataFinalDate;
            });

            if (frenteSelecionada !== 'todas') {
                faltasNoPeriodo = faltasNoPeriodo.filter(f => {
                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                    return funcionario && funcionario.frente === frenteSelecionada;
                });
            }

            if (liderSelecionado !== 'todos') {
                faltasNoPeriodo = faltasNoPeriodo.filter(f => {
                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                    return funcionario && (funcionario.lider || '').trim() === liderSelecionado;
                });
            }

            let conteudoHtml = '';
            if (tipo === 'atestados_mes') {
                const atestados = faltasNoPeriodo.filter(f => f.motivo === 'atestado-medico');
                conteudoHtml = `
                    <p>Total de Atestados: <strong>${atestados.length}</strong></p>
                    <h4 class="text-md font-semibold mt-4 mb-2">Detalhes dos Atestados:</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto text-sm">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-600">
                                    <th class="px-3 py-2 text-left">Data</th>
                                    <th class="px-3 py-2 text-left">Funcionário</th>
                                    <th class="px-3 py-2 text-left">Matrícula</th>
                                    <th class="px-3 py-2 text-left">Frente</th>
                                    <th class="px-3 py-2 text-left">Dias</th>
                                    <th class="px-3 py-2 text-left">Observações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${atestados.map(f => {
                                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                                    const frente = funcionario ? funcionario.frente : '-';
                                    return `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${formatarDataParaExibicao(f.data)}</td>
                                            <td class="px-3 py-2">${f.nomeFuncionario}</td>
                                            <td class="px-3 py-2">${f.matricula}</td>
                                            <td class="px-3 py-2">${frente}</td>
                                            <td class="px-3 py-2">${f.diasAtestado || '-'}</td>
                                            <td class="px-3 py-2">${f.observacoes || '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else if (tipo === 'banco_horas_mes') {
                const registros = faltasNoPeriodo.filter(f => f.motivo === 'banco-horas');
                const porFuncionario = {};
                registros.forEach(f => {
                    const key = f.matricula;
                    const func = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                    if (!porFuncionario[key]) {
                        porFuncionario[key] = {
                            nome: f.nomeFuncionario,
                            matricula: f.matricula,
                            frente: func ? func.frente : '-',
                            datas: []
                        };
                    }
                    porFuncionario[key].datas.push(f.data);
                });
                const linhas = Object.values(porFuncionario)
                    .map(item => ({
                        ...item,
                        diasTotal: item.datas.length,
                        datasFormatadas: item.datas.sort((a,b)=>a.localeCompare(b)).map(d => formatarDataParaExibicao(d)).join(', ')
                    }))
                    .sort((a,b) => b.diasTotal - a.diasTotal);
                conteudoHtml = `
                    <p>Total de Registros de Banco de Horas: <strong>${registros.length}</strong></p>
                    <h4 class="text-md font-semibold mt-4 mb-2">Resumo por Funcionário:</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto text-sm">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-600">
                                    <th class="px-3 py-2 text-left">Funcionário</th>
                                    <th class="px-3 py-2 text-left">Matrícula</th>
                                    <th class="px-3 py-2 text-left">Frente</th>
                                    <th class="px-3 py-2 text-left">Dias de Banco</th>
                                    <th class="px-3 py-2 text-left">Dias Utilizados</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${linhas.map(item => `
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <td class="px-3 py-2">${item.nome}</td>
                                        <td class="px-3 py-2">${item.matricula}</td>
                                        <td class="px-3 py-2">${item.frente}</td>
                                        <td class="px-3 py-2">${item.diasTotal}</td>
                                        <td class="px-3 py-2">${item.datasFormatadas}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                const total = faltasNoPeriodo.length;
                const injustificadas = faltasNoPeriodo.filter(f => f.motivo === 'falta-injustificada').length;
                const justificadas = total - injustificadas;
                conteudoHtml = `
                    <p>Total de Faltas: <strong>${total}</strong></p>
                    <p>Faltas Justificadas: <strong>${justificadas}</strong></p>
                    <p>Faltas Injustificadas: <strong>${injustificadas}</strong></p>
                    <h4 class="text-md font-semibold mt-4 mb-2">Detalhes das Faltas:</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto text-sm">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-600">
                                    <th class="px-3 py-2 text-left">Data</th>
                                    <th class="px-3 py-2 text-left">Funcionário</th>
                                    <th class="px-3 py-2 text-left">Matrícula</th>
                                    <th class="px-3 py-2 text-left">Frente</th>
                                    <th class="px-3 py-2 text-left">Motivo</th>
                                    <th class="px-3 py-2 text-left">Observações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${faltasNoPeriodo.map(f => {
                                    const funcionario = funcionarios.find(func => func.cadastro.toString() === f.matricula);
                                    const frente = funcionario ? funcionario.frente : '-';
                                    return `
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <td class="px-3 py-2">${formatarDataParaExibicao(f.data)}</td>
                                            <td class="px-3 py-2">${f.nomeFuncionario}</td>
                                            <td class="px-3 py-2">${f.matricula}</td>
                                            <td class="px-3 py-2">${frente}</td>
                                            <td class="px-3 py-2">${getMotivoLabel(f.motivo)}</td>
                                            <td class="px-3 py-2">${f.observacoes || '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            if (frenteSelecionada !== 'todas') titulo += ` - Frente: ${frenteSelecionada}`;
            if (liderSelecionado !== 'todos') titulo += ` - Líder: ${liderSelecionado}`;
            document.getElementById('titulo-relatorio').textContent = titulo;
            document.getElementById('conteudo-relatorio').innerHTML = conteudoHtml;
            document.getElementById('area-relatorio').classList.remove('hidden');
            showMessage('Relatório gerado com sucesso!', 'success');
        }

        function imprimirRelatorio() {
            window.print();
        }

        function exportarRelatorioPDF() {
            showMessage('Funcionalidade de exportação PDF em desenvolvimento!', 'info');
        }

        function exportarRelatorioExcel() {
            showMessage('Funcionalidade de exportação Excel em desenvolvimento!', 'info');
        }

        function exportarRelatorioCSV() {
            const area = document.getElementById('conteudo-relatorio');
            const table = area.querySelector('table');
            if (!table) { showMessage('Nenhuma tabela encontrada no relatório.', 'error'); return; }
            const rows = Array.from(table.querySelectorAll('tr'));
            const csv = rows.map(row => Array.from(row.querySelectorAll('th,td')).map(cell => {
                const text = (cell.textContent || '').replace(/\n/g, ' ').trim();
                const escaped = '"' + text.replace(/"/g, '""') + '"';
                return escaped;
            }).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'relatorio.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        window.mudarPaginaRelatorio = function(delta) {
            if (!window.relatorioFeriasLinhas || window.relatorioFeriasLinhas.length === 0) return;
            window.relatorioPaginacao = window.relatorioPaginacao || { page: 1, pageSize: 50 };
            const total = window.relatorioFeriasLinhas.length;
            const pageSize = window.relatorioPaginacao.pageSize;
            const totalPages = Math.max(1, Math.ceil(total / pageSize));
            const page = Math.min(Math.max(window.relatorioPaginacao.page + delta, 1), totalPages);
            window.relatorioPaginacao.page = page;
            const start = (page - 1) * pageSize;
            const end = Math.min(start + pageSize, total);
            const paginaLinhas = window.relatorioFeriasLinhas.slice(start, end);
            const totalRegistrosFerias = window.relatorioFeriasLinhas.length;
            const totalFuncionariosFerias = Array.from(new Set(window.relatorioFeriasLinhas.map(f => f.matricula))).length;
            const conteudo = `
                <div class="flex items-center justify-between mb-3">
                    <h4 class="text-md font-semibold">Férias no Período</h4>
                    <div class="flex items-center gap-3">
                        <span class="text-sm">Página ${page} de ${totalPages}</span>
                        <span class="text-sm">Mostrando ${start + 1}–${end} de ${total}</span>
                        <span class="text-sm">Registros (BD): ${totalRegistrosFerias}</span>
                        <span class="text-sm">Funcionários com férias: ${totalFuncionariosFerias}</span>
                        <select class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded" onchange="window.setPageSizeRelatorio(parseInt(this.value))">
                            <option value="25"${pageSize===25?' selected':''}>25</option>
                            <option value="50"${pageSize===50?' selected':''}>50</option>
                            <option value="100"${pageSize===100?' selected':''}>100</option>
                        </select>
                        <div class="flex items-center gap-2">
                            <button class="px-3 py-1 border rounded" onclick="window.mudarPaginaRelatorio(-1)">Anterior</button>
                            <button class="px-3 py-1 border rounded" onclick="window.mudarPaginaRelatorio(1)">Próxima</button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-600">
                                <th class="px-3 py-2 text-left">Funcionário</th>
                                <th class="px-3 py-2 text-left">Função</th>
                                <th class="px-3 py-2 text-left">Dias (no período)</th>
                                <th class="px-3 py-2 text-left">Dias lançados</th>
                                <th class="px-3 py-2 text-left">Data Inicial</th>
                                <th class="px-3 py-2 text-left">Data Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${paginaLinhas.map(item => `
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="px-3 py-2">${item.nome}</td>
                                    <td class="px-3 py-2">${item.cargo}</td>
                                    <td class="px-3 py-2">${item.diasPeriodo}</td>
                                    <td class="px-3 py-2">${item.diasTotal}</td>
                                    <td class="px-3 py-2">${formatarDataParaExibicao(item.inicio)}</td>
                                    <td class="px-3 py-2">${formatarDataParaExibicao(item.fim)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            document.getElementById('titulo-relatorio').textContent = window.relatorioFeriasTitulo || 'Relatório de Férias';
            document.getElementById('conteudo-relatorio').innerHTML = conteudo;
            document.getElementById('area-relatorio').classList.remove('hidden');
        };

        window.setPageSizeRelatorio = function(size) {
            window.relatorioPaginacao = window.relatorioPaginacao || { page: 1, pageSize: 50 };
            window.relatorioPaginacao.pageSize = size;
            window.relatorioPaginacao.page = 1;
            window.mudarPaginaRelatorio(0);
        };

        function setLoading(on) {
            let bar = document.getElementById('global-loading');
            if (!bar) {
                bar = document.createElement('div');
                bar.id = 'global-loading';
                bar.style.position = 'fixed';
                bar.style.top = '0';
                bar.style.left = '0';
                bar.style.width = '100%';
                bar.style.height = '4px';
                bar.style.background = 'linear-gradient(90deg, #5D5CDE, #4A4BC9)';
                bar.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
                bar.style.transform = 'scaleX(0)';
                bar.style.transformOrigin = '0 0';
                bar.style.transition = 'transform 0.3s ease';
                document.body.appendChild(bar);
            }
            bar.style.transform = on ? 'scaleX(1)' : 'scaleX(0)';
        }

        // ===== FUNÇÕES DE SALVAMENTO EM LOTE =====
        async function salvarFaltasDBLote(lista) {
            if (!session) return true;

            let rows = lista.map(f => ({
                matricula: parseInt(f.matricula),
                nome_funcionario: f.nomeFuncionario,
                data: f.data,
                motivo: f.motivo,
                observacoes: f.observacoes,
                registrado_em: f.registradoEm,
                modificado_em: new Date().toISOString(),
                user_id: session.user.id,
                dias_atestado: f.diasAtestado,
                arquivo_atestado_url: f.arquivoAtestadoUrl || null
            }));

            let data, error;
            try {
                ({ data, error } = await sb.from('faltas').insert(rows).select('id,matricula,data'));
            } catch (e1) {
                rows = rows.map(r => { const { arquivo_atestado_url, ...rest } = r; return rest; });
                ({ data, error } = await sb.from('faltas').insert(rows).select('id,matricula,data'));
            }
            if (error) throw error;

            // Garante que os itens locais tenham id para permitir exclusão/edição posteriores
            const idx = new Map(data.map(r => [`${r.matricula}|${r.data}`, r.id]));
            lista.forEach(f => {
                const key = `${parseInt(f.matricula)}|${f.data}`;
                const id = idx.get(key);
                if (id) f.id = id.toString();
            });

            return true;
        }

        async function excluirFaltasDBLote(ids) {
            if (!session || !canDelete()) { showMessage('Sem permissão para excluir no banco.', 'error'); return false; }
            const idsNum = ids.map(i => parseInt(i)).filter(n => !isNaN(n));
            const { error } = await sb.from('faltas').delete().in('id', idsNum);
            if (error) throw error;
            return true;
        }
    </script>
</body>
</html>
